

    </style>
</head>
<body>

    <div class="dark-mode-container">
        <button class="dark-mode-toggle" onclick="toggleDarkMode()">üåÉ Dark Mode</button>
    </div>

    <div class="container">
        <header>
            <h1 class="animated-title">
                <span class="heart left-heart">‚ù§Ô∏è</span>
                Finance Career Skills Tracker
                <span class="heart right-heart">‚ù§Ô∏è</span>
            </h1>            
            <p class="subtitle">Track your progress across PE, IB, Hedge Funds, Strategy Consulting & English</p>
        </header>




        <div id="career-section">
            <div class="career-grid">
                <div class="career-card" data-career="pe" onclick="selectCareer('pe')">
                    <div class="career-icon">üíº</div>
                    <div class="career-name">Private Equity</div>
                </div>
                <div class="career-card" data-career="ib" onclick="selectCareer('ib')">
                    <div class="career-icon">üè¶</div>
                    <div class="career-name">Investment Banking</div>
                </div>
                <div class="career-card" data-career="hf" onclick="selectCareer('hf')">
                    <div class="career-icon">üìà</div>
                    <div class="career-name">Hedge Funds</div>
                </div>
                <div class="career-card" data-career="sc" onclick="selectCareer('sc')">
                    <div class="career-icon">üéØ</div>
                    <div class="career-name">Strategy Consulting</div>
                </div>               
                <div class="career-card" data-career="fintech" onclick="selectCareer('fintech')">
                    <div class="career-icon">üí≥</div>
                    <div class="career-name">Fintech</div>
                </div>
                <div class="career-card" data-career="english" onclick="selectCareer('english')">
                    <div class="career-icon">üìñ</div>
                    <div class="career-name">English</div>
                </div>
                <div class="career-card" data-career="chinese" onclick="selectCareer('chinese')">
                    <div class="career-icon">üíû</div>
                    <div class="career-name">Chinese</div>
                </div>                

                <div class="career-card" data-career="tools" onclick="selectCareer('tools')">
                    <div class="career-icon">üõ†Ô∏è</div>
                    <div class="career-name">Finance Tools</div>
                </div>

                <div class="career-card" data-career="cfa1" onclick="selectCareer('cfa1')">
                    <div class="career-icon">üìú</div>
                    <div class="career-name">CFA Level 1</div>
                </div>
            </div>

            <div class="progress-overview">
                <div class="progress-header">
                    <h2 class="progress-title">
                        <span>üéØ</span> <span id="career-title">Private Equity</span> Progress
                    </h2>
                    <div class="progress-stats">
                        <span>üèÜ</span> <span id="total-progress">0.0</span>% Complete
                    </div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="career-progress-bar" style="width: 0%"></div>
                </div>
            </div>

            <div class="main-content">
                <div class="skills-section">
                    <h2 id="currentCareerTitle">Courses</h2>
                    <div id="skillsContainer">
                        <!-- Skills will be dynamically loaded here -->
                    </div>
                </div>

                <div class="sidebar">
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">üìä Your Progress</h3>
                        <div class="gamification-stats">
                            <div class="level-container">
                                <span class="level-icon"><i class="fas fa-trophy"></i></span>
                                <span class="level-text" id="levelBadge">Level 1</span>
                            </div>
                            <div class="points-container">
                                <span class="points-icon"><i class="fas fa-star"></i></span>
                                <span class="points-text" id="pointsDisplay">0 XP</span>
                            </div>
                            <div class="streak-container">
                                <span class="streak-icon"><i class="fas fa-fire"></i></span>
                                <span class="streak-text" id="streakDisplay">0 day streak</span>
                            </div>
                        </div>
                        <div class="total-hours" id="totalHours">0.0 hours</div>

                        <div style="margin: 15px 0; text-align: center; font-size: 0.95rem; color: var(--text-dark); font-weight: 600;">
                            <span id="dailyStudyInfo">Today: 0.0 hours</span> | 
                            <span id="totalStudyInfo">Total: 0.0 hours</span>
                        </div>

                        <div class="chart-container" style="height: 140px; margin: 15px 0; background: #f8fafc; border-radius: var(--radius-md);">
                            <canvas id="dailyStudyChart"></canvas>
                        </div>
                    
                        <div class="meme-widget" onclick="getRandomMeme()">
                            <div class="meme-image-container">
                                <img id="memeImage" src="" alt="Random Meme" style="width: 100%; height: auto; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); cursor: pointer;" />
                            </div>
                            <div class="meme-caption" id="memeCaption"></div>
                        </div>                        
                        <div class="chart-container">
                            <canvas id="progressChart"></canvas>
                        </div>
                        <div id="achievements">
                        </div>
                    </div>
 
                    <!-- - Goal Setting Section - -->
                    <div class="sidebar-card" id="goalsSection">
                        <h3 class="sidebar-title">
                            <span>üéØ</span>
                            <span id="goalsCareerTitle" class="career-title">Private Equity</span> Goals
                        </h3>

                        <button class="goal-add-btn" onclick="openAddGoalModal()">
                            ‚ûï Add New Goal
                        </button>

                        <div class="goal-progress-summary">
                            <h4 class="goal-progress-title">üéØ Goal Completion</h4>
                            <div class="chart-container" style="height: 120px; margin: 12px 0;">
                                <canvas id="goalProgressChart"></canvas>
                            </div>
                            <div class="goal-progress-text" id="goalProgressSummary">
                                0/0 goals completed
                            </div>
                        </div>

                        <div id="goalsContainer">
                            <p class="goal-empty-state">No goals added yet. Create one to track your progress.</p>
                        </div>
                    </div>                                      

                    <!-- - LEARNING MOOD WIDGET --->
                    <div class="sidebar-card" id="learningMoodWidget">
                        <div class="random-skill">
                            <h4><span>üí°</span> Suggested Skill</h4>
                            <div id="learningMoodSkillText">Loading...</div>
                        </div>

                        <div class="mood-selector">
                            <h4 class="mood-title">Choose Your Focus</h4>
                            <div class="mood-buttons">
                                <button class="mood-btn" data-mood="focused">Focused</button>
                                <button class="mood-btn" data-mood="creative">Creative</button>
                                <button class="mood-btn" data-mood="analytical">Analytical</button>
                                <button class="mood-btn" data-mood="random">Random</button>
                            </div>
                        </div>
                    </div>
                    <!-- - End Learning Mood Widget -->

                    <div class="sidebar-card">
                        <h3 class="sidebar-title">‚è±Ô∏è Focus Timer</h3>
                        <div id="timerDisplay" style="text-align: center; font-size: 1.8rem; font-weight: bold; color: #3b82f6; margin: 15px 0; padding: 10px; background-color: #f8fafc; border-radius: var(--radius-md);">
        25:00
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                                <button class="add-time-btn" onclick="startTimer()">‚ñ∂ Start</button>
                                <button class="add-time-btn" onclick="pauseTimer()" style="background: #e74c3c;">‚è∏ Pause</button>
                                <button class="add-time-btn" onclick="resetTimer()" style="background: #95a5a6;">üîÑ Reset</button>
                        </div>
                        <div style="margin-top: 18px; text-align: center;">
                            <a href="https://cool-timer.com/" target="_blank" 
                            style="display: inline-block; 
                                    padding: 10px 16px; 
                                    background: linear-gradient(135deg, #3b82f6, #60a5fa); 
                                    color: white; 
                                    border-radius: 20px; 
                                    text-decoration: none; 
                                    font-weight: 600; 
                                    font-size: 0.9rem; 
                                    box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
                                    transition: all 0.3s ease;
                                    margin-top: 8px;">
                                üåê Try Cool-Timer.com
                            </a>
                        </div>
                    </div>

                    <div class="sidebar-card">
                        <h3 class="sidebar-title">üìù Session Notes</h3>
                        <textarea id="sessionNote" 
                            placeholder="Ghi ch√∫ nh·ªØng ƒëi·ªÅu ƒë√£ h·ªçc ƒë∆∞·ª£c h√¥m nay..." 
                            style="width: 100%; min-height: 100px; padding: 12px; margin: 10px 0; border-radius: var(--radius-md); border: 1px solid var(--border-color); background: var(--bg-white); color: var(--text-dark); resize: vertical;"
                        ></textarea>
                        <button class="add-time-btn" onclick="logSession()" style="width: 100%;">
                            üìù Log Session
                        </button>
                        <div id="sessionLogsContainer" style="margin-top: 20px; max-height: 300px; overflow-y: auto;">
                            <!-- Session logs will appear here -->
                        </div>
                    </div>

        <!-- - Course Manager Section - -->
        <div id="course-section" class="hidden">
            <div class="sidebar-card">
                <h3 class="sidebar-title">
                    <span> </span>
                    <span id="courseCareerTitle" class="career-title">Private Equity</span> Courses
                </h3>

                <button class="goal-add-btn" onclick="openAddCourseModal()">
                    ‚ûï Add New Course
                </button>
                <div id="coursesContainer">
                    <p class="goal-empty-state">No courses added yet for this career. Click 'Add Course' to get started.</p>
                </div>
            </div>
        </div>

        <!-- --- Course Modals --- -->
        <!-- Add Course/Edit Course Modal -->
        <div id="courseModal" class="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:9999; align-items:center; justify-content:center;">
            <div class="modal-content" style="background:var(--bg-white); padding:20px; border-radius:10px; width:90%; max-width:500px; box-shadow:var(--shadow-lg);">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 id="courseModalTitle" style="margin:0;">‚ûï Add New Course</h3>
                    <button onclick="closeCourseModal()" style="background:none; border:none; font-size:24px; cursor:pointer; color: var(--text-dark);">&times;</button>
                </div>
                <form id="courseForm">
                    <input type="hidden" id="editCourseId">
                    <div style="margin-bottom: 12px;">
                        <label for="courseTitle" style="display: block; margin-bottom: 5px; font-weight: 500;">Course Title *</label>
                        <input type="text" id="courseTitle" required style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label for="courseCareer" style="display: block; margin-bottom: 5px; font-weight: 500;">Career Path *</label>
                        <select id="courseCareer" required style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                            <option value="pe">üíº Private Equity</option>
                            <option value="ib">üè¶ Investment Banking</option>
                            <option value="hf">üìà Hedge Funds</option>
                            <option value="sc">üéØ Strategy Consulting</option>
                            <option value="fintech">üí≥ Fintech</option>
                            <option value="english">üö© English</option>
                            <option value="chinese">üíû Chinese</option>
                            <option value="tools">üõ†Ô∏è Finance Tools</option>
                            <option value="cfa1">üìú CFA Level 1</option>
                            <option value="general">üìä General Finance</option>
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                        <div>
                            <label for="courseDifficulty" style="display: block; margin-bottom: 5px; font-weight: 500;">Difficulty</label>
                            <select id="courseDifficulty" style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                                <option value="Beginner">üü¢ Beginner</option>
                                <option value="Intermediate" selected>üü° Intermediate</option>
                                <option value="Advanced">üî¥ Advanced</option>
                            </select>
                        </div>
                        <div>
                            <label for="coursePriority" style="display: block; margin-bottom: 5px; font-weight: 500;">Priority</label>
                            <select id="coursePriority" style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                                <option value="High">üî∫ High</option>
                                <option value="Medium" selected>üî∏ Medium</option>
                                <option value="Low">üîª Low</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label for="courseUrl" style="display: block; margin-bottom: 5px; font-weight: 500;">Course URL</label>
                        <input type="text" id="courseUrl" placeholder="https://example.com" style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                        <div>
                            <label for="courseEstHours" style="display: block; margin-bottom: 5px; font-weight: 500;">Estimated Hours</label>
                            <input type="number" id="courseEstHours" min="0.5" step="0.5" value="5" style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                        </div>
                        <div>
                            <label for="courseDeadline" style="display: block; margin-bottom: 5px; font-weight: 500;">Deadline (Optional)</label>
                            <input type="date" id="courseDeadline" style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label for="courseDescription" style="display: block; margin-bottom: 5px; font-weight: 500;">Description</label>
                        <textarea id="courseDescription" rows="3" style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark); resize: vertical;"></textarea>
                    </div>
                    <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 15px;">
                        <button type="button" class="add-time-btn" onclick="closeCourseModal()" style="background: #95a5a6;">Cancel</button>
                        <button type="submit" class="add-time-btn">üíæ Save Course</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Hours Modal -->
        <div id="addHoursModal" class="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:9999; align-items:center; justify-content:center;">
            <div class="modal-content" style="background:var(--bg-white); padding:20px; border-radius:10px; width:90%; max-width:400px; box-shadow:var(--shadow-lg);">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 style="margin:0;">‚è±Ô∏è Add Hours</h3>
                    <button onclick="closeAddHoursModal()" style="background:none; border:none; font-size:24px; cursor:pointer; color: var(--text-dark);">&times;</button>
                </div>
                <form id="addHoursForm">
                    <input type="hidden" id="addHoursCourseId">
                    <div style="margin-bottom: 15px;">
                        <label for="hoursToAdd" style="display: block; margin-bottom: 5px; font-weight: 500;">Hours Studied *</label>
                        <input type="number" id="hoursToAdd" min="0.1" step="0.1" required style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                    </div>
                    <div style="display: flex; gap: 8px; justify-content: flex-end;">
                        <button type="button" class="add-time-btn" onclick="closeAddHoursModal()" style="background: #95a5a6;">Cancel</button>
                        <button type="submit" class="add-time-btn">‚ûï Add Hours</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- --- End Course Modals --- -->


        <!-- ===== INVESTMENT MEMO SIDEBAR CARD ===== -->
        <div class="sidebar-card">
            <h3 class="sidebar-title">Investment Analyses</h3>
            
            <!-- Filters & Add Button -->
            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <select id="analysisTypeFilter" onchange="filterAnalyses()" class="filter-select">
                    <option value="all">All Types</option>
                    <option value="stock_pitch">üìä Stock Pitch</option>
                    <option value="lbo">üí∞ LBO Model</option>
                    <option value="dcf">üìà DCF Valuation</option>
                    <option value="ma">ü§ù M&A Analysis</option>
                    <option value="industry">üìë Industry Report</option>
                </select>

                <button class="add-analysis-btn" onclick="openAnalysisModal()">
                    <i class="fas fa-plus"></i> Add New
                </button>

            </div>
            
            <!-- Counter -->
            <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px;">
                Total Analyses: <span id="analysisCount">0</span>
            </div>
            
            <!-- Analysis Cards Container -->
            <div id="analysisCardsContainer">
                <!-- Cards s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
            </div>
        </div>






        <!-- ===== INVESTMENT ANALYSIS MODAL (UPGRADED) ===== -->
        <div id="analysisModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
            <div class="modal-content" style="background-color: var(--bg-white); margin: 5% auto; padding: 20px; border-radius: var(--radius-lg); width: 90%; max-width: 700px; max-height: 85vh; overflow-y: auto; box-shadow: var(--shadow-xl); border: 1px solid var(--border-color);">
                <!-- Modal Header -->
                <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color);">
                    <h3 id="analysisModalTitle" style="margin: 0; font-size: 1.2rem; color: var(--text-dark);">Add New Investment Analysis</h3>
                    <button onclick="closeAnalysisModal()" class="modal-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">
                    <form id="analysisForm">
                        <input type="hidden" id="analysisId">

                        <div class="form-group" style="margin-bottom: 16px;">
                            <label for="analysisTitle" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Title *</label>
                            <input type="text" id="analysisTitle" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div class="form-group">
                                <label for="analysisType" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Type *</label>
                                <select id="analysisType" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                                    <option value="">Select Type</option>
                                    <option value="stock_pitch">üìä Stock Pitch</option>
                                    <option value="lbo">üí∞ LBO Model</option>
                                    <option value="dcf">üìà DCF Valuation</option>
                                    <option value="ma">ü§ù M&A Analysis</option>
                                    <option value="industry">üìë Industry Report</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="analysisDate" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Date *</label>
                                <input type="date" id="analysisDate" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 16px;">
                            <label for="analysisThesis" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Investment Thesis *</label>
                            <textarea id="analysisThesis" rows="4" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);"></textarea>
                        </div>

                        <div class="form-group" style="margin-bottom: 16px;">
                            <label for="analysisTags" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Tags (comma separated)</label>
                            <input type="text" id="analysisTags" placeholder="e.g., Technology, Vietnam, Growth" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                        </div>

                        <details style="margin-bottom: 16px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); padding: 12px; background: var(--bg-light);">
                            <summary style="font-weight: 500; cursor: pointer; padding: 6px 0; color: var(--text-dark);">Key Metrics (Optional)</summary>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                <div class="form-group">
                                    <label for="currentPrice" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Current Price</label>
                                    <input type="text" id="currentPrice" placeholder="e.g., $150.00" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                </div>
                                <div class="form-group">
                                    <label for="targetPrice" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Target Price</label>
                                    <input type="text" id="targetPrice" placeholder="e.g., $180.00" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                </div>
                                <div class="form-group">
                                    <label for="upside" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Upside</label>
                                    <input type="text" id="upside" placeholder="e.g., 20%" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                </div>
                                <div class="form-group">
                                    <label for="peRatio" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">P/E Ratio</label>
                                    <input type="text" id="peRatio" placeholder="e.g., 15x" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                </div>
                                <div class="form-group">
                                    <label for="recommendation" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Recommendation</label>
                                    <select id="recommendation" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                        <option value="">Select</option>
                                        <option value="BUY">BUY</option>
                                        <option value="HOLD">HOLD</option>
                                        <option value="SELL">SELL</option>
                                    </select>
                                </div>
                            </div>
                        </details>

                        <details style="margin-bottom: 16px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); padding: 12px; background: var(--bg-light);">
                            <summary style="font-weight: 500; cursor: pointer; padding: 6px 0; color: var(--text-dark);">Links (Optional)</summary>
                            <div style="margin-top: 10px;">
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <label for="pitchDeckLink" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Pitch Deck Link</label>
                                    <input type="url" id="pitchDeckLink" placeholder="https://..." style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                </div>
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <label for="excelModelLink" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Excel Model Link</label>
                                    <input type="url" id="excelModelLink" placeholder="https://..." style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                </div>
                                <div class="form-group">
                                    <label for="notesLink" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Notes Link</label>
                                    <input type="url" id="notesLink" placeholder="https://..." style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                </div>
                            </div>
                        </details>

                        <!-- Modal Footer -->
                        <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                            <button type="button" onclick="closeAnalysisModal()" class="btn-secondary" style="padding: 8px 16px; font-size: 0.85rem;">Cancel</button>
                            <button type="submit" class="btn-primary" style="padding: 8px 16px; font-size: 0.85rem;">Save Analysis</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>




        <!-- ===== DEAL DIARY SIDEBAR CARD ===== -->
        <div class="sidebar-card">
            <h3 class="sidebar-title">DEAL DIARY</h3>
            
            <!-- Filters & Add Button -->
            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <select id="dealTypeFilter" onchange="filterDeals()" class="filter-select">                
                    <option value="all">All Types</option>
                    <option value="M&A">ü§ù M&A</option>
                    <option value="LBO">üí∞ LBO</option>
                    <option value="IPO">üöÄ IPO</option>
                    <option value="Restructuring">üîÑ Restructuring</option>
                </select>

                <button class="add-deal-btn" onclick="openDealModal()">
                    <i class="fas fa-plus"></i> Add Deal
                </button>

            </div>
            
            <!-- Counter -->
            <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px;">
                Total Deals: <span id="dealCount">0</span>
            </div>
            
            <!-- Deal Cards Container -->
            <div id="dealCardsContainer">
                <!-- Cards s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
            </div>
        </div>



        <!-- ===== DEAL DIARY MODAL ===== -->
        <div id="dealModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
            <div class="modal-content" style="background-color: var(--bg-white); margin: 5% auto; padding: 20px; border-radius: var(--radius-lg); width: 90%; max-width: 700px; max-height: 85vh; overflow-y: auto; box-shadow: var(--shadow-xl); border: 1px solid var(--border-color);">
                <!-- Modal Header -->
                <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color);">
                    <h3 id="dealModalTitle" style="margin: 0; font-size: 1.2rem; color: var(--text-dark);">Add New Deal</h3>
                    <button onclick="closeDealModal()" class="modal-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">
                    <form id="dealForm">
                        <input type="hidden" id="dealId">

                        <div class="form-group" style="margin-bottom: 16px;">
                            <label for="dealName" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Deal Name *</label>
                            <input type="text" id="dealName" required placeholder="e.g., Microsoft acquires Activision Blizzard" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div class="form-group">
                                <label for="dealType" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Deal Type *</label>
                                <select id="dealType" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                                    <option value="">Select Type</option>
                                    <option value="M&A">ü§ù M&A</option>
                                    <option value="LBO">üí∞ LBO</option>
                                    <option value="IPO">üöÄ IPO</option>
                                    <option value="Restructuring">üîÑ Restructuring</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dealValue" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Deal Value</label>
                                <input type="text" id="dealValue" placeholder="e.g., $68.7B" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div class="form-group">
                                <label for="dealStatus" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Status *</label>
                                <select id="dealStatus" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                                    <option value="closed">‚úÖ Closed</option>
                                    <option value="announced">üì¢ Announced</option>
                                    <option value="rumored">üîç Rumored</option>
                                    <option value="terminated">‚ùå Terminated</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dealDate" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Date *</label>
                                <input type="date" id="dealDate" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div class="form-group">
                                <label for="dealBuyer" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Buyer/Issuer</label>
                                <input type="text" id="dealBuyer" placeholder="e.g., Microsoft" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                            </div>
                            <div class="form-group">
                                <label for="dealTarget" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Target/Company</label>
                                <input type="text" id="dealTarget" placeholder="e.g., Activision Blizzard" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);">
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 16px;">
                            <label for="dealLearnings" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Key Learnings *</label>
                            <textarea id="dealLearnings" rows="4" required placeholder="What did you learn from this deal? What made it succeed/fail?" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-light); color: var(--text-dark); transition: var(--transition);"></textarea>
                        </div>

                        <details style="margin-bottom: 16px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); padding: 12px; background: var(--bg-light);">
                            <summary style="font-weight: 500; cursor: pointer; padding: 6px 0; color: var(--text-dark);">Additional Links</summary>
                            <div style="margin-top: 10px;">
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <label for="pressReleaseLink" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Press Release</label>
                                    <input type="url" id="pressReleaseLink" placeholder="https://..." style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                </div>
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <label for="analysisLink" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Deal Analysis</label>
                                    <input type="url" id="analysisLink" placeholder="https://..." style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                </div>
                                <div class="form-group">
                                    <label for="filingLink" style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Regulatory Filing</label>
                                    <input type="url" id="filingLink" placeholder="https://..." style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); background: var(--bg-white); color: var(--text-dark);">
                                </div>
                            </div>
                        </details>

                        <!-- Modal Footer -->
                        <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                            <button type="button" onclick="closeDealModal()" class="btn-secondary" style="padding: 8px 16px; font-size: 0.85rem;">Cancel</button>
                            <button type="submit" class="btn-primary" style="padding: 8px 16px; font-size: 0.85rem;">Save Deal</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>




        <!-- ===== SLEEP TRACKER SIDEBAR CARD ===== -->
        <div class="sidebar-card">
            <h3 class="sidebar-title">‚è±Ô∏è Sleep Tracker</h3>
            <div id="sleepStatus" style="text-align: center; font-size: 1.1rem; margin: 10px 0;">
                üò¥ Ready to sleep
            </div>
            <div id="sleepTimerDisplay" style="font-size: 2rem; text-align: center; font-weight: bold; color: var(--primary); margin: 10px 0; display: none;">
                00:00:00
            </div>
            
            <!-- Control Buttons -->
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button id="startSleepBtn" class="add-time-btn" onclick="startSleepTracking()" style="flex: 1; background: #27ae60;">‚ñ∂ Start</button>
                <button id="stopSleepBtn" class="add-time-btn" onclick="stopSleepTracking()" style="flex: 1; background: #e74c3c; display: none;">‚è∏ Stop</button>
                <button class="add-time-btn" onclick="openManualSleepModal()" style="flex: 1; background: #3498db;">‚ûï Manual</button>
            </div>
            
            <!-- Sleep Chart -->
            <div class="chart-container" style="margin: 20px 0;">
                <canvas id="sleepChart"></canvas>
            </div>
            
            <!-- Sleep History -->
            <div style="margin-top: 20px;">
                <h4 style="font-size: 1rem; font-weight: 600; color: var(--text-dark); margin-bottom: 10px;">üìú Recent Sessions</h4>
                <div id="sleepHistoryContainer" style="max-height: 300px; overflow-y: auto;">
                    <!-- History will render here -->
                </div>
            </div>
        </div>


        <!-- ===== READING LIST SIDEBAR CARD ===== -->      
        <div class="sidebar-card" id="readingListCard">
            <h3 class="sidebar-title">
                <span class="sidebar-title-icon">üìö</span>
                <span class="sidebar-title-text">Reading List</span>
            </h3>

            <button class="add-time-btn" onclick="openAddBookModal()" style="margin-bottom: 15px; width: 100%;">
                ‚ûï Add Book
            </button>

            <div class="stats-section">
                <div class="stat-item">
                    <div class="stat-emoji">üìñ</div>
                    <div class="stat-label">Total</div>
                    <div class="stat-value" id="totalCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-emoji">üìö</div>
                    <div class="stat-label">Reading</div>
                    <div class="stat-value" id="readingCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-emoji">‚úÖ</div>
                    <div class="stat-label">Finished</div>
                    <div class="stat-value" id="finishedCount">0</div>
                </div>
            </div>

            <div class="reading-list-section">
                <div class="reading-controls">
                    <select id="genreFilter" title="Filter by Genre">
                        <option value="all">All Genres</option>
                        <option value="Fiction">Fiction</option>
                        <option value="Non-Fiction">Non-Fiction</option>
                        <option value="Science">Science</option>
                        <option value="Technology">Technology</option>
                        <option value="Finance">Finance</option>
                        <option value="Biography">Biography</option>
                        <option value="History">History</option>
                        <option value="Philosophy">Philosophy</option>
                        <option value="Self-Help">Self-Help</option>
                        <option value="Fantasy">Fantasy</option>
                        <option value="Mystery">Mystery</option>
                        <option value="Psychology">Psychology</option>
                        <option value="Business">Business</option>
                        <option value="Politics">Politics</option>
                        <option value="Other">Other</option>
                    </select>
                    <select id="sortReadingList" title="Sort by">
                        <option value="default">Sort: Added</option>
                        <option value="titleAsc">Title (A-Z)</option>
                        <option value="titleDesc">Title (Z-A)</option>
                        <option value="ratingAsc">Rating (Low-High)</option>
                        <option value="ratingDesc">Rating (High-Low)</option>
                    </select>
                    <input type="text" id="searchInput" placeholder="üîç Search books..." style="max-width: 150px;">
                </div>

                <div class="reading-container" id="readingListContainer">
                    <div class="empty-state">No books added yet. Click 'Add Book' to get started.</div>
                </div>
            </div>
        </div>


        <!-- ===== ADD CUSTOM QUOTE CARD ===== -->
        <div class="sidebar-card" style="margin-top: 20px;">
            <h3 class="sidebar-title">‚ûï Add Your Own Quote</h3>
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">
                    Quote Text *
                </label>
                <textarea 
                    id="customQuoteText" 
                    placeholder="Enter your motivational quote..." 
                    rows="3"
                    style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-white); color: var(--text-dark); resize: vertical; font-size: 0.95rem;">
                </textarea>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">
                    Author (Optional)
                </label>
                <input 
                    type="text" 
                    id="customQuoteAuthor" 
                    placeholder="e.g., Jamie Dimon" 
                    style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-white); color: var(--text-dark); font-size: 0.95rem;">
            </div>
            <button 
                onclick="addCustomQuote()" 
                class="add-time-btn" 
                style="width: 100%; background: linear-gradient(135deg, #f59e0b, #f97316); margin-bottom: 10px;">
                ‚ûï Add Quote
            </button>

            <!-- Stats: How many custom quotes -->
            <div style="text-align: center; font-size: 0.85rem; color: var(--text-muted); padding: 8px; background: var(--bg-light); border-radius: 6px;">
                üìù Custom Quotes: <strong id="customQuotesCount">0</strong>
            </div>
            
            <!-- Button to manage custom quotes -->
            <button 
                onclick="openManageQuotesModal()" 
                class="add-time-btn" 
                style="width: 100%; background: var(--bg-light); color: var(--text-dark); border: 1px solid var(--border-color); margin-top: 10px;">
                üìã Manage My Quotes
            </button>
        </div>


        <!-- ===== CUSTOM MEME MANAGER ===== -->
        <div class="sidebar-card" style="margin-top: 20px;">
            <h3 class="sidebar-title">üé≠ Manage Memes</h3>
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">
                    Add Meme URL
                </label>
                <input 
                    type="url" 
                    id="customMemeUrl" 
                    placeholder="https://example.com/image.jpg" 
                    style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-white); color: var(--text-dark); font-size: 0.95rem;">
            </div>
            <button 
                onclick="addCustomMeme()" 
                class="add-time-btn" 
                style="width: 100%; background: linear-gradient(135deg, #8b5cf6, #a78bfa); margin-bottom: 10px;">
                ‚ûï Add Meme
            </button>
            <div style="text-align: center; font-size: 0.85rem; color: var(--text-muted); padding: 8px; background: var(--bg-light); border-radius: 6px;">
                üì∏ Custom Memes: <strong id="customMemesCount">0</strong>
            </div>
            
            <button 
                onclick="openManageMemesModal()" 
                class="add-time-btn" 
                style="width: 100%; background: var(--bg-light); color: var(--text-dark); border: 1px solid var(--border-color); margin-top: 10px;">
                üìã Manage My Memes
            </button>
        </div>

        <!-- Add Book Modal -->
        <div id="addBookModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚ûï Add New Book</h3>
                    <button class="modal-close" onclick="closeAddBookModal()">&times;</button>
                </div>
                <form id="addBookForm">
                    <div class="form-group">
                        <label for="bookTitle">Book Title *</label>
                        <input type="text" id="bookTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="bookAuthor">Author *</label>
                        <input type="text" id="bookAuthor" required>
                    </div>
                    <div class="form-group">
                        <label for="bookCoverUrl">Cover Image URL (Optional)</label>
                        <input type="text" id="bookCoverUrl" placeholder="https://example.com/book.jpg">
                    </div>
                    <div class="form-group">
                        <label for="bookGenre">Genre *</label>
                        <select id="bookGenre" required>
                            <option value="">Select a Genre</option>
                            <option value="Fiction">Fiction</option>
                            <option value="Non-Fiction">Non-Fiction</option>
                            <option value="Biography">Biography</option>
                            <option value="Business">Business</option>
                            <option value="Finance">Finance</option>
                            <option value="Technology">Technology</option>
                            <option value="Self-Help">Self-Help</option>
                            <option value="Psychology">Psychology</option>
                            <option value="History">History</option>
                            <option value="Science">Science</option>
                            <option value="Philosophy">Philosophy</option>
                            <option value="Politics">Politics</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bookStatus">Status *</label>
                        <select id="bookStatus" required>
                            <option value="want">Want to Read</option>
                            <option value="reading">Reading</option>
                            <option value="finished">Finished</option>
                        </select>
                    </div>
                    <!-- ADD THESE MISSING FIELDS -->
                    <div class="form-group">
                        <label for="bookRating">Rating (1-5 stars)</label>
                        <select id="bookRating">
                            <option value="">No rating</option>
                            <option value="1">‚≠ê</option>
                            <option value="2">‚≠ê‚≠ê</option>
                            <option value="3">‚≠ê‚≠ê‚≠ê</option>
                            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bookReview">Review (Optional)</label>
                        <textarea id="bookReview" rows="3" placeholder="Your thoughts about this book..."></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="add-time-btn btn-secondary" onclick="closeAddBookModal()">Cancel</button>
                        <button type="submit" class="add-time-btn">‚ûï Add Book</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- End Add Book Modal -->


        <!-- Edit Book Modal -->
        <div id="editBookModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚úèÔ∏è Edit Book</h3>
                    <button class="modal-close" onclick="closeEditBookModal()">&times;</button>
                </div>
                <form id="editBookForm">
                    <input type="hidden" id="editBookId">
                    <div class="form-group">
                        <label for="editBookTitle">Book Title *</label>
                        <input type="text" id="editBookTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="editBookAuthor">Author *</label>
                        <input type="text" id="editBookAuthor" required>
                    </div>
                    <div class="form-group">
                        <label for="editBookCoverUrl">Cover Image URL (Optional)</label>
                        <input type="text" id="editBookCoverUrl" placeholder="https://example.com/book.jpg">
                    </div>
                    <div class="form-group">
                        <label for="editBookGenre">Genre *</label>
                        <select id="editBookGenre" required>
                            <option value="">Select a Genre</option>
                            <option value="Fiction">Fiction</option>
                            <option value="Non-Fiction">Non-Fiction</option>
                            <option value="Biography">Biography</option>
                            <option value="Business">Business</option>
                            <option value="Finance">Finance</option>
                            <option value="Technology">Technology</option>
                            <option value="Self-Help">Self-Help</option>
                            <option value="Psychology">Psychology</option>
                            <option value="History">History</option>
                            <option value="Science">Science</option>
                            <option value="Philosophy">Philosophy</option>
                            <option value="Politics">Politics</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editBookStatus">Status *</label>
                        <select id="editBookStatus" required>
                            <option value="want">Want to Read</option>
                            <option value="reading">Reading</option>
                            <option value="finished">Finished</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 12px;">
                        <label for="editBookRating" style="display: block; margin-bottom: 5px; font-weight: 500;">Rating (1-5 sao)</label>
                        <select id="editBookRating" style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                            <option value="">Ch∆∞a ƒë√°nh gi√°</option>
                            <option value="1">‚≠ê</option>
                            <option value="2">‚≠ê‚≠ê</option>
                            <option value="3">‚≠ê‚≠ê‚≠ê</option>
                            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label for="editBookReview" style="display: block; margin-bottom: 5px; font-weight: 500;">Review</label>
                        <textarea id="editBookReview" rows="3" style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark); resize: vertical;"></textarea>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="add-time-btn btn-secondary" onclick="closeEditBookModal()">Cancel</button>
                        <button type="submit" class="add-time-btn">üíæ Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- End Edit Book Modal -->

        

        
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">Data Management</h3>
                        <button class="export-btn" onclick="exportProgress()">
                            üì• Export Progress
                        </button>
                        <button class="import-btn" onclick="document.getElementById('importFile').click()">
                            üì§ Import Progress
                        </button>
                        <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importProgress(event)">
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Correlation Analytics Dashboard -->
    <div class="correlation-dashboard" id="correlationDashboard">
        <div class="correlation-header">
            <h2 class="correlation-title">
                <span>üìä</span>
                <span>Correlation Analytics</span>
            </h2>
        </div>
        
        <!-- Key Insights -->
        <div class="correlation-insights" id="correlationInsights">
            <!-- Insights will be generated here -->
        </div>
        
        <!-- Charts -->
        <div class="chart-grid">
            <!-- Sleep vs Study Productivity -->
            <div class="chart-card">
                <div class="chart-card-title">
                    üò¥ Sleep vs Study Productivity
                </div>
                <canvas id="sleepStudyChart" style="max-height: 300px;"></canvas>
            </div>
            
            <!-- Skill Progress vs Goal Completion -->
            <div class="chart-card">
                <div class="chart-card-title">
                    üéØ Skills vs Goals Completion
                </div>
                <canvas id="skillGoalChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>



    <!-- --- Motivational Quote Card --- -->
    <div id="quoteCard" onclick="getRandomQuote()">
        <div class="quote-icon">
            <i class="fas fa-quote-left"></i>
        </div>
        <div id="quoteText">Loading your first quote of inspiration...</div>
        <div id="quoteAuthor">- Your Future Self</div>
    </div>
    <!-- --- End Motivational Quote Card --- -->


    <!-- IMPROVED GOAL MODAL - Replace existing #goalModal -->
    <div id="goalModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 id="goalModalTitle">‚ûï Add New Goal</h3>
                <button onclick="closeGoalModal()" style="background:none; border:none; font-size:24px; cursor:pointer; color: var(--text-dark);">&times;</button>
            </div>
            
            <form id="goalForm">
                <input type="hidden" id="editGoalId">
                
                <!-- Step 1: Goal Title -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-dark);">
                        üìù Goal Title *
                    </label>
                    <input type="text" id="goalTitle" required 
                        placeholder="e.g., Master Financial Modeling"
                        style="width:100%; padding:12px; border:1px solid var(--border-color); border-radius:8px; background: var(--bg-white); color: var(--text-dark); font-size: 1rem;">
                </div>

                <!-- Step 2: Goal Type Selection -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: var(--text-dark);">
                        üéØ Goal Type *
                    </label>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <!-- Study Hours Option -->
                        <div class="goal-type-option" data-type="study_hours" onclick="selectGoalType('study_hours')" 
                            style="padding: 16px; border: 2px solid var(--border-color); border-radius: 12px; cursor: pointer; text-align: center; transition: all 0.3s ease; background: var(--bg-white);">
                            <div style="font-size: 2rem; margin-bottom: 8px;">üìö</div>
                            <div style="font-weight: 600; margin-bottom: 4px; color: var(--text-dark);">Study Hours</div>
                            <div style="font-size: 0.85rem; color: var(--text-muted);">Auto-syncs</div>
                        </div>

                        <!-- Skill Mastery Option -->
                        <div class="goal-type-option" data-type="skill_mastery" onclick="selectGoalType('skill_mastery')"
                            style="padding: 16px; border: 2px solid var(--border-color); border-radius: 12px; cursor: pointer; text-align: center; transition: all 0.3s ease; background: var(--bg-white);">
                            <div style="font-size: 2rem; margin-bottom: 8px;">üéØ</div>
                            <div style="font-weight: 600; margin-bottom: 4px; color: var(--text-dark);">Skill Mastery</div>
                            <div style="font-size: 0.85rem; color: var(--text-muted);">Track specific skill</div>
                        </div>

                        <!-- Custom Goal Option -->
                        <div class="goal-type-option" data-type="custom" onclick="selectGoalType('custom')"
                            style="padding: 16px; border: 2px solid var(--border-color); border-radius: 12px; cursor: pointer; text-align: center; transition: all 0.3s ease; background: var(--bg-white);">
                            <div style="font-size: 2rem; margin-bottom: 8px;">‚úÖ</div>
                            <div style="font-weight: 600; margin-bottom: 4px; color: var(--text-dark);">Custom</div>
                            <div style="font-size: 0.85rem; color: var(--text-muted);">Manual tracking</div>
                        </div>
                    </div>
                    <input type="hidden" id="goalType" required>
                </div>

                <!-- Step 3: Type-Specific Fields (Dynamic) -->
                <div id="goalTypeSpecificFields"></div>

                <!-- Step 4: Target & Deadline -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: var(--text-dark);">
                            üéØ Target Value *
                        </label>
                        <input type="number" id="goalTarget" min="0" step="0.1" required 
                            placeholder="e.g., 100"
                            style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: var(--text-dark);">
                            üìÖ Deadline (Optional)
                        </label>
                        <input type="date" id="goalDeadline" 
                            style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                    </div>
                </div>

                <!-- Actions -->
                <div style="display: flex; gap: 10px; justify-content: flex-end; padding-top: 10px; border-top: 1px solid var(--border-color);">
                    <button type="button" onclick="closeGoalModal()" 
                        style="padding: 10px 20px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-light); color: var(--text-dark); cursor: pointer; font-weight: 500;">
                        Cancel
                    </button>
                    <button type="submit" 
                        style="padding: 10px 20px; border: none; border-radius: 8px; background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; cursor: pointer; font-weight: 600;">
                        üíæ Save Goal
                    </button>
                </div>
            </form>
        </div>
    </div>


    <!-- Update Custom Goal Progress Modal -->
    <div id="updateCustomGoalModal" class="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:9999; align-items:center; justify-content:center;">
        <div class="modal-content" style="background:var(--bg-white); padding:20px; border-radius:10px; width:90%; max-width:400px; box-shadow:var(--shadow-lg);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0;">Update Progress</h3>
                <button onclick="closeUpdateCustomGoalModal()" style="background:none; border:none; font-size:24px; cursor:pointer; color: var(--text-dark);">&times;</button>
            </div>
            <form id="updateCustomGoalForm">
                <input type="hidden" id="updateGoalId">
                <div style="margin-bottom: 12px;">
                    <label for="updateGoalValue" style="display: block; margin-bottom: 5px; font-weight: 500;">Current Progress</label>
                    <input type="number" id="updateGoalValue" min="0" step="0.1" required style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" onclick="closeUpdateCustomGoalModal()" style="padding: 10px 15px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-light); color: var(--text-dark); cursor: pointer;">Cancel</button>
                    <button type="submit" style="padding: 10px 15px; border: none; border-radius: 6px; background: var(--primary); color: white; cursor: pointer;">Update</button>
                </div>
            </form>
        </div>
    </div>
    <!-- - End Goal Modals - -->
 
    
    <!-- Edit Book Modal -->
    <div id="editBookModal" class="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:9999; align-items:center; justify-content:center;">
        <div class="modal-content" style="background:var(--bg-white); padding:20px; border-radius:10px; width:90%; max-width:500px; box-shadow:var(--shadow-lg);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0;">‚úèÔ∏è Edit Book</h3>
                <button onclick="closeEditBookModal()" style="background:none; border:none; font-size:24px; cursor:pointer; color: var(--text-dark);">&times;</button>
            </div>
            <form id="editBookForm">
                <input type="hidden" id="editBookId">
                <div style="margin-bottom: 12px;">
                    <label for="editBookTitle" style="display: block; margin-bottom: 5px; font-weight: 500;">Book Title *</label>
                    <input type="text" id="editBookTitle" required style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                </div>
                <div style="margin-bottom: 12px;">
                    <label for="editBookAuthor" style="display: block; margin-bottom: 5px; font-weight: 500;">Author *</label>
                    <input type="text" id="editBookAuthor" required style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                </div>
                <div style="margin-bottom: 12px;">
                    <label for="editBookCoverUrl" style="display: block; margin-bottom: 5px; font-weight: 500;">Cover Image URL (Optional)</label>
                    <input type="text" id="editBookCoverUrl" placeholder="https://example.com/book.jpg" style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                </div>
                <div style="margin-bottom: 12px;">
                    <label for="editBookGenre" style="display: block; margin-bottom: 5px; font-weight: 500;">Genre *</label>
                    <select id="editBookGenre" required style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                        <option value="">Select a Genre</option>
                        <option value="Fiction">Fiction</option>
                        <option value="Non-Fiction">Non-Fiction</option>
                        <option value="Biography">Biography</option>
                        <option value="Business">Business</option>
                        <option value="Finance">Finance</option>
                        <option value="Technology">Technology</option>
                        <option value="Self-Help">Self-Help</option>
                        <option value="Psychology">Psychology</option>
                        <option value="History">History</option>
                        <option value="Science">Science</option>
                        <option value="Philosophy">Philosophy</option>
                        <option value="Politics">Politics</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div style="margin-bottom: 12px;">
                    <label for="editBookStatus" style="display: block; margin-bottom: 5px; font-weight: 500;">Status *</label>
                    <select id="editBookStatus" required style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background: var(--bg-white); color: var(--text-dark);">
                        <option value="want">Want to Read</option>
                        <option value="reading">Reading</option>
                        <option value="finished">Finished</option>
                    </select>
                </div>
                <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 15px;">
                    <button type="button" class="add-time-btn" onclick="closeEditBookModal()" style="background: #95a5a6;">Cancel</button>
                    <button type="submit" class="add-time-btn">üíæ Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal xem to√†n b·ªô Review -->
    <div id="fullReviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="fullReviewTitle">Full Review</h3>
                <button class="modal-close" onclick="closeFullReviewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <pre id="fullReviewText" style="white-space: pre-wrap; word-wrap: break-word; max-height: 400px; overflow-y: auto; padding: 10px; background-color: #f5f5f5; border-radius: 4px; font-family: Arial, sans-serif; font-size: 14px; line-height: 1.5;"></pre>
            </div>
        </div>
    </div>

    <div id="bookDetailsModal" class="modal">
        <div class="modal-content">
           <div class="modal-header">
            <div>
                <h3 id="bookDetailsTitle">Book Title</h3>
                <p id="bookDetailsAuthor">by Author Name</p>
            </div>
            <button class="modal-close" onclick="closeBookDetailsModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div style="display: flex; gap: 15px; align-items: flex-start;">
                <img id="bookDetailsCover" src="" alt="Book Cover" style="width: 100px; height: 140px; object-fit: cover; border-radius: 6px; display: none;"> <!-- ·∫®n m·∫∑c ƒë·ªãnh -->
                <div style="flex-grow: 1;">
                    <p><strong>Genre:</strong> <span id="bookDetailsGenre">Genre</span></p>
                    <p><strong>Status:</strong> <span id="bookDetailsStatus" class="book-status-badge">Status</span></p>
                    <div id="bookDetailsRating" style="margin: 8px 0; color: #f59e0b; font-size: 1.1rem;"></div> <!-- ·∫®n m·∫∑c ƒë·ªãnh n·∫øu kh√¥ng c√≥ rating -->
                    <div id="bookDetailsReview" style="margin-top: 10px; font-style: italic;"></div> <!-- ·∫®n m·∫∑c ƒë·ªãnh n·∫øu kh√¥ng c√≥ review -->
                </div>
            </div>
        </div>
    </div>


    <script>


        let investmentAnalyses = [];
        let dealDiary = [];
        let sleepSessions = [];
        let customMemes = [];
        let customQuotes = [];
        


        function debounce(func, delay) {
            let timeout;
            return function() {
                const context = this;
                const args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }
        function checkLocalStorageAvailability() {
            try {
                const test = '__storage_test__';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch (e) {
                return false;
            }
        }
        function checkLocalStorageQuota() {
            if (!checkLocalStorageAvailability()) {
                return false;
            }
            const maxStorage = 5 * 1024 * 1024;
            let usedStorage = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    usedStorage += localStorage.getItem(key).length * 2; 
                }
            }
            if (usedStorage > maxStorage * 0.8) {
                return false; 
            }
            return true;
        }


    const skillsData = {
            pe: {
                title: "Private Equity Skills",
                categories: {
                    "Core Finance": {
                        icon: "üè¶",
                        color: "#e74c3c",
                        skills: [
                            { name: "LBO Modeling", time: "morning", importance: 5, targetHours: 160 },
                            { name: "DCF Valuation", time: "morning", importance: 5, targetHours: 120 },
                            { name: "Due Diligence", time: "morning", importance: 4, targetHours: 80 },
                            { name: "Scenario / Sensitivity Analysis", time: "afternoon", importance: 4, targetHours: 60 },
                            { name: "Deal Sourcing & Execution", time: "afternoon", importance: 4, targetHours: 100 },
                            { name: "Portfolio Management", time: "afternoon", importance: 4, targetHours: 140 },
                            { name: "Exit Strategies", time: "evening", importance: 3, targetHours: 50 },
                            { name: "Debt vs Equity Structuring", time: "afternoon", importance: 3, targetHours: 70 },
                            { name: "Capital Calls & Distribution Waterfalls", time: "afternoon", importance: 3, targetHours: 90 },
                            { name: "Operational Value Creation", time: "evening", importance: 3, targetHours: 110 },
                            { name: "Fund Structuring", time: "evening", importance: 3, targetHours: 130 },
                            { name: "Tax Efficiency & Structure Optimization", time: "evening", importance: 2, targetHours: 100 },
                            { name: "Co-Investments & Side Pockets", time: "evening", importance: 2, targetHours: 60 },
                            { name: "Secondaries Investing", time: "evening", importance: 2, targetHours: 80 },
                            { name: "Governance & Board Oversight", time: "evening", importance: 2, targetHours: 70 },
                            { name: "ESG Integration in PE", time: "evening", importance: 1, targetHours: 120 },
                            { name: "M&A Deal Structuring & SPA Review", time: "morning", importance: 5, targetHours: 90 },
                            { name: "Legal‚ÄìFinancial Translation", time: "morning", importance: 4, targetHours: 50 },
                            { name: "Valuation in Distressed / Illiquid Markets", time: "afternoon", importance: 4, targetHours: 100 },
                            { name: "Alternative Financing Instruments (Mezzanine, PIK, Convertible Prefs)", time: "afternoon", importance: 3, targetHours: 80 },
                            { name: "100-Day Value Creation Plan Design", time: "afternoon", importance: 5, targetHours: 70 },
                            { name: "Operational Turnaround / Lean Management", time: "evening", importance: 4, targetHours: 110 },
                            { name: "Digital Transformation for Portfolio Companies (AI, automation, ERP)", time: "evening", importance: 3, targetHours: 150 },
                            { name: "Regulatory & Policy Intelligence", time: "morning", importance: 4, targetHours: 90 },
                            { name: "Sector Deep Dives (Vertical Expertise)", time: "morning", importance: 4, targetHours: 130 },
                            { name: "Geopolitical / Macro Risk Assessment", time: "evening", importance: 3, targetHours: 80 },
                            { name: "Fundraising Strategy & LP Relations", time: "afternoon", importance: 5, targetHours: 100 },
                            { name: "Limited Partnership Agreement (LPA) & Fund Governance", time: "evening", importance: 4, targetHours: 110 },
                            { name: "Carried Interest / Performance Waterfall Mechanics", time: "evening", importance: 4, targetHours: 70 },
                            { name: "LP Reporting & Performance Benchmarking (IRR, TVPI, PME)", time: "evening", importance: 3, targetHours: 50 }                      
                        ]
                    },
                    "Tools & Software": {
                        icon: "üõ†Ô∏è",
                        color: "#c0392b",
                        skills: [
                            { name: "Excel Advanced (VBA, Macros)", time: "morning", importance: 5, targetHours: 100 },
                            { name: "Bloomberg Terminal", time: "afternoon", importance: 4, targetHours: 40 },
                            { name: "PitchBook", time: "afternoon", importance: 4, targetHours: 25 },
                            { name: "FactSet", time: "afternoon", importance: 3, targetHours: 35 },
                            { name: "S&P Capital IQ", time: "afternoon", importance: 3, targetHours: 30 },
                            { name: "Python for Financial / Operational Data Analysis", time: "morning", importance: 4, targetHours: 160 },
                            { name: "Alternative Data for Deal Sourcing (web scraping, hiring signals)", time: "afternoon", importance: 4, targetHours: 80 },
                            { name: "Predictive Modeling for Portfolio Risk (machine learning)", time: "afternoon", importance: 3, targetHours: 140 },
                            { name: "Power BI / Tableau for Portfolio Dashboards", time: "afternoon", importance: 3, targetHours: 60 },
                            { name: "CRM Software (Salesforce, HubSpot) for LP Management", time: "afternoon", importance: 2, targetHours: 30 },
                            { name: "Data Rooms (Intralinks, Datasite) for Due Diligence", time: "afternoon", importance: 3, targetHours: 20 },
                            { name: "PowerPoint Advanced", time: "afternoon", importance: 3, targetHours: 40 }
                        ]
                    },
                    "Soft Skills": {
                        icon: "ü§ó",
                        color: "#a93226",
                        skills: [
                            { name: "Strategic Thinking", time: "morning", importance: 4, targetHours: 50 },
                            { name: "Negotiation", time: "evening", importance: 4, targetHours: 100 },
                            { name: "Stakeholder Management", time: "evening", importance: 4, targetHours: 90 },
                            { name: "Presentation Skills", time: "evening", importance: 4, targetHours: 70 },
                            { name: "Leadership", time: "evening", importance: 3, targetHours: 120 },
                            { name: "Crisis Management", time: "evening", importance: 3, targetHours: 60 },
                            { name: "Influence Without Authority", time: "evening", importance: 5, targetHours: 110 },
                            { name: "Boardroom Politics & Power Dynamics", time: "evening", importance: 4, targetHours: 85 },
                            { name: "Tactical Negotiation Psychology", time: "evening", importance: 4, targetHours: 75 },
                            { name: "Media & Narrative Control (Exit / Fundraising)", time: "evening", importance: 3, targetHours: 65 },
                            { name: "Reputation Management in Closed-Door Markets", time: "evening", importance: 3, targetHours: 55 },
                            { name: "Operational Due Diligence Coordination", time: "evening", importance: 3, targetHours: 45 }
                        ]
                    }
                }
            },

            ib: {
                title: "Investment Banking Skills",
                categories: {
                    "Core Finance": {
                        icon: "üè¶",
                        color: "#3498db",
                        skills: [
                            { name: "Financial Modeling", time: "morning", importance: 5, targetHours: 140 },
                            { name: "Valuation", time: "morning", importance: 5, targetHours: 120 },
                            { name: "M&A Advisory", time: "morning", importance: 5, targetHours: 130 },
                            { name: "IPO & Capital Raising", time: "afternoon", importance: 4, targetHours: 90 },
                            { name: "Leveraged Finance", time: "afternoon", importance: 4, targetHours: 100 },
                            { name: "Cap Table Modeling", time: "morning", importance: 4, targetHours: 60 },
                            { name: "Recapitalizations", time: "afternoon", importance: 4, targetHours: 70 },
                            { name: "Debt Restructuring", time: "afternoon", importance: 4, targetHours: 85 },
                            { name: "Industry Research", time: "afternoon", importance: 3, targetHours: 50 },
                            { name: "Syndicated Loans & Club Deals", time: "afternoon", importance: 3, targetHours: 45 },
                            { name: "Rule 144A / Private Placements", time: "afternoon", importance: 3, targetHours: 40 },
                            { name: "Regulatory Filings (S-1, F-1, Prospectus)", time: "afternoon", importance: 3, targetHours: 55 },
                            { name: "Industry-Specific Metrics (EBITDAX, ARR, EBITDA, etc.)", time: "afternoon", importance: 3, targetHours: 35 },
                            { name: "Pitchbook Modeling", time: "evening", importance: 2, targetHours: 30 },
                            { name: "Pitchbook Creation", time: "evening", importance: 2, targetHours: 40 },
                            { name: "LBO Modeling (Base, Sensitivity, Debt Schedules)", time: "morning", importance: 5, targetHours: 110 },
                            { name: "Merger Model (Accretion/Dilution, Synergy Build)", time: "morning", importance: 5, targetHours: 100 },
                            { name: "Credit Analysis (Covenants, Leverage Ratios, Interest Coverage)", time: "afternoon", importance: 4, targetHours: 75 },
                            { name: "Transaction Structuring (Cash vs Stock, Earn-outs, Contingent Payments)", time: "afternoon", importance: 4, targetHours: 65 },
                            { name: "Working Capital & Cash Flow Adjustments", time: "morning", importance: 4, targetHours: 50 },
                            { name: "Purchase Price Allocation (Goodwill, Intangibles, Write-ups)", time: "afternoon", importance: 3, targetHours: 45 },
                            { name: "Fairness Opinion / Board Materials", time: "evening", importance: 3, targetHours: 40 },
                            { name: "Scenario & Sensitivity Analysis", time: "morning", importance: 3, targetHours: 55 },
                            { name: "Tax Considerations in M&A (NOLs, Step-ups, Deferred Tax Liabilities)", time: "afternoon", importance: 3, targetHours: 60 }
                        ]
                    },
                    "Tools & Software": {
                        icon: "üõ†Ô∏è",
                        color: "#2980b9",
                        skills: [
                            { name: "Excel Advanced (Macros, VBA, Dynamic Arrays)", time: "morning", importance: 5, targetHours: 120 },
                            { name: "Bloomberg Terminal", time: "afternoon", importance: 4, targetHours: 45 },
                            { name: "Capital IQ", time: "afternoon", importance: 4, targetHours: 40 },
                            { name: "Refinitiv Eikon", time: "afternoon", importance: 4, targetHours: 35 },
                            { name: "Thomson One", time: "afternoon", importance: 3, targetHours: 25 },
                            { name: "FactSet Bond Analytics", time: "afternoon", importance: 3, targetHours: 30 },
                            { name: "DealRoom / Intralinks / SecureDocs", time: "afternoon", importance: 3, targetHours: 20 },
                            { name: "PowerPoint Advanced (Pitchbook Design & Storytelling)", time: "evening", importance: 3, targetHours: 60 },
                            { name: "PitchBook Platform (Deal & PE/VC Data)", time: "afternoon", importance: 4, targetHours: 25 },
                            { name: "Mergermarket / Preqin", time: "afternoon", importance: 3, targetHours: 20 },
                            { name: "Power BI / Tableau (Financial Dashboards)", time: "afternoon", importance: 3, targetHours: 50 },
                            { name: "Python for Financial Analysis", time: "morning", importance: 3, targetHours: 140 },
                            { name: "SQL (Data Extraction & Cleaning for Deal Databases)", time: "morning", importance: 3, targetHours: 80 },
                            { name: "Excel to PowerPoint Automation (VBA + Linking Charts)", time: "evening", importance: 2, targetHours: 35 },
                            { name: "Alteryx / Data Automation (optional)", time: "afternoon", importance: 2, targetHours: 60 },
                            { name: "QuickBooks / Xero (basic)", time: "afternoon", importance: 1, targetHours: 15 }
                        ]
                    },
                    "Soft Skills": {
                        icon: "ü§ó",
                        color: "#21618c",
                        skills: [
                            { name: "High-Stakes Presentation to C-suite", time: "evening", importance: 5, targetHours: 90 },
                            { name: "Client Management", time: "evening", importance: 5, targetHours: 110 },
                            { name: "Attention to Detail", time: "morning", importance: 5, targetHours: 40 },
                            { name: "Time Management", time: "evening", importance: 5, targetHours: 25 },
                            { name: "Deadlines under 24h", time: "evening", importance: 5, targetHours: 30 },
                            { name: "Stress Tolerance", time: "evening", importance: 4, targetHours: 35 },
                            { name: "Political Savvy (Office Politics)", time: "evening", importance: 4, targetHours: 70 },
                            { name: "Communication Under Pressure", time: "evening", importance: 3, targetHours: 45 },
                            { name: "Active Listening", time: "evening", importance: 3, targetHours: 30 },
                            { name: "Managing Analyst-to-Associate Handoff", time: "evening", importance: 4, targetHours: 50 },
                            { name: "Stakeholder Mapping (Client vs. Internal vs. Regulator)", time: "evening", importance: 3, targetHours: 55 },
                            { name: "Negotiation under Information Asymmetry", time: "evening", importance: 4, targetHours: 85 },
                            { name: "Conflict Navigation (Cross-Team Politics)", time: "evening", importance: 3, targetHours: 60 },
                            { name: "Strategic Storytelling in Pitches", time: "evening", importance: 4, targetHours: 75 },
                            { name: "Deadline Triage (What to Drop vs. Deliver)", time: "evening", importance: 4, targetHours: 40 },
                            { name: "Precision QA under Fatigue (Night-Shift Review)", time: "night", importance: 5, targetHours: 35 },
                            { name: "Client EQ ‚Äì Reading Unspoken Objections", time: "evening", importance: 4, targetHours: 65 },
                            { name: "Managing Up (to MDs)", time: "evening", importance: 3, targetHours: 45 }
                        ]
                    }
                }
            },

            hf: {
                title: "Hedge Fund Skills",
                categories: {
                    "Trading & Analysis": {
                        icon: "üé≤",
                        color: "#f39c12",
                        skills: [
                            { name: "Fundamental Analysis", time: "morning", importance: 5, targetHours: 120 },
                            { name: "Risk Management (VaR, Max Drawdown, Tail Risk)", time: "morning", importance: 5, targetHours: 100 },
                            { name: "Long/Short Equity Strategy", time: "morning", importance: 5, targetHours: 110 },
                            { name: "Portfolio Construction (Concentration, Correlation, Diversification)", time: "morning", importance: 5, targetHours: 130 },
                            { name: "Market Microstructure (Order Flow, Liquidity, Spread Dynamics)", time: "morning", importance: 4, targetHours: 90 },
                            { name: "Global Macro Strategy", time: "afternoon", importance: 4, targetHours: 140 },
                            { name: "Event-Driven Investing", time: "afternoon", importance: 4, targetHours: 85 },
                            { name: "Distressed Debt Analysis", time: "afternoon", importance: 4, targetHours: 95 },
                            { name: "Options & Derivatives Trading (Greeks, Vol Surface)", time: "afternoon", importance: 4, targetHours: 110 },
                            { name: "Fixed Income & Credit Trading (Yield Curve, Spread Trades)", time: "afternoon", importance: 4, targetHours: 105 },
                            { name: "Short Selling Mechanics & Borrowing Costs", time: "afternoon", importance: 4, targetHours: 70 },
                            { name: "Volatility Arbitrage / VIX Strategies", time: "afternoon", importance: 3, targetHours: 80 },
                            { name: "Event-driven/Activist Investing Analysis", time: "afternoon", importance: 3, targetHours: 75 },
                            { name: "Market Manipulation Tactics (Understanding, Not Participating)", time: "evening", importance: 2, targetHours: 40 },
                            { name: "Sentiment Analysis (News, Social Media, ETF Flows)", time: "evening", importance: 3, targetHours: 65 },
                            { name: "Quantitative Signals & Factor Models", time: "evening", importance: 2, targetHours: 85 }
                        ]
                    },
                    "Execution & Portfolio Diagnostics": {
                        icon: "üîç",
                        color: "#d35400",
                        skills: [
                            { name: "Trade Execution & Slippage Management", time: "afternoon", importance: 5, targetHours: 85 },
                            { name: "Performance Attribution (Alpha vs Beta vs Timing)", time: "morning", importance: 5, targetHours: 95 },
                            { name: "Position Sizing & Scaling (Kelly Criterion, Convexity)", time: "morning", importance: 4, targetHours: 75 },
                            { name: "Trade Journaling & Post-Mortem Analysis", time: "evening", importance: 4, targetHours: 45 },
                            { name: "Portfolio Stress Testing (Historical & Hypothetical Scenarios)", time: "morning", importance: 4, targetHours: 80 },
                            { name: "Cross-Asset Hedging Techniques (FX, Options, Futures)", time: "afternoon", importance: 4, targetHours: 100 },
                            { name: "Risk Budgeting & Exposure Decomposition", time: "afternoon", importance: 3, targetHours: 65 },
                            { name: "Transaction Cost Analysis (TCA)", time: "evening", importance: 2, targetHours: 50 }
                        ]
                    },
                    "Quantitative Skills": {
                        icon: "üßÆ",
                        color: "#e67e22",
                        skills: [
                            { name: "Python for Finance (Pandas, NumPy, Backtrader)", time: "morning", importance: 5, targetHours: 180 },
                            { name: "Statistical Arbitrage", time: "morning", importance: 5, targetHours: 150 },
                            { name: "Backtesting Strategies (Avoiding Overfitting, Walk-Forward Analysis)", time: "morning", importance: 5, targetHours: 120 },
                            { name: "Time Series Analysis (Stationarity, Cointegration)", time: "morning", importance: 5, targetHours: 110 },
                            { name: "Portfolio Optimization (Markowitz, Black-Litterman)", time: "morning", importance: 4, targetHours: 95 },
                            { name: "Factor Exposure Analysis (Style, Sector, Country)", time: "afternoon", importance: 4, targetHours: 85 },
                            { name: "Financial Econometrics (OLS, VAR, GARCH)", time: "afternoon", importance: 4, targetHours: 105 },
                            { name: "Time Series Forecasting (ARIMA, GARCH)", time: "afternoon", importance: 4, targetHours: 100 },
                            { name: "Monte Carlo Simulation", time: "afternoon", importance: 4, targetHours: 90 },
                            { name: "Risk Parity / Volatility Targeting", time: "afternoon", importance: 3, targetHours: 70 },
                            { name: "AI & Machine Learning (Random Forest, XGBoost, LSTM for Returns)", time: "evening", importance: 3, targetHours: 160 },
                            { name: "SQL Database Management", time: "afternoon", importance: 3, targetHours: 80 },
                            { name: "R for Statistics (ggplot2, quantmod, PerformanceAnalytics)", time: "evening", importance: 2, targetHours: 100 },
                            { name: "API Data Integration (Alpha Vantage, IEX Cloud, Quandl)", time: "evening", importance: 2, targetHours: 45 },
                            { name: "Alternative Data (Web Scraping, Credit Card, Satellite, Job Data)", time: "morning", importance: 4, targetHours: 110 },
                            { name: "Feature Engineering for Market Prediction", time: "morning", importance: 4, targetHours: 95 },
                            { name: "Machine Learning Pipeline (Data Cleaning ‚Üí Model ‚Üí Evaluation)", time: "afternoon", importance: 3, targetHours: 130 },
                            { name: "NLP for Financial News / Earnings Call Sentiment", time: "evening", importance: 3, targetHours: 85 },
                            { name: "Backtesting with Realistic Frictions (Latency, Fees, Borrow)", time: "afternoon", importance: 3, targetHours: 75 }
                        ]
                    },
                    "Fund Management & Ops Edge": {
                        icon: "üíµ",
                        color: "#d35400",
                        skills: [
                            { name: "Prime Brokerage & Margin Mechanics", time: "afternoon", importance: 4, targetHours: 70 },
                            { name: "Fund Leverage & Liquidity Management", time: "afternoon", importance: 4, targetHours: 85 },
                            { name: "P&L Attribution & Risk Reports (Daily/Weekly)", time: "morning", importance: 3, targetHours: 55 },
                            { name: "Investor Letters & Transparency Reporting", time: "evening", importance: 2, targetHours: 40 },
                            { name: "Compliance & Trade Surveillance (Understanding Only)", time: "evening", importance: 2, targetHours: 35 },
                            { name: "Capital Allocation Across Strategies", time: "morning", importance: 3, targetHours: 75 }
                        ]
                    },
                    "Behavioral & Mental Edge": {
                        icon: "üí°",
                        color: "#f1800f",
                        skills: [
                            { name: "Cognitive Bias Control (Recency, Confirmation, Anchoring)", time: "morning", importance: 5, targetHours: 60 },
                            { name: "Emotional Discipline During Drawdowns", time: "evening", importance: 5, targetHours: 55 },
                            { name: "Decision-Making Under Uncertainty", time: "evening", importance: 4, targetHours: 50 },
                            { name: "Probabilistic Thinking (Bayesian Updating)", time: "morning", importance: 4, targetHours: 65 },
                            { name: "Mental Reset Techniques (Post-Loss Recovery)", time: "evening", importance: 3, targetHours: 35 },
                            { name: "Performance Journaling & Pattern Recognition", time: "evening", importance: 3, targetHours: 45 }
                        ]
                    },
                    "Market Knowledge": {
                        icon: "üåé",
                        color: "#e67e22",
                        skills: [
                            { name: "Macroeconomics (Business Cycle, Inflation, Interest Rates)", time: "morning", importance: 5, targetHours: 120 },
                            { name: "Central Bank Policy Impact (Fed, ECB, BoE, PBOC)", time: "morning", importance: 5, targetHours: 95 },
                            { name: "Behavioral Finance (Biases, Herding, Overreaction)", time: "morning", importance: 5, targetHours: 70 },
                            { name: "FX & Commodities (Correlations, Carry Trade, Oil-Gold Ratio)", time: "afternoon", importance: 4, targetHours: 85 },
                            { name: "Geopolitical Analysis (Trade Wars, Sanctions, Elections)", time: "afternoon", importance: 4, targetHours: 90 },
                            { name: "Emerging Markets Analysis (Capital Controls, Liquidity Risks)", time: "afternoon", importance: 4, targetHours: 80 },
                            { name: "Liquidity Events & Market Crashes (2008, 2020, 2022)", time: "evening", importance: 4, targetHours: 65 },
                            { name: "Market Regime Detection (Regime Switching Models)", time: "evening", importance: 3, targetHours: 75 },
                            { name: "Institutional Investor Behavior (Index Funds, Hedge Fund Flows)", time: "evening", importance: 3, targetHours: 60 },
                            { name: "Systemic Risk Identification (Shadow Banking, Repo Market Stress)", time: "evening", importance: 3, targetHours: 70 }
                        ]
                    }
                }
            },

            sc: {
                title: "Strategy Consulting Skills",
                categories: {
                    "Core Consulting": {
                        icon: "üß©",
                        color: "#2ecc71",
                        skills: [
                            { name: "Case Framework Mastery (MECE, Issue Tree, Pyramid Principle)", time: "morning", importance: 5, targetHours: 80 },
                            { name: "Problem Solving (Structured Thinking)", time: "morning", importance: 5, targetHours: 90 },
                            { name: "Market Sizing (Top-down / Bottom-up / Analogous)", time: "morning", importance: 5, targetHours: 65 },
                            { name: "Competitive Analysis (Porter‚Äôs Five Forces, SWOT, Strategic Groups)", time: "morning", importance: 4, targetHours: 70 },
                            { name: "Scenario Planning & Sensitivity Analysis", time: "morning", importance: 4, targetHours: 75 },
                            { name: "Go-to-Market (GTM) Strategy", time: "afternoon", importance: 4, targetHours: 85 },
                            { name: "Cost Reduction Strategies", time: "afternoon", importance: 4, targetHours: 80 },
                            { name: "Pricing Strategy & Monetization Models", time: "afternoon", importance: 4, targetHours: 95 },
                            { name: "Business Restructuring", time: "afternoon", importance: 4, targetHours: 100 },
                            { name: "Corporate Restructuring Strategy", time: "afternoon", importance: 3, targetHours: 90 },
                            { name: "Digital Transformation", time: "afternoon", importance: 3, targetHours: 110 },
                            { name: "M&A Advisory", time: "afternoon", importance: 3, targetHours: 85 },
                            { name: "M&A Integration Planning", time: "evening", importance: 2, targetHours: 70 },
                            { name: "Value Chain Optimization", time: "evening", importance: 2, targetHours: 75 }
                        ]
                    },
                    "Data & Analytics": {
                        icon: "üìà",
                        color: "#27ae60",
                        skills: [
                            { name: "Excel Advanced (Modeling, Dashboards, Dynamic Arrays)", time: "morning", importance: 5, targetHours: 90 },
                            { name: "ROI Analysis (NPV, IRR, Payback Period)", time: "morning", importance: 5, targetHours: 60 },
                            { name: "Data Analysis (Cleaning, Aggregation, Insight Extraction)", time: "morning", importance: 4, targetHours: 75 },
                            { name: "Process Mapping (BPMN, Swimlane Diagrams)", time: "morning", importance: 4, targetHours: 45 },
                            { name: "Scenario Modeling (What-if, Monte Carlo)", time: "morning", importance: 4, targetHours: 70 },
                            { name: "SQL", time: "afternoon", importance: 4, targetHours: 80 },
                            { name: "Tableau / Power BI", time: "afternoon", importance: 4, targetHours: 65 },
                            { name: "Predictive Modeling (Churn, CLV)", time: "afternoon", importance: 3, targetHours: 85 },
                            { name: "Customer Segmentation & RFM Analysis", time: "afternoon", importance: 3, targetHours: 55 },
                            { name: "Statistical Analysis (Regression, Correlation, Hypothesis Testing)", time: "afternoon", importance: 3, targetHours: 75 },
                            { name: "A/B Testing Design", time: "evening", importance: 2, targetHours: 40 }
                        ]
                    },
                    "Execution & Implementation": {
                        icon: "üèÉ",
                        color: "#1abc9c",
                        skills: [
                            { name: "PMO Design & Implementation Tracking", time: "afternoon", importance: 5, targetHours: 85 },
                            { name: "KPI Tree Design & Performance Dashboarding", time: "morning", importance: 4, targetHours: 70 },
                            { name: "Change Management & Stakeholder Buy-in", time: "evening", importance: 4, targetHours: 90 },
                            { name: "Operational Excellence (Lean, Six Sigma, Kaizen)", time: "afternoon", importance: 3, targetHours: 95 },
                            { name: "Business Process Reengineering (BPR)", time: "afternoon", importance: 3, targetHours: 100 },
                            { name: "Implementation Roadmapping (Quick Wins ‚Üí Long-term Impact)", time: "evening", importance: 3, targetHours: 75 }
                        ]
                    },
                    "Industry Expertise & Insight Generation": {
                        icon: "üóûÔ∏è",
                        color: "#16a085",
                        skills: [
                            { name: "Industry Benchmarking & Peer Analysis", time: "morning", importance: 5, targetHours: 80 },
                            { name: "Market Trend Forecasting (TAM, CAGR, Disruption)", time: "morning", importance: 4, targetHours: 95 },
                            { name: "Consumer Behavior & Demand Drivers", time: "afternoon", importance: 4, targetHours: 85 },
                            { name: "Value Pool Mapping by Sector", time: "afternoon", importance: 3, targetHours: 70 },
                            { name: "Geopolitical & Regulatory Impacts on Strategy", time: "evening", importance: 3, targetHours: 75 }                        
                        ]
                    },
                    "Advanced Strategic Thinking": {
                        icon: "üêç",
                        color: "#81b214",
                        skills: [
                            { name: "Game Theory & Competitive Signaling", time: "morning", importance: 5, targetHours: 90 },
                            { name: "Incentive Design & Organizational Behavior", time: "morning", importance: 4, targetHours: 85 },
                            { name: "Systems Thinking (Feedback Loops, Second-Order Effects)", time: "morning", importance: 4, targetHours: 95 },
                            { name: "Scenario Narrative Development (Strategic Storytelling)", time: "evening", importance: 4, targetHours: 80 },
                            { name: "War-Gaming & Competitor Simulation", time: "afternoon", importance: 3, targetHours: 75 }
                        ]
                    },                    
                    "Client Power Dynamics & Influence": {
                        icon: "üí•",
                        color: "#a8c545",
                        skills: [
                            { name: "Boardroom Politics & Power Mapping", time: "evening", importance: 5, targetHours: 85 },
                            { name: "Influence Without Authority (Client & Internal)", time: "evening", importance: 4, targetHours: 90 },
                            { name: "Managing Difficult Clients & Expectation Control", time: "evening", importance: 4, targetHours: 80 },
                            { name: "High-Stakes Negotiation (Budget, Scope, Timeline)", time: "evening", importance: 3, targetHours: 70 },
                            { name: "Narrative Control & Framing Strategy", time: "evening", importance: 3, targetHours: 65 }
                        ]
                    },                     
                    "Communication": {
                        icon: "üí¨",
                        color: "#59e099",
                        skills: [
                            { name: "Storytelling with Data", time: "evening", importance: 5, targetHours: 85 },
                            { name: "Presentation Skills (Client-ready Slides)", time: "evening", importance: 5, targetHours: 80 },
                            { name: "Executive Presence (Confidence, Poise, Authority)", time: "evening", importance: 5, targetHours: 90 },
                            { name: "Client Communication (Asking the Right Questions)", time: "evening", importance: 5, targetHours: 75 },
                            { name: "Managing Up (Communicating with Partners)", time: "evening", importance: 5, targetHours: 70 },
                            { name: "Stakeholder Alignment (Influencing Without Authority)", time: "evening", importance: 4, targetHours: 80 },
                            { name: "Facilitation Skills (Running Workshops, Brainstorms)", time: "evening", importance: 4, targetHours: 65 },
                            { name: "Visual Thinking & Slide Design Principles (MECE, Pyramid, One Idea per Slide)", time: "evening", importance: 4, targetHours: 60 },
                            { name: "Conflict Resolution in Teams", time: "evening", importance: 4, targetHours: 55 },
                            { name: "Active Listening", time: "evening", importance: 3, targetHours: 40 },
                            { name: "Giving & Receiving Feedback", time: "evening", importance: 3, targetHours: 45 },
                            { name: "Adaptability to Client Culture", time: "evening", importance: 3, targetHours: 50 }
                        ]
                    }
                }
            },

            fintech: {
                title: "Fintech Skills",
                categories: {
                    "Core Finance for Fintech": {
                        icon: "üí≥",
                        color: "#00e5ff",
                        skills: [
                            { name: "Credit Scoring Models (Alternative Data)", time: "morning", importance: 5, targetHours: 120 },
                            { name: "Micro-lending & BNPL Risk Modeling", time: "morning", importance: 5, targetHours: 110 },
                            { name: "Interest Rate Risk in Digital Lending", time: "morning", importance: 5, targetHours: 95 },
                            { name: "Financial Products (Payments, Lending, Insurance)", time: "morning", importance: 4, targetHours: 85 },
                            { name: "Corporate Finance Basics (BS, Cash Flow, Credit Risk)", time: "morning", importance: 4, targetHours: 70 },
                            { name: "Banking Infrastructure (Core Systems, Payment Rails)", time: "afternoon", importance: 4, targetHours: 90 },
                            { name: "Embedded Finance Architecture (API-driven banking)", time: "afternoon", importance: 4, targetHours: 100 },
                            { name: "Treasury & Liquidity Management", time: "afternoon", importance: 3, targetHours: 75 },
                            { name: "Capital Markets Infrastructure (Settlement, Clearing)", time: "afternoon", importance: 3, targetHours: 80 },
                            { name: "Risk & Compliance (KYC, AML, Basel III)", time: "evening", importance: 3, targetHours: 95 },
                            { name: "Consumer Protection Laws (Fair Lending, Transparency)", time: "evening", importance: 2, targetHours: 50 },
                            { name: "Financial Inclusion Regulations", time: "evening", importance: 2, targetHours: 45 }
                        ]
                    },
                    "Technology & Data": {
                        icon: "üì±",
                        color: "#00b8ff",
                        skills: [
                            { name: "Python for Finance (pandas, NumPy, scikit-learn)", time: "morning", importance: 5, targetHours: 160 },
                            { name: "SQL & Databases (Relational, Query Optimization)", time: "morning", importance: 5, targetHours: 100 },
                            { name: "Machine Learning (Fraud Detection, Credit Scoring, Robo-advisors)", time: "morning", importance: 5, targetHours: 180 },
                            { name: "Data Analytics (Tableau/Power BI for Business Insights)", time: "morning", importance: 4, targetHours: 70 },
                            { name: "APIs & Integration (REST, Open Banking, Webhooks)", time: "morning", importance: 4, targetHours: 85 },
                            { name: "Real-time Processing (Kafka, Spark Streaming)", time: "afternoon", importance: 4, targetHours: 110 },
                            { name: "Data Engineering (ETL, Pipelines, Warehousing)", time: "afternoon", importance: 4, targetHours: 120 },
                            { name: "NoSQL Databases (MongoDB, Cassandra)", time: "afternoon", importance: 3, targetHours: 65 },
                            { name: "Cloud Computing (AWS, Azure, GCP)", time: "afternoon", importance: 3, targetHours: 90 },
                            { name: "API Security (OAuth, JWT, RBAC)", time: "evening", importance: 3, targetHours: 55 },
                            { name: "Cybersecurity Fundamentals (DDoS, Phishing, Zero Trust)", time: "evening", importance: 3, targetHours: 60 },
                            { name: "DevOps & CI/CD Pipelines", time: "evening", importance: 2, targetHours: 75 },
                            { name: "Cloud & DevOps Awareness", time: "evening", importance: 2, targetHours: 40 }
                        ]
                    },
                    "Fintech Business Models": {
                        icon: "üíª",
                        color: "#7cffff",
                        skills: [
                            { name: "Payments (Stripe, Momo, VNPay)", time: "morning", importance: 5, targetHours: 100 },
                            { name: "Lending & Credit (P2P, BNPL)", time: "morning", importance: 5, targetHours: 120 },
                            { name: "Neobanks (Digital-Only Banks)", time: "morning", importance: 5, targetHours: 110 },
                            { name: "Embedded Finance", time: "morning", importance: 5, targetHours: 90 },
                            { name: "Product Analytics Metrics (CAC, LTV, Churn, NRR)", time: "morning", importance: 5, targetHours: 80 },
                            { name: "WealthTech (Robo-advisors)", time: "afternoon", importance: 4, targetHours: 95 },
                            { name: "InsurTech", time: "afternoon", importance: 4, targetHours: 100 },
                            { name: "RegTech (Automated Compliance)", time: "afternoon", importance: 3, targetHours: 85 },
                            { name: "AI-Powered Personal Finance Apps", time: "afternoon", importance: 3, targetHours: 75 },
                            { name: "BNPL-as-a-Service (BaaS)", time: "afternoon", importance: 3, targetHours: 70 },
                            { name: "Crypto Wallets & Custody Solutions", time: "evening", importance: 2, targetHours: 60 },
                            { name: "Blockchain & DeFi (Smart Contracts, Yield Farming)", time: "evening", importance: 2, targetHours: 130 }
                        ]
                    },
                    "Regulation & Policy": {
                        icon: "‚öñÔ∏è",
                        color: "#8be2fe",
                        skills: [
                            { name: "Open Banking / PSD2", time: "evening", importance: 5, targetHours: 110 },
                            { name: "Anti-Money Laundering (AML) Tech", time: "evening", importance: 5, targetHours: 120 },
                            { name: "Data Protection (GDPR, PDPA)", time: "evening", importance: 5, targetHours: 100 },
                            { name: "Digital Banking Licenses", time: "evening", importance: 4, targetHours: 90 },
                            { name: "Consumer Protection Laws (Fair Lending, Transparency)", time: "evening", importance: 4, targetHours: 85 },
                            { name: "Crypto Regulations (SEC, MiCA)", time: "evening", importance: 4, targetHours: 130 },
                            { name: "Central Bank Digital Currencies (CBDC)", time: "evening", importance: 3, targetHours: 75 },
                            { name: "Cross-border Payments Regulation", time: "evening", importance: 3, targetHours: 70 },
                            { name: "Financial Inclusion Regulations", time: "evening", importance: 3, targetHours: 60 },
                            { name: "Basel III Implementation in Fintech", time: "evening", importance: 2, targetHours: 95 }
                        ]
                   },
                    "Product & Growth Optimization": {
                        icon: "‚¨ÜÔ∏è",
                        color: "#5efcff",
                        skills: [
                            { name: "Conversion Funnel Optimization (AARRR Framework)", time: "afternoon", importance: 4, targetHours: 90 },
                            { name: "User Retention & Engagement Loops", time: "afternoon", importance: 4, targetHours: 100 },
                            { name: "Pricing Experiments & Dynamic Pricing Models", time: "afternoon", importance: 3, targetHours: 85 },
                            { name: "Unit Economics Modeling (CAC/LTV Breakeven, Contribution Margin)", time: "morning", importance: 5, targetHours: 110 },
                            { name: "Behavioral Economics in Fintech (Nudges, Defaults, Frictions)", time: "afternoon", importance: 3, targetHours: 70 },
                            { name: "Growth Analytics (Cohort, Retention, Churn)", time: "morning", importance: 4, targetHours: 95 }
                        ]
                    },
                    "AI x Finance": {
                        icon: "ü§ñ",
                        color: "#3deaff",
                        skills: [
                            { name: "AI Strategy for Financial Products (Explainability, Bias, Ethics)", time: "morning", importance: 4, targetHours: 100 },
                            { name: "Generative AI in Finance (Chatbots, Report Automation)", time: "afternoon", importance: 3, targetHours: 85 },
                            { name: "LLMs for Credit Scoring & Risk Monitoring", time: "morning", importance: 3, targetHours: 110 },
                            { name: "Feature Engineering for Financial Data", time: "morning", importance: 4, targetHours: 120 },
                            { name: "Alternative Data Integration (Social, Geolocation, Mobile)", time: "morning", importance: 4, targetHours: 105 }
                        ]
                    },
                    "Payments Infrastructure Deep Dive": {
                        icon: "üîç",
                        color: "#2be6ff",
                        skills: [
                            { name: "ISO 20022 & SWIFT Messaging Standards", time: "afternoon", importance: 4, targetHours: 95 },
                            { name: "Card Networks (Visa/Mastercard/BIN Management)", time: "afternoon", importance: 3, targetHours: 70 },
                            { name: "Real-time Payments (RTP, PIX, FAST, UPI)", time: "afternoon", importance: 4, targetHours: 90 },
                            { name: "Settlement Risk & Reconciliation Processes", time: "evening", importance: 3, targetHours: 80 },
                            { name: "Cross-border FX Infrastructure (Wise, Revolut)", time: "evening", importance: 3, targetHours: 85 }
                        ]
                    },
                    "Governance, Risk & Compliance": {
                        icon: "üìù",
                        color: "#1affff",
                        skills: [
                            { name: "Model Risk Management (SR 11-7, Model Validation)", time: "afternoon", importance: 4, targetHours: 110 },
                            { name: "Operational Risk & Resilience in Digital Banks", time: "afternoon", importance: 4, targetHours: 100 },
                            { name: "Third-party Risk (Vendor Management, Cloud Risks)", time: "evening", importance: 3, targetHours: 85 },
                            { name: "Fraud Operations & Chargeback Management", time: "evening", importance: 3, targetHours: 90 }
                        ]
                    },                    
                    "Capital Strategy & Fintech Economics": {
                        icon: "üí≤",
                        color: "#00ffff",
                        skills: [
                            { name: "Fintech Valuation Models (Unit Economics, LTV/CAC Multiple)", time: "morning", importance: 5, targetHours: 130 },
                            { name: "Revenue Modeling for Transaction-based Businesses", time: "morning", importance: 4, targetHours: 105 },
                            { name: "Regulatory Capital Optimization (Tier 1, Leverage Ratio)", time: "afternoon", importance: 3, targetHours: 95 },
                            { name: "Investor Reporting & Metrics (ARR, NRR, Take Rate)", time: "afternoon", importance: 4, targetHours: 80 }
                        ]
                    },
                    "Professional & Strategic Skills": {
                    icon: "üí°",
                    color: "#00eaff",
                    skills: [
                            { name: "Product Management (MVP, Scaling, Roadmap)", time: "evening", importance: 5, targetHours: 150 },
                            { name: "Metrics-Driven Decision Making (CAC, LTV, Churn, NRR)", time: "evening", importance: 5, targetHours: 100 },
                            { name: "Strategic Thinking (Disruption, Platform Effects)", time: "evening", importance: 5, targetHours: 120 },
                            { name: "Pitching to Investors (VC, PE, Corporate VC)", time: "evening", importance: 5, targetHours: 90 },
                            { name: "Fundraising & Venture Finance", time: "evening", importance: 5, targetHours: 110 },
                            { name: "Agile & Scrum", time: "evening", importance: 4, targetHours: 70 },
                            { name: "Lean Startup Methodology", time: "evening", importance: 4, targetHours: 60 },
                            { name: "UX/UI in Fintech (Trust, Simplicity, Accessibility)", time: "evening", importance: 4, targetHours: 95 },
                            { name: "Partnerships & Ecosystem Building", time: "evening", importance: 4, targetHours: 85 },
                            { name: "Cross-functional Collaboration (Engineering √ó Legal √ó Marketing)", time: "evening", importance: 3, targetHours: 65 },
                            { name: "Stakeholder Alignment (Internal & External)", time: "evening", importance: 3, targetHours: 75 },
                            { name: "Adaptability to Regulatory Shifts", time: "evening", importance: 3, targetHours: 55 }
                       ]
                    }
                }
            },

            english: {
                title: "English Skills",
                categories: {
                    "Core Language": {
                        icon: "üìö",
                        color: "#ffff00",
                        skills: [
                            { name: "Financial Terminology and Jargon", time: "morning", importance: 5, targetHours: 120 },
                            { name: "Business Vocabulary", time: "morning", importance: 5, targetHours: 100 },
                            { name: "Advanced Grammar (Conditionals, Inversion, Passive Voice in Reports)", time: "morning", importance: 4, targetHours: 90 },
                            { name: "Reading Comprehension (WSJ, FT, McKinsey Reports)", time: "morning", importance: 4, targetHours: 110 },
                            { name: "Academic Writing", time: "morning", importance: 4, targetHours: 130 },
                            { name: "Negotiation English (Phrasal Verbs, Persuasive Language, Softening Requests)", time: "afternoon", importance: 3, targetHours: 85 },
                            { name: "Idioms in Business Context", time: "afternoon", importance: 3, targetHours: 60 }
                        ]
                    },
                    "Speaking & Listening": {
                        icon: "üé§",
                        color: "#ffff19",
                        skills: [
                            { name: "Business Presentations (Clarity, Structure, Storytelling)", time: "evening", importance: 5, targetHours: 140 },
                            { name: "Interview Skills (STAR Method, Behavioral Questions, Case Interviews)", time: "evening", importance: 4, targetHours: 100 },
                            { name: "Handling Difficult Questions (Q&A under Pressure)", time: "evening", importance: 4, targetHours: 90 },
                            { name: "Academic Listening (Listen to university lectures and academic discussions)", time: "morning", importance: 5, targetHours: 120 },
                            { name: "Active Listening", time: "afternoon", importance: 4, targetHours: 80 },
                            { name: "Diverse Content (Listen to a wide range of content, including podcasts, news broadcasts, movies, TV shows and audiobooks)", time: "afternoon", importance: 3, targetHours: 150 },
                            { name: "Specific Skill Practice (Practice listening for the main idea, details, and context. Listen to various accents to get used to different pronunciations and rhythms.)", time: "afternoon", importance: 3, targetHours: 110 },
                            { name: "Pronunciation & Intonation (Practice the correct pronunciation of individual sounds and words. Pay attention to intonation (the rise and fall of your voice) to sound more natural)", time: "morning", importance: 4, targetHours: 100 },
                            { name: "Fluency & Cohesion (Focus on speaking smoothly without long pauses. Use transition words and phrases to connect your ideas logically and make your speech flow.)", time: "morning", importance: 5, targetHours: 130 },
                            { name: "Vocabulary & Grammar (Use a wide range of vocabulary and grammatical structures. Try to incorporate new words you've learned into your daily conversations.)", time: "afternoon", importance: 5, targetHours: 160 },
                            { name: "Public Speaking & Presentations (Practice giving short talks or presentations on topics you know well. This helps you organize your thoughts and speak more confidently.)", time: "evening", importance: 5, targetHours: 120 }
                        ]
                    },
                    "Professional Skills": {
                        icon: "üíº",
                        color: "#ffff33",
                        skills: [
                            { name: "Email Communication (Professional Tone, Subject Lines, Call-to-Action)", time: "evening", importance: 5, targetHours: 80 },
                            { name: "Report Writing (Executive Summary, Data Visualization Narratives)", time: "evening", importance: 5, targetHours: 120 },
                            { name: "Writing Executive Summaries", time: "evening", importance: 5, targetHours: 70 },
                            { name: "Business Writing Templates (Memos, Investment Notes, Project Updates)", time: "evening", importance: 5, targetHours: 90 },
                            { name: "Data Presentation and Analysis", time: "evening", importance: 4, targetHours: 100 },
                            { name: "Cross-cultural Communication (US Direct vs Japan Indirect, UK Politeness)", time: "evening", importance: 4, targetHours: 85 },
                            { name: "Negotiation and Persuasion", time: "evening", importance: 4, targetHours: 110 },
                            { name: "Professional Fluency and Idioms", time: "afternoon", importance: 3, targetHours: 65 }
                        ]
                    }
                }
            },

            chinese: {
              title: "Chinese",  
              categories: {
                "Âü∫Á°ÄÊ±âËØ≠ (C∆° b·∫£n)": { 
                  icon: "üÄÑ",
                  color: "#00ffe7",
                  skills: [
                    { name: "ÊãºÈü≥ (Pinyin - Ph√°t √¢m)", time: "morning", importance: 5, targetHours: 80 },
                    { name: "Ê±âÂ≠ó (H√°n t·ª± - Nh·∫≠n di·ªán & Vi·∫øt)", time: "morning", importance: 5, targetHours: 300 },
                    { name: "Âü∫Á°ÄËØ≠Ê≥ï (Ng·ªØ ph√°p c∆° b·∫£n)", time: "afternoon", importance: 4, targetHours: 100 },
                    { name: "Êó•Â∏∏ËØçÊ±á (T·ª´ v·ª±ng h√†ng ng√†y)", time: "morning", importance: 5, targetHours: 200 },
                    { name: "Êï∞Â≠ó‰∏éÊó•Êúü (S·ªë ƒë·∫øm & Ng√†y th√°ng)", time: "morning", importance: 4, targetHours: 30 }
                  ]
                },
                "Âê¨ËØ¥ËÉΩÂäõ (Nghe - N√≥i)": { 
                  icon: "üó£Ô∏è",
                  color: "#00fffd",
                  skills: [
                    { name: "Êó•Â∏∏ÂØπËØù (H·ªôi tho·∫°i h√†ng ng√†y)", time: "evening", importance: 5, targetHours: 250 },
                    { name: "ÂèëÈü≥‰∏éËØ≠Ë∞É (Ph√°t √¢m & Ng·ªØ ƒëi·ªáu)", time: "morning", importance: 4, targetHours: 120 },
                    { name: "ÊµÅÂà©Â∫¶‰∏éËøûË¥ØÊÄß (ƒê·ªô l∆∞u lo√°t & M·∫°ch l·∫°c)", time: "morning", importance: 4, targetHours: 180 },
                    { name: "ÂïÜÂä°Âê¨Âäõ (Nghe hi·ªÉu ng·ªØ c·∫£nh kinh doanh)", time: "afternoon", importance: 4, targetHours: 150 },
                    { name: "‰∏ªÂä®ÂÄæÂê¨ (L·∫Øng nghe ch·ªß ƒë·ªông)", time: "afternoon", importance: 3, targetHours: 80 }
                  ]
                },
                "ËØªÂÜôËÉΩÂäõ (ƒê·ªçc - Vi·∫øt)": { 
                  icon: "üìù",
                  color: "#00ecff",
                  skills: [
                    { name: "ÈòÖËØªÁêÜËß£ (ƒê·ªçc hi·ªÉu)", time: "afternoon", importance: 5, targetHours: 220 },
                    { name: "Ê±âÂ≠ó‰π¶ÂÜô (Vi·∫øt H√°n t·ª±)", time: "evening", importance: 4, targetHours: 180 },
                    { name: "ÂïÜÂä°ÈÇÆ‰ª∂ÂÜô‰Ωú (Vi·∫øt email kinh doanh)", time: "evening", importance: 4, targetHours: 120 },
                    { name: "ÁÆÄ‰ΩìÂ≠ó‰∏éÁπÅ‰ΩìÂ≠ó (H√°n gi·∫£n th·ªÉ & Ph·ªìn th·ªÉ)", time: "afternoon", importance: 3, targetHours: 90 },
                    { name: "ÊñáÂåñËØ≠Â¢ÉÁêÜËß£ (Hi·ªÉu ng·ªØ c·∫£nh vƒÉn h√≥a)", time: "evening", importance: 3, targetHours: 80 }
                  ]
                },
                "ÈáëËûç‰∏éÊàòÁï•‰∏≠Êñá (Finance & Strategy Chinese)": { 
                  icon: "üí°",
                  color: "#89ffea",
                  skills: [
                    { name: "ÈáëËûçÊúØËØ≠ (Thu·∫≠t ng·ªØ t√†i ch√≠nh)", time: "morning", importance: 5, targetHours: 160 },
                    { name: "ÊäïËµÑÊä•ÂëäÈòÖËØª (ƒê·ªçc hi·ªÉu b√°o c√°o ƒë·∫ßu t∆∞)", time: "afternoon", importance: 4, targetHours: 140 },
                    { name: "ÂÖ¨Âè∏Ê≤ªÁêÜ‰∏éÊ≥ïËßÑËØçÊ±á (Thu·∫≠t ng·ªØ ph√°p l√Ω & qu·∫£n tr·ªã)", time: "afternoon", importance: 3, targetHours: 110 },
                    { name: "Ë¥¢Âä°Êä•Ë°®Áî®ËØ≠ (Ng√¥n ng·ªØ b√°o c√°o t√†i ch√≠nh)", time: "morning", importance: 4, targetHours: 130 },
                    { name: "Âπ∂Ë¥≠‰∏éË∞àÂà§Áî®ËØ≠ (Ng√¥n ng·ªØ M&A & ƒê√†m ph√°n)", time: "evening", importance: 5, targetHours: 150 },
                    { name: "Â∏ÇÂú∫Ë∂ãÂäøË°®Ëææ (M√¥ t·∫£ xu h∆∞·ªõng kinh t·∫ø, t√†i ch√≠nh)", time: "evening", importance: 4, targetHours: 120 }
                  ]
                },
                "È´òÈò∂Ë°®Ëææ (Advanced Expression & Precision)": { 
                  icon: "üåü",
                  color: "#9dfree",
                  skills: [
                    { name: "È´òÁ∫ßËØçÊ±á‰∏éÊàêËØ≠ (T·ª´ v·ª±ng n√¢ng cao & Th√†nh ng·ªØ)", time: "morning", importance: 5, targetHours: 200 },
                    { name: "ËØ≠Ê∞î‰∏éËØ≠ÊÑü (C·∫£m gi√°c ng·ªØ ƒëi·ªáu & Ng·ªØ kh√≠)", time: "morning", importance: 4, targetHours: 180 },
                    { name: "‰π¶Èù¢Ë°®ËææÊäÄÂ∑ß (K·ªπ nƒÉng vi·∫øt formal)", time: "afternoon", importance: 4, targetHours: 160 },
                    { name: "ÂÖ¨‰ºóÊºîËÆ≤‰∏éËØ¥Êúç (Di·ªÖn thuy·∫øt & Thuy·∫øt ph·ª•c)", time: "evening", importance: 4, targetHours: 220 },
                    { name: "ÈÄªËæëË°®Ëææ (Tr√¨nh b√†y t∆∞ duy logic b·∫±ng ti·∫øng Trung)", time: "morning", importance: 4, targetHours: 190 }                  
                  ]
                },                
                "ÊñáÂåñ‰∏é‰∫∫ËÑâÁ≠ñÁï• (Cultural Intelligence & Guanxi Strategy)": { 
                  icon: "üèÆ",
                  color: "#62ffea",
                  skills: [
                    { name: "ÂÖ≥Á≥ªÁÆ°ÁêÜ (Guanxi ‚Äì Ngh·ªá thu·∫≠t x√¢y d·ª±ng quan h·ªá)", time: "evening", importance: 5, targetHours: 150 },
                    { name: "Èù¢Â≠êÊñáÂåñ (Face Culture ‚Äì Gi·ªØ th·ªÉ di·ªán & chi·∫øn l∆∞·ª£c l·ªùi n√≥i)", time: "evening", importance: 4, targetHours: 120 },
                    { name: "Èó¥Êé•Ë°®Ëææ‰∏éÂê´ËìÑÊ≤üÈÄö (C√°ch n√≥i v√≤ng, uy·ªÉn chuy·ªÉn)", time: "evening", importance: 4, targetHours: 130 },
                    { name: "Á§æ‰ºöÁ≠âÁ∫ß‰∏éÁß∞Âëº (C√°ch x∆∞ng h√¥ theo c·∫•p b·∫≠c)", time: "afternoon", importance: 3, targetHours: 80 },
                    { name: "‰∏≠Ë•øÊñáÂåñÂ∑ÆÂºÇ (Kh√°c bi·ªát vƒÉn h√≥a Trung ‚Äì T√¢y)", time: "afternoon", importance: 3, targetHours: 90 }
                  ]
                },
                "ÂïÜÂä°‰∏≠Êñá (Kinh doanh)": { 
                  icon: "üëî",
                  color: "#4effe0",
                  skills: [
                    { name: "ÂïÜÂä°‰ºöËÆÆ (H·ªçp kinh doanh)", time: "evening", importance: 5 },
                    { name: "ÂïÜÂä°Ë∞àÂà§ (ƒê√†m ph√°n kinh doanh)", time: "evening", importance: 5 },
                    { name: "È°πÁõÆ‰ªãÁªç (Gi·ªõi thi·ªáu d·ª± √°n)", time: "evening", importance: 4 },
                    { name: "Ë°å‰∏öÊúØËØ≠ (Thu·∫≠t ng·ªØ chuy√™n ng√†nh)", time: "afternoon", importance: 4 },
                    { name: "Ë∑®ÊñáÂåñÊ≤üÈÄö (Giao ti·∫øp xuy√™n vƒÉn h√≥a)", time: "evening", importance: 4 }
                  ]
                }
              }
            },

            tools: {
                title: "Finance Tools",
                categories: {
                    "Programming & Data": {
                        icon: "üíª",
                        color: "#3b82f6",
                        skills: [
                            { name: "Python for Finance (pandas, NumPy, matplotlib)", time: "morning", importance: 5, targetHours: 180 },
                            { name: "SQL for Data Analysis (joins, CTEs, window functions)", time: "morning", importance: 5, targetHours: 100 },
                            { name: "R for Statistics (ggplot2, quantmod)", time: "afternoon", importance: 4, targetHours: 120 },
                            { name: "VBA for Excel Automation", time: "afternoon", importance: 4, targetHours: 80 },
                            { name: "Git & Version Control", time: "evening", importance: 3, targetHours: 40 },
                            { name: "Jupyter Notebook / VS Code with Finance extensions", time: "morning", importance: 4, targetHours: 60 },
                            { name: "Financial APIs (Alpha Vantage, IEX Cloud, Yahoo Finance)", time: "afternoon", importance: 3, targetHours: 50 }
                        ]
                    },
                    "Spreadsheets & BI": {
                        icon: "üìä",
                        color: "#10b981",
                        skills: [
                            { name: "Excel Advanced (Power Query, Pivot Tables, Array Formulas)", time: "morning", importance: 5, targetHours: 120 },
                            { name: "Power BI (DAX, Power Query, Dashboards)", time: "afternoon", importance: 5, targetHours: 100 },
                            { name: "Tableau (Calculated Fields, LOD Expressions)", time: "afternoon", importance: 4, targetHours: 80 },
                            { name: "Google Sheets (Apps Script, ImportRange)", time: "evening", importance: 3, targetHours: 50 },
                            { name: "Excel Power Pivot (Data Model, Basic DAX)", time: "morning", importance: 4, targetHours: 55 },
                            { name: "Google Apps Script (Automate Sheets, Gmail)", time: "evening", importance: 3, targetHours: 40 }
                        ]
                    },
                    "Financial Platforms": {
                        icon: "üè¶",
                        color: "#f59e0b",
                        skills: [
                            { name: "Bloomberg Terminal (BQL, DAPI)", time: "afternoon", importance: 5, targetHours: 60 },
                            { name: "Capital IQ (Excel Plugin, Screening)", time: "afternoon", importance: 5, targetHours: 50 },
                            { name: "FactSet (Formula Builder, Analytics)", time: "afternoon", importance: 4, targetHours: 45 },
                            { name: "Refinitiv Eikon / Refinitiv Workspace", time: "afternoon", importance: 4, targetHours: 45 },
                            { name: "PitchBook Platform", time: "evening", importance: 3, targetHours: 30 },
                            { name: "Reuters Eikon", time: "afternoon", importance: 4, targetHours: 45 },
                            { name: "Morningstar Direct / Alternatives", time: "afternoon", importance: 3, targetHours: 35 }
                        ]
                    },
                    "Specialized Tools": {
                        icon: "üîß",
                        color: "#8b5cf6",
                        skills: [
                            { name: "Alteryx (Data Blending, Workflows)", time: "afternoon", importance: 3, targetHours: 70 },
                            { name: "MATLAB for Quantitative Finance", time: "morning", importance: 3, targetHours: 100 },
                            { name: "Jupyter Notebooks (Documentation, Reproducibility)", time: "evening", importance: 4, targetHours: 50 },
                            { name: "Docker & Cloud Deployment (AWS, Azure)", time: "evening", importance: 2, targetHours: 80 }
                        ]
                    },
                    "Accounting & ERP Systems": {
                        icon: "üìí",
                        color: "#9d4edd",
                        skills: [
                            { name: "QuickBooks / Xero (Financial Statements, Reconciliation)", time: "morning", importance: 4, targetHours: 60 },
                            { name: "SAP ERP (FI/CO modules - Report reading, Data extraction)", time: "afternoon", importance: 4, targetHours: 70 },
                            { name: "Oracle NetSuite (Multi-currency, Consolidation)", time: "afternoon", importance: 3, targetHours: 50 },
                            { name: "Microsoft Dynamics 365 Finance", time: "evening", importance: 3, targetHours: 45 },
                            { name: "Local Accounting Software (MISA, FAST)", time: "morning", importance: 4, targetHours: 40 }
                        ]
                    },
                    "Financial Modeling Templates": {
                        icon: "üìë",
                        color: "#ff6d00",
                        skills: [
                            { name: "Macabacus / Wall Street Prep Templates (Best Practice)", time: "morning", importance: 5, targetHours: 40 },
                            { name: "Custom Excel Add-ins (REFS, FV, TTS)", time: "afternoon", importance: 4, targetHours: 35 },
                            { name: "PPT/Excel Integration (Linking, Update Automation)", time: "afternoon", importance: 4, targetHours: 30 },
                            { name: "Financial Model Auditing Tools", time: "evening", importance: 3, targetHours: 25 }
                        ]
                    },
                    "Data Extraction & Automation": {
                        icon: "üï∑Ô∏è",
                        color: "#00b4d8",
                        skills: [
                            { name: "Python BeautifulSoup/Selenium (Web Scraping)", time: "morning", importance: 4, targetHours: 80 },
                            { name: "Octoparse / ParseHub (No-code Scraping)", time: "afternoon", importance: 3, targetHours: 40 },
                            { name: "PDF Data Extraction (Tabula, Camelot)", time: "afternoon", importance: 3, targetHours: 35 },
                            { name: "OCR for Financial Documents (ABBYY, Tesseract)", time: "evening", importance: 2, targetHours: 30 },
                            { name: "Power Automate (MS Flow)", time: "afternoon", importance: 4, targetHours: 45 },
                            { name: "Zapier / Make (Integration Automation)", time: "evening", importance: 3, targetHours: 40 }
                        ]
                    },
                    "Deal Management & Collaboration": {
                        icon: "ü§ù",
                        color: "#ff9e00",
                        skills: [
                            { name: "Virtual Data Rooms (Datasite, Intralinks, Merrill)", time: "afternoon", importance: 4, targetHours: 25 },
                            { name: "Deal Management Software (DealCloud, Affinity)", time: "afternoon", importance: 3, targetHours: 30 },
                            { name: "DocuSign / Adobe Sign (E-signature Workflows)", time: "evening", importance: 3, targetHours: 15 },
                            { name: "MS Teams / Slack Integration with Finance Tools", time: "evening", importance: 3, targetHours: 20 }
                        ]
                    },
                    "Visualization & Presentation": {
                        icon: "üé®",
                        color: "#ff0054",
                        skills: [
                            { name: "Think-Cell (PowerPoint Charts Automation)", time: "afternoon", importance: 5, targetHours: 35 },
                            { name: "Datawrapper / Flourish (Interactive Charts)", time: "evening", importance: 3, targetHours: 40 },
                            { name: "Adobe Illustrator for Financial Graphics", time: "evening", importance: 2, targetHours: 50 },
                            { name: "Canva for Investor Decks", time: "evening", importance: 2, targetHours: 25 }
                        ]
                    },
                    "Free & Local Market Tools": {
                        icon: "üéØ",
                        color: "#7b2cbf",
                        skills: [
                            { name: "TradingView (Charting & Technical Analysis)", time: "morning", importance: 3, targetHours: 30 },
                            { name: "SEC EDGAR / Company Filings Navigation", time: "afternoon", importance: 4, targetHours: 25 },
                            { name: "FRED API / IMF/World Bank Data", time: "afternoon", importance: 3, targetHours: 35 },
                            { name: "FiinTrade / StoxPlus (Vietnam Market Data)", time: "morning", importance: 4, targetHours: 40 },
                            { name: "Google Finance / Yahoo Finance", time: "morning", importance: 3, targetHours: 20 }
                        ]
                    }
                }
            },

            cfa1: {
                title: "CFA Level 1 Skills",
                categories: {
                    "Ethical and Professional Standards": {
                        icon: "‚öñÔ∏è",
                        color: "#19ff8e",
                        skills: [
                            { name: "Code of Ethics and Standards of Professional Conduct", time: "evening", importance: 5, targetHours: 45 },
                            { name: "Guidance for Standard I(VII)", time: "evening", importance: 5, targetHours: 55 },
                            { name: "Application of Standards and Best Practices", time: "evening", importance: 4, targetHours: 35 },
                            { name: "Topic Review & Practice Questions", time: "evening", importance: 5, targetHours: 40 }
                        ]
                    },
                    "Quantitative Methods": {
                        icon: "üìä",
                        color: "#32ff9b",
                        skills: [
                            { name: "Time Value of Money", time: "morning", importance: 5, targetHours: 30 },
                            { name: "Statistical Concepts and Market Returns", time: "morning", importance: 5, targetHours: 35 },
                            { name: "Probability Concepts", time: "morning", importance: 4, targetHours: 25 },
                            { name: "Common Probability Distributions", time: "morning", importance: 4, targetHours: 20 },
                            { name: "Sampling and Estimation", time: "afternoon", importance: 4, targetHours: 20 },
                            { name: "Hypothesis Testing", time: "afternoon", importance: 5, targetHours: 30 },
                            { name: "Correlation and Regression", time: "afternoon", importance: 5, targetHours: 35 },
                            { name: "Topic Review & Practice Questions", time: "evening", importance: 5, targetHours: 40 }
                        ]
                    },
                    "Economics": {
                        icon: "üåê",
                        color: "#4cffa7",
                        skills: [
                            { name: "Demand and Supply Analysis: Introduction", time: "morning", importance: 4, targetHours: 25 },
                            { name: "Demand and Supply Analysis: Consumer and Producer Surplus", time: "morning", importance: 4, targetHours: 20 },
                            { name: "Firm and Market Structures", time: "morning", importance: 4, targetHours: 30 },
                            { name: "Aggregate Output, Price Level, and Economic Growth", time: "morning", importance: 5, targetHours: 40 },
                            { name: "Understanding Business Cycles", time: "afternoon", importance: 4, targetHours: 35 },
                            { name: "Monetary and Fiscal Policy", time: "afternoon", importance: 5, targetHours: 45 },
                            { name: "International Trade and Capital Flows", time: "afternoon", importance: 4, targetHours: 30 },
                            { name: "Topic Review & Practice Questions", time: "evening", importance: 5, targetHours: 50 }               
                        ]
                    },
                    "Financial Statement Analysis": {
                        icon: "üìã",
                        color: "#66ffb4",
                        skills: [
                            { name: "Financial Reporting Standards", time: "morning", importance: 4, targetHours: 25 },
                            { name: "Understanding Income Statements", time: "morning", importance: 5, targetHours: 40 },
                            { name: "Understanding Balance Sheets", time: "morning", importance: 5, targetHours: 40 },
                            { name: "Understanding Cash Flow Statements", time: "morning", importance: 5, targetHours: 45 },
                            { name: "Financial Analysis Techniques", time: "afternoon", importance: 4, targetHours: 35 },
                            { name: "Inventory Valuation Methods", time: "afternoon", importance: 4, targetHours: 25 },
                            { name: "Long-lived Assets", time: "afternoon", importance: 4, targetHours: 30 },
                            { name: "Income Taxes", time: "evening", importance: 3, targetHours: 20 },
                            { name: "Non-current (Long-term) Liabilities", time: "afternoon", importance: 4, targetHours: 30 },
                            { name: "Leases", time: "afternoon", importance: 4, targetHours: 25 },
                            { name: "Financial Reporting Quality", time: "evening", importance: 3, targetHours: 20 },
                            { name: "Applications of Financial Statement Analysis", time: "afternoon", importance: 4, targetHours: 30 },
                            { name: "Topic Review & Practice Questions", time: "evening", importance: 5, targetHours: 60 }
                        ]
                    },
                    "Corporate Issuers": {
                        icon: "üè¢",
                        color: "#7fffc0",
                        skills: [
                            { name: "Corporate Governance and ESG: Overview", time: "evening", importance: 4, targetHours: 25 },
                            { name: "Capital Budgeting", time: "afternoon", importance: 5, targetHours: 40 },
                            { name: "Cost of Capital", time: "afternoon", importance: 5, targetHours: 45 },
                            { name: "Capital Structure", time: "afternoon", importance: 4, targetHours: 35 },
                            { name: "Dividend Policy", time: "evening", importance: 3, targetHours: 20 },
                            { name: "Working Capital Management", time: "afternoon", importance: 4, targetHours: 30 },
                            { name: "Topic Review & Practice Questions", time: "evening", importance: 5, targetHours: 40 }
                        ]
                    },
                    "Equity Investments": {
                        icon: "üìà",
                        color: "#00ff82",
                        skills: [
                            { name: "Market Organization and Structure", time: "afternoon", importance: 3, targetHours: 20 },
                            { name: "Security Market Indexes", time: "afternoon", importance: 3, targetHours: 15 },
                            { name: "Market Efficiency", time: "afternoon", importance: 4, targetHours: 25 },
                            { name: "Overview of Equity Securities", time: "afternoon", importance: 4, targetHours: 30 },
                            { name: "Introduction to Industry and Company Analysis", time: "afternoon", importance: 4, targetHours: 35 },
                            { name: "Equity Valuation: Concepts and Basic Tools", time: "morning", importance: 5, targetHours: 50 },
                            { name: "Topic Review & Practice Questions", time: "evening", importance: 5, targetHours: 45 }
                        ]
                    },
                    "Fixed Income": {
                        icon: "üè¶",
                        color: "#00e675",
                        skills: [
                            { name: "Fixed-Income Securities: Defining Elements", time: "afternoon", importance: 4, targetHours: 35 },
                            { name: "Fixed-Income Markets: Issuance, Trading, and Funding", time: "afternoon", importance: 3, targetHours: 20 },
                            { name: "Introduction to Fixed-Income Valuation", time: "afternoon", importance: 5, targetHours: 55 },
                            { name: "Introduction to Asset-Backed Securities", time: "evening", importance: 2, targetHours: 15 },
                            { name: "Credit Analysis", time: "evening", importance: 3, targetHours: 25 },
                            { name: "Topic Review & Practice Questions", time: "evening", importance: 5, targetHours: 50 }
                        ]
                    },
                    "Derivatives": {
                        icon: "üìê",
                        color: "#00ff82",
                        skills: [
                            { name: "Derivative Markets and Instruments", time: "afternoon", importance: 4, targetHours: 25 },
                            { name: "Basics of Derivative Pricing and Valuation", time: "afternoon", importance: 4, targetHours: 35 },
                            { name: "Forward Commitments", time: "afternoon", importance: 4, targetHours: 30 },
                            { name: "Options Basics (Calls, Puts)", time: "afternoon", importance: 4, targetHours: 40 },
                            { name: "Topic Review & Practice Questions", time: "evening", importance: 5, targetHours: 45 } 
                        ]
                    },
                    "Alternative Investments": {
                        icon: "üå±",
                        color: "#1aff8f",
                        skills: [
                            { name: "Alternative Investments Overview", time: "evening", importance: 3, targetHours: 20 },
                            { name: "Private Equity", time: "evening", importance: 3, targetHours: 25 },
                            { name: "Real Estate", time: "evening", importance: 3, targetHours: 25 },
                            { name: "Hedge Funds", time: "evening", importance: 3, targetHours: 25 },
                            { name: "Commodities and Natural Resources", time: "evening", importance: 2, targetHours: 15 },
                            { name: "Real Assets (Infrastructure, Timberland, Farmland)", time: "evening", importance: 2, targetHours: 15 },
                            { name: "Topic Review & Practice Questions", time: "evening", importance: 5, targetHours: 30 }
                        ]
                    },
                    "Portfolio Management and Wealth Planning": {
                        icon: "üß≠",
                        color: "#33ff9b",
                        skills: [
                            { name: "Portfolio Management Overview", time: "evening", importance: 3, targetHours: 20 },
                            { name: "Portfolio Risk and Return: Part I", time: "morning", importance: 5, targetHours: 45 },
                            { name: "Portfolio Risk and Return: Part II", time: "morning", importance: 4, targetHours: 35 },
                            { name: "Basics of Portfolio Planning and Construction", time: "afternoon", importance: 4, targetHours: 30 },
                            { name: "The Portfolio Management Process", time: "evening", importance: 3, targetHours: 20 },
                            { name: "Capital Market Theory", time: "morning", importance: 4, targetHours: 35 },
                            { name: "Basics of Risk Management", time: "evening", importance: 3, targetHours: 25 },
                            { name: "Introduction to Behavioral Finance", time: "evening", importance: 3, targetHours: 25 },
                            { name: "Introduction to Wealth Management", time: "evening", importance: 3, targetHours: 20 },
                            { name: "Topic Review & Practice Questions", time: "evening", importance: 5, targetHours: 50 }
                        ]
                    }
                }
            }
        };

        const careerIcons = {
            pe: "üíº",
            ib: "üè¶",
            hf: "üìà",
            sc: "üéØ",
            fintech: "üí≥",
            english: "üö©",
            chinese: "üíû",
            tools: "üõ†Ô∏è",
            cfa1: "üìú"
        };


        const defaultQuotes = [
            { text: "The expert in anything was once a beginner.", author: "Helen Hayes" },
            { text: "Face it: You're not 'overwhelmed'. You're just under-qualified and too lazy to fix it.", author: "" }
        ];


        // Load custom quotes from localStorage
        customQuotes = JSON.parse(localStorage.getItem('customQuotes')) || [];

        // Merge default + custom quotes
        let motivationalQuotes = [...defaultQuotes, ...customQuotes];



        let currentCareer = 'pe';
        let currentMood = 'focused';
        let studyHours = JSON.parse(localStorage.getItem('studyHours')) || {};
        let gamification = JSON.parse(localStorage.getItem('gamification')) || {
            points: 0,
            level: 1,
            streak: 0,
            lastStreakDate: null
        };

        let progressChart = null;

        // ===== DEFAULT MEMES =====
        const defaultMemes = [
            'https://i.pinimg.com/736x/fb/ac/5f/fbac5f18cf0ad901d9d36d30b0cf7f3f.jpg',
            'https://i.pinimg.com/736x/67/be/19/67be19c0a81a54e97c57fcc847c96525.jpg',
            'https://pbs.twimg.com/media/GYZwl3KbIAAb6tw?format=jpg&name=small'
        ];
        customMemes = JSON.parse(localStorage.getItem('customMemes')) || [];
        let allMemes = [...defaultMemes, ...customMemes];

        // ===== MEME MIGRATION  =====
        (function migrateMemes() {
            const needsMigration = customMemes.some(m => typeof m === 'string');
            if (needsMigration) {
                customMemes = customMemes.map(m => 
                    typeof m === 'string' 
                        ? { url: m, caption: 'No caption', addedAt: new Date().toISOString() }
                        : m
                );
                localStorage.setItem('customMemes', JSON.stringify(customMemes));
            }
            allMemes = [...defaultMemes.map(url => ({ url, caption: 'Built-in meme' })), ...customMemes];
        })();


        // --- ADHD-OPTIMIZED TIME-BASED SKILL MAP ---
        const moodSkillMap = {
            focused: { skills: [] },   // Morning: Deep work (modeling, Python, LBO)
            analytical: { skills: [] }, // Afternoon: Analysis & research
            creative: { skills: [] },   // Evening: Communication & soft skills
            random: { skills: [] }
        };

        Object.entries(skillsData).forEach(([careerKey, careerData]) => {
            Object.values(careerData.categories).forEach(category => {
                category.skills.forEach(skill => {
                    const skillName = skill.name;
                    const career = careerKey;
                    const time = skill.time || 'afternoon'; // default
                    
                    moodSkillMap.random.skills.push({ career, name: skillName });

                    // ‚úÖ ADHD-OPTIMIZED: Map by TIME, not by content type
                    if (time === 'morning') {
                        // Morning = Best focus ‚Üí Technical deep work
                        moodSkillMap.focused.skills.push({ career, name: skillName });
                    } else if (time === 'afternoon') {
                        // Afternoon = Medium focus ‚Üí Analysis & research
                        moodSkillMap.analytical.skills.push({ career, name: skillName });
                    } else if (time === 'evening' || time === 'night') {
                        // Evening/Night = Low focus ‚Üí Creative & soft skills
                        moodSkillMap.creative.skills.push({ career, name: skillName });
                    }
                });
            });
        });

        // Remove duplicates
        ['focused', 'analytical', 'creative'].forEach(mood => {
            moodSkillMap[mood].skills = [...new Map(
                moodSkillMap[mood].skills.map(item => [item.name, item])
            ).values()];
        });







        let quoteTimer;
        function getRandomQuote() {
            const randomIndex = Math.floor(Math.random() * motivationalQuotes.length);
            const quote = motivationalQuotes[randomIndex];
            document.getElementById('quoteText').textContent = quote.text;
            document.getElementById('quoteAuthor').textContent = quote.author ? `- ${quote.author}` : '';
            if (quoteTimer) {
                clearTimeout(quoteTimer);
            }
            quoteTimer = setTimeout(getRandomQuote, 1200000); 
        }

        window.addEventListener('beforeunload', () => {
            if (quoteTimer) {
                clearTimeout(quoteTimer);
                console.log("Cleared quoteTimer on unload.");
            }
        });


        // ===== CUSTOM QUOTES MANAGEMENT =====

        // Function: Add Custom Quote
        function addCustomQuote() {
            const text = document.getElementById('customQuoteText').value.trim();
            const author = document.getElementById('customQuoteAuthor').value.trim();
            
            if (!text) {
                showNotification('‚ùå Please enter quote text!', 'error');
                return;
            }
            
            // Check for duplicates
            const isDuplicate = customQuotes.some(q => q.text.toLowerCase() === text.toLowerCase());
            if (isDuplicate) {
                showNotification('‚ö†Ô∏è This quote already exists!', 'error');
                return;
            }
            
            const newQuote = { 
                text, 
                author,
                id: Date.now(), 
                addedAt: new Date().toISOString()
            };
            
            customQuotes.push(newQuote);
            motivationalQuotes.push(newQuote);
            
            // Save to localStorage
            localStorage.setItem('customQuotes', JSON.stringify(customQuotes));
            
            // Clear inputs
            document.getElementById('customQuoteText').value = '';
            document.getElementById('customQuoteAuthor').value = '';
            
            // Update count
            updateCustomQuotesCount();
            
            // Show success + new quote
            showNotification('‚úÖ Quote added successfully!', 'success');
            getRandomQuote(); // Show the new quote immediately
        }

        // Function: Update Custom Quotes Count
        function updateCustomQuotesCount() {
            const countEl = document.getElementById('customQuotesCount');
            if (countEl) {
                countEl.textContent = customQuotes.length;
            }
        }

        // Function: Open Manage Quotes Modal
        function openManageQuotesModal() {
            if (customQuotes.length === 0) {
                showNotification('üìù No custom quotes yet. Add some first!', 'info');
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'manageQuotesModal';
            modal.style.cssText = `
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.6);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(4px);
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--bg-white); border-radius: 16px; max-width: 700px; width: 100%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <!-- Header -->
                    <div style="padding: 24px; border-bottom: 1px solid var(--border-color); position: sticky; top: 0; background: var(--bg-white); z-index: 1;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h2 style="margin: 0 0 8px 0; font-size: 1.5rem; color: var(--text-dark);">
                                    üìã Manage Your Custom Quotes
                                </h2>
                                <p style="margin: 0; color: var(--text-muted); font-size: 0.9rem;">
                                    ${customQuotes.length} custom quotes
                                </p>
                            </div>
                            <button onclick="closeManageQuotesModal()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: var(--text-muted);">
                                √ó
                            </button>
                        </div>
                    </div>
                    
                    <!-- Body -->
                    <div style="padding: 20px;">
                        ${renderCustomQuotesList()}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close on backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeManageQuotesModal();
                }
            });
        }

        // Function: Close Manage Quotes Modal
        function closeManageQuotesModal() {
            const modal = document.getElementById('manageQuotesModal');
            if (modal) modal.remove();
        }

        // Function: Render Custom Quotes List
        function renderCustomQuotesList() {
            if (customQuotes.length === 0) {
                return '<p style="text-align: center; color: var(--text-muted); padding: 40px;">No custom quotes yet.</p>';
            }
            
            return customQuotes.map((quote, index) => `
                <div style="background: var(--bg-light); padding: 16px; border-radius: 12px; margin-bottom: 12px; border-left: 4px solid #f59e0b;">
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 12px;">
                        <div style="flex: 1;">
                            <div style="font-size: 1rem; color: var(--text-dark); margin-bottom: 6px; line-height: 1.5;">
                                "${quote.text}"
                            </div>
                            ${quote.author ? `
                                <div style="font-size: 0.85rem; color: var(--text-muted); font-style: italic;">
                                    ‚Äî ${quote.author}
                                </div>
                            ` : ''}
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 6px;">
                                Added: ${new Date(quote.addedAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                            </div>
                        </div>
                        
                        <button 
                            onclick="deleteCustomQuote(${quote.id})" 
                            style="background: #ef4444; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; white-space: nowrap;">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Function: Delete Custom Quote
        function deleteCustomQuote(quoteId) {
            if (!confirm('üóëÔ∏è Delete this quote?')) return;
            
            // Remove from customQuotes
            customQuotes = customQuotes.filter(q => q.id !== quoteId);
            
            // Remove from motivationalQuotes
            motivationalQuotes = [...defaultQuotes, ...customQuotes];
            
            // Save to localStorage
            localStorage.setItem('customQuotes', JSON.stringify(customQuotes));
            
            // Update UI
            updateCustomQuotesCount();
            
            // Re-render modal content
            const modalBody = document.querySelector('#manageQuotesModal > div > div:last-child');
            if (modalBody) {
                modalBody.innerHTML = renderCustomQuotesList();
            }
            
            // Update header count
            const headerCount = document.querySelector('#manageQuotesModal p');
            if (headerCount) {
                headerCount.textContent = `${customQuotes.length} custom quotes`;
            }
            
            showNotification('Quote deleted', 'info');
        }

        // Initialize count on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateCustomQuotesCount();
        });


        

        document.addEventListener('DOMContentLoaded', function() {
            const savedCareer = localStorage.getItem('currentCareer');
            const careerToLoad = savedCareer || 'pe';
            loadCareer(careerToLoad);
            updateStats();
            updateGamificationStats();
            updateDailyStreak();
            initChart();
            getRandomMeme();
            updateDailyStudyDisplay();


            // --- GOAL PROGRESS CHART ---
            let goalProgressChart = null;
            function initGoalProgressChart() {
                const ctx = document.getElementById('goalProgressChart').getContext('2d');                
                if (goalProgressChart) {
                    goalProgressChart.destroy();
                }
                const filteredGoals = goals.filter(g => g.career === currentCareer);
                const totalGoals = filteredGoals.length;
                const completedGoals = filteredGoals.filter(g => getGoalStatus(g) === 'completed').length;
                const completionRate = totalGoals > 0 ? Math.round((completedGoals / totalGoals) * 100) : 0;
                const data = {
                    labels: ['Completed', 'Remaining'],
                    datasets: [{
                        data: [completedGoals, totalGoals - completedGoals],
                        backgroundColor: [
                            '#10b981', 
                            '#e2e8f0'  
                        ],
                        borderColor: [
                            '#059669',
                            '#cbd5e1'
                        ],
                        borderWidth: 2,
                        cutout: '70%'
                    }]
                };
                const options = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    return `${label}: ${value}`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: `${completionRate}% Complete`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: 'var(--text-dark)',
                            padding: 10
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutBounce'
                    }
                };
                goalProgressChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: data,
                    options: options
                });
                document.getElementById('goalProgressSummary').textContent = `${completedGoals}/${totalGoals} goals completed`;
            }


            function updateGoalProgressChart() {
                if (document.getElementById('goalProgressChart')) {
                    initGoalProgressChart();
                }
            }            
            loadSleepData(); 
            document.querySelector(`.mood-btn[data-mood="${currentMood}"]`).classList.add('active');
            suggestSkillByMood();
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentMood = this.dataset.mood;
                    suggestSkillByMood();
                });
            });
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                updateChartColors();
            }
            getRandomQuote();
        });            

        function selectCareer(career) {
            localStorage.setItem('currentCareer', career); 
            loadCareer(career);
        }

        function loadCareer(career) {
            currentCareer = career;
            document.querySelectorAll('.career-card').forEach(card => card.classList.remove('selected'));
            document.querySelector(`[data-career="${career}"]`).classList.add('selected');
            document.getElementById('career-title').textContent = skillsData[career].title;
            document.getElementById('currentCareerTitle').textContent = skillsData[career].title;
            loadSkills(career);
            updateStats();
            updateChart();
            renderCourses();
            document.getElementById('goalsSection').style.display = 'block'; 
            updateGoals();
        }


        function loadSkills(career) {
            const container = document.getElementById('skillsContainer');
            container.innerHTML = '';
            const careerData = skillsData[career];

            Object.entries(careerData.categories).forEach(([categoryName, categoryData]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'skill-category';
                const sortedSkills = [...categoryData.skills].sort((a, b) => b.importance - a.importance);

                categoryDiv.innerHTML = `
                    <div class="category-header" onclick="toggleCategory(this)" data-category="${career}-${categoryName}">
                        <div class="category-info">
                            <span class="category-icon">${categoryData.icon}</span>
                            <span class="category-title">${categoryName}</span>
                        </div>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="skills-list">
                        ${sortedSkills.map(skill => {
                            const hoursStudied = getSkillHours(career, skill.name);
                            const targetHours = skill.targetHours || 10; // Fallback to 10 if not set
                            const progressPercent = Math.min(100, (hoursStudied / targetHours) * 100);
                            const isDone = hoursStudied >= targetHours;

                            return `
                            <div class="skill-item ${isDone ? 'skill-done' : ''}" data-career="${career}">
                                <div class="skill-info">
                                    <div class="skill-name">
                                        ${skill.name} 
                                        ${isDone ? '<span style="color: #10b981; font-weight: bold;">‚úÖ</span>' : ''}
                                    </div>
                                    <div class="skill-meta">
                                        <div class="skill-time">
                                            ${getTimeIcon(skill.time)} ${skill.time.charAt(0).toUpperCase() + skill.time.slice(1)}
                                        </div>
                                        <div class="skill-hours">
                                            üïí ${hoursStudied.toFixed(1)} / ${targetHours} hours
                                        </div>
                                        <div class="skill-progress-container">
                                            <div class="skill-progress-fill" style="width: ${progressPercent}%"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="skill-controls">
                                    <input type="number" class="time-input" min="0" step="0.5" placeholder="0.5">
                                    <button class="add-time-btn" onclick="subtractStudyTime('${career}', '${skill.name}', this)" 
                                            style="background: #ef4444; margin-right: 5px;" 
                                            title="Subtract hours">
                                        -
                                    </button>
                                    <button class="add-time-btn" onclick="addStudyTime('${career}', '${skill.name}', this)">
                                        +
                                    </button>
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                `;
                container.appendChild(categoryDiv);

                // Restore collapse state
                Object.entries(careerData.categories).forEach(([categoryName]) => {
                    const categoryKey = `${career}-${categoryName}`;
                    const isExpanded = localStorage.getItem(`categoryExpanded_${categoryKey}`);
                    const header = document.querySelector(`[data-category="${categoryKey}"]`);
                    const skillsList = header?.nextElementSibling;

                    if (header && skillsList) {
                        if (isExpanded === 'false') {
                            skillsList.classList.add('collapsed');
                            header.querySelector('.toggle-icon').textContent = '‚ñ∂';
                            header.querySelector('.toggle-icon').classList.add('collapsed');
                        } else {
                            skillsList.classList.remove('collapsed');
                            header.querySelector('.toggle-icon').textContent = '‚ñº';
                            header.querySelector('.toggle-icon').classList.remove('collapsed');
                        }
                    }
                });
            });
        }

        function renderSkills(career) {
            const container = document.getElementById('skillsContainer');
            const data = skillsData[career];
            
            let html = '';
            
            for (const [category, content] of Object.entries(data.categories)) {
                html += `
                    <div class="category-section" data-career="${career}">
                        <div class="category-header">
                            <span class="category-icon">${content.icon}</span>
                            <h3 class="category-name">${category}</h3>
                            <span class="category-count">${content.skills.length} skills</span>
                        </div>
                        <div class="skills-grid">
                `;
                
                content.skills.forEach(skill => {
                    html += `
                        <div class="skill-item" data-career="${career}" data-importance="${skill.importance}">
                            <!-- skill content -->
                        </div>
                    `;
                });
                
                html += `</div></div>`;
            }
            
            container.innerHTML = html;
        }

        function getTimeIcon(time) {
            const icons = {
                morning: 'üåÖ',
                afternoon: '‚òÄÔ∏è',
                evening: 'üåÜ',
                night: 'üåô'
            };
            return icons[time] || '‚è∞';
        }

        function getSkillHours(career, skillName) {
            return studyHours[career]?.[skillName] || 0;
        }

        function addStudyTime(career, skillName, button) {
            const controls = button.parentElement;
            const input = controls.querySelector('.time-input');
            const hours = parseFloat(input.value);
            
            if (!hours || hours <= 0) {
                showNotification('Please enter a valid number of hours', 'error');
                return;
            }

            if (!studyHours[career]) studyHours[career] = {};
            if (!studyHours[career][skillName]) studyHours[career][skillName] = 0;

            const careerData = skillsData[career];
            let targetHours = 10; // default
            let skillFound = false;
            
            Object.values(careerData.categories).forEach(category => {
                const skill = category.skills.find(s => s.name === skillName);
                if (skill) {
                    targetHours = skill.targetHours || 10;
                    skillFound = true;
                }
            });
            
            const currentHours = studyHours[career][skillName];

            if (currentHours >= targetHours) {
                showNotification(`‚ùå Skill "${skillName}" is already complete! (${currentHours.toFixed(1)}/${targetHours}h)`, 'error');
                input.value = '';
                return;
            }

            const newTotal = currentHours + hours;
            
            if (newTotal > targetHours) {
                const remainingHours = targetHours - currentHours;
                studyHours[career][skillName] = targetHours;
                
                showNotification(`‚úÖ Added ${remainingHours.toFixed(1)}h to reach target! Skill complete at ${targetHours}h. Earned ${Math.floor(remainingHours * 10)} XP`, 'achievement');
            } else {
                studyHours[career][skillName] += hours;
                
                const pointsEarned = Math.floor(hours * 10);
                gamification.points += pointsEarned;
                
                showNotification(`‚úÖ Added ${hours}h to ${skillName}! Earned ${pointsEarned} XP`, 'success');
            }
            
            gamification.level = Math.floor(gamification.points / 100) + 1;
            localStorage.setItem('studyHours', JSON.stringify(studyHours));
            localStorage.setItem('gamification', JSON.stringify(gamification));
            input.value = '';
            loadSkills(career);
            updateStats();
            updateGamificationStats();
            updateChart();
            updateDailyStreak();
            updateGoals(); 
            updateDailyStudyData(hours);
            checkAchievements(career, skillName, studyHours[career][skillName]);
            getRandomQuote();
            triggerBackup();
        }

        function subtractStudyTime(career, skillName, button) {
            const controls = button.parentElement;
            const input = controls.querySelector('.time-input');
            const hours = parseFloat(input.value);
            
            if (!hours || hours <= 0) {
                showNotification('Please enter a valid number of hours to subtract', 'error');
                return;
            }

            if (!studyHours[career] || !studyHours[career][skillName]) {
                showNotification('No hours recorded for this skill yet', 'error');
                return;
            }
            
            const currentHours = studyHours[career][skillName];

            if (currentHours - hours < 0) {
                showNotification(`‚ùå Cannot subtract ${hours}h. Current: ${currentHours.toFixed(1)}h`, 'error');
                return;
            }

            studyHours[career][skillName] -= hours;

            if (studyHours[career][skillName] === 0) {
                delete studyHours[career][skillName];
            }

            const pointsLost = Math.floor(hours * 10);
            gamification.points = Math.max(0, gamification.points - pointsLost);
            gamification.level = Math.floor(gamification.points / 100) + 1;
            
            localStorage.setItem('studyHours', JSON.stringify(studyHours));
            localStorage.setItem('gamification', JSON.stringify(gamification));

            input.value = '';
            loadSkills(career);
            updateStats();
            updateGamificationStats();
            updateChart();
            updateGoals();
            
            showNotification(`‚úÖ Subtracted ${hours}h from ${skillName}. Lost ${pointsLost} XP`, 'info');
            triggerBackup();
        }


        function toggleCategory(header) {
            const skillsList = header.nextElementSibling;
            const categoryKey = header.dataset.category; 
            if (skillsList.classList.contains('collapsed')) {
                skillsList.classList.remove('collapsed');
                header.querySelector('.toggle-icon').textContent = '‚ñº';
                header.querySelector('.toggle-icon').classList.remove('collapsed');
                localStorage.setItem(`categoryExpanded_${categoryKey}`, 'true');
            } else {
                skillsList.classList.add('collapsed');
                header.querySelector('.toggle-icon').textContent = '‚ñ∂';
                header.querySelector('.toggle-icon').classList.add('collapsed');
                localStorage.setItem(`categoryExpanded_${categoryKey}`, 'false');
            }
        }

        function updateStats() {
            const careerData = skillsData[currentCareer];
            let totalSkills = 0;
            let completedSkills = 0;
            Object.values(careerData.categories).forEach(category => {
                category.skills.forEach(skill => {
                    totalSkills++;
                    const hoursStudied = getSkillHours(currentCareer, skill.name);
                    const targetHours = skill.targetHours || 10;

                    if (hoursStudied >= targetHours) {
                        completedSkills++;
                    }
                });
            });
            const currentCareerProgressPercent = totalSkills > 0 
                ? (completedSkills / totalSkills) * 100 
                : 0;  
            document.getElementById('total-progress').textContent = currentCareerProgressPercent.toFixed(1);
            document.getElementById('career-progress-bar').style.width = `${Math.min(100, currentCareerProgressPercent)}%`;

            let overallTotalHours = 0;
            Object.keys(studyHours).forEach(career => {
                overallTotalHours += Object.values(studyHours[career]).reduce((sum, h) => sum + h, 0);
            });
            document.getElementById('totalHours').textContent = `${overallTotalHours.toFixed(1)} hours`;
        }



        function suggestSkillByMood() {
            const suggestionDiv = document.getElementById('learningMoodWidget');
            const suggestionText = document.getElementById('learningMoodSkillText');

            if (!suggestionDiv || !suggestionText) return;

            suggestionDiv.style.display = 'none';

            const eligibleSkills = moodSkillMap[currentMood].skills;
            if (!eligibleSkills || eligibleSkills.length === 0) {
                suggestionText.innerHTML = "<em>No skills mapped for this mood yet.</em>";
                suggestionDiv.style.display = 'block';
                return;
            }

            // **FILTER OUT COMPLETED SKILLS**
            const incompleteSkills = eligibleSkills.filter(skillObj => {
                const career = skillObj.career;
                const skillName = skillObj.name;
                const careerData = skillsData[career];
                
                if (!careerData) return false;
                
                let foundSkill = null;
                Object.values(careerData.categories).some(category => {
                    foundSkill = category.skills.find(s => s.name === skillName);
                    return !!foundSkill;
                });
                
                if (!foundSkill) return false;
                
                const hoursStudied = getSkillHours(career, skillName);
                const targetHours = foundSkill.targetHours || 10;
                
                return hoursStudied < targetHours; // Only incomplete skills
            });

            if (incompleteSkills.length === 0) {
                suggestionText.innerHTML = `<em>üéâ All ${currentMood} skills completed! Try another mood.</em>`;
                suggestionDiv.style.display = 'block';
                return;
            }

            // Pick random incomplete skill
            const randomSkill = incompleteSkills[Math.floor(Math.random() * incompleteSkills.length)];
            const career = randomSkill.career;
            const skillName = randomSkill.name;
            const careerData = skillsData[career];

            let foundSkill = null;
            Object.values(careerData.categories).some(category => {
                foundSkill = category.skills.find(s => s.name === skillName);
                if (foundSkill) return true;
                return false;
            });

            const timeIcon = getTimeIcon(foundSkill?.time || '‚è∞');
            const priority = foundSkill?.importance || 3;
            const priorityIcon = getPriorityIcon(priority);

            suggestionText.innerHTML = `
                <strong>${skillName}</strong><br>
                <small style="color: var(--text-muted);">${careerData.title} ‚Ä¢ ${timeIcon} ${priorityIcon}</small>
            `;
            suggestionDiv.style.display = 'block';
        }

        function checkAchievements(career, skillName, totalHours) {
            const careerData = skillsData[career];
            if (!careerData) return;
            
            let targetHours = 10; // Default
            Object.values(careerData.categories).some(category => {
                const skill = category.skills.find(s => s.name === skillName);
                if (skill) {
                    targetHours = skill.targetHours || 10;
                    return true;
                }
                return false;
            });
            
            // Achievement milestones
            if (totalHours === 1) {
                addAchievement(`üéØ First hour in ${skillName}!`);
                showNotification(`Achievement Unlocked: First hour in ${skillName}!`, 'achievement');
            } else if (totalHours === 5) {
                addAchievement(`üöÄ 5 hours milestone in ${skillName}!`);
                showNotification(`Achievement Unlocked: 5 hours milestone!`, 'achievement');
            } else if (totalHours >= targetHours) {
                addAchievement(`üí™ MASTERED: ${skillName} (${targetHours}h)!`);
                showNotification(`üéâ Achievement Unlocked: ${skillName} MASTERED!`, 'achievement');
            }
        }


        function getSkillCompletion(career, skillName) {
            const careerData = skillsData[career];
            if (!careerData) return { completed: false, progress: 0, target: 10 };
            
            let targetHours = 10;
            Object.values(careerData.categories).some(category => {
                const skill = category.skills.find(s => s.name === skillName);
                if (skill) {
                    targetHours = skill.targetHours || 10;
                    return true;
                }
                return false;
            });
            
            const hoursStudied = getSkillHours(career, skillName);
            return {
                completed: hoursStudied >= targetHours,
                progress: hoursStudied,
                target: targetHours,
                percent: Math.min(100, (hoursStudied / targetHours) * 100)
            };
        }


        function addAchievement(text) {
            const achievementsDiv = document.getElementById('achievements');
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.textContent = text;
            achievementsDiv.appendChild(achievement);
            setTimeout(() => {
                if (achievement.parentNode) {
                    achievement.parentNode.removeChild(achievement);
                }
            }, 10000);
        }


        function updateDailyStreak() {
            const today = new Date().toDateString();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            if (gamification.lastStreakDate !== today) {
                if (gamification.lastStreakDate === yesterday.toDateString()) {
                    gamification.streak += 1;
                } else {
                    gamification.streak = 1;
                }
                gamification.lastStreakDate = today;
                localStorage.setItem('gamification', JSON.stringify(gamification));

                if (gamification.streak % 7 === 0) {
                    addAchievement(`üî• ${gamification.streak} day streak! Keep going!`);
                    showNotification(`Achievement Unlocked: ${gamification.streak} day streak!`, 'achievement');
                }
            }
            updateGamificationStats();
        }

        function updateGamificationStats() {
            document.getElementById('levelBadge').textContent = `Level ${gamification.level}`;
            document.getElementById('pointsDisplay').textContent = `${gamification.points} XP`;
            document.getElementById('streakDisplay').textContent = `${gamification.streak} day streak`;
        }

        function initChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            progressChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['PE', 'IB', 'HF', 'SC', 'Fintech', 'English', 'Chinese', 'Tools', 'CFA L1'],
                    datasets: [{
                        label: 'Hours Studied',
                        data: [0, 0, 0, 0, 0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#e74c3c', // PE
                            '#3498db', // IB
                            '#f39c12', // HF
                            '#2ecc71', // SC
                            '#00ffef', // Fintech
                            '#fbe82c', // English
                            '#00ffd2', // Chinese
                            '#ff1265', // Tools 
                            '#00ff82'  // CFA L1 
                        ],
                        borderColor: Array(8).fill('#c4d3e0'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#666'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#666'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }


        function updateChart() {
            if (!progressChart) return;
            const hours = [
                calculateTotalHours('pe'),
                calculateTotalHours('ib'),
                calculateTotalHours('hf'),
                calculateTotalHours('sc'),
                calculateTotalHours('fintech'),
                calculateTotalHours('english'),
                calculateTotalHours('chinese'),
                calculateTotalHours('tools'), 
                calculateTotalHours('cfa1')    
            ];
            progressChart.data.datasets[0].data = hours;
            progressChart.update();
        }       


        function updateChartColors() {
            if (!progressChart) return;
            const isDarkMode = document.body.classList.contains('dark-mode');
            const textColor = isDarkMode ? '#cbd5e1' : '#666';
            progressChart.options.scales.x.ticks.color = textColor;
            progressChart.options.scales.y.ticks.color = textColor;
            progressChart.update();
        }

        function calculateTotalHours(career) {
            if (!studyHours[career]) return 0;
            return Object.values(studyHours[career]).reduce((sum, hours) => sum + hours, 0);
        }


        function toggleDarkMode() {
            const body = document.body;
            const isDark = body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDark);
            updateChartColors();
            if (sleepChart) {
                const textColor = isDark ? '#cbd5e1' : '#666';
                sleepChart.options.scales.y.ticks.color = textColor;
                sleepChart.options.scales.x.ticks.color = textColor;
                sleepChart.update();
            }
            if (dailyStudyChart) {
                const textColor = isDark ? '#cbd5e1' : '#666';
                dailyStudyChart.options.scales.y.ticks.color = textColor;
                dailyStudyChart.options.scales.x.ticks.color = textColor;
                dailyStudyChart.update();
            }
            if (goalProgressChart) {
                goalProgressChart.update();
            }
            body.style.transition = 'background-color 0.3s ease, color 0.3s ease';
            setTimeout(() => {
                body.style.transition = '';
            }, 300);
        }



        let sessionLogs = JSON.parse(localStorage.getItem('sessionLogs')) || [];
        
        function logSession() {
            const noteInput = document.getElementById('sessionNote');
            const noteText = noteInput.value.trim();
            if (!noteText) {
                showNotification('Please enter a note before logging!', 'error');
                return;
            }
            const newLog = {
                id: Date.now(),
                text: noteText,
                timestamp: new Date().toLocaleString('vi-VN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                })
            };
            sessionLogs.unshift(newLog);
            if (sessionLogs.length > 20) {
                sessionLogs.pop();
            }
            localStorage.setItem('sessionLogs', JSON.stringify(sessionLogs));
            noteInput.value = '';
            renderSessionLogs();
            showNotification('‚úÖ Session logged successfully!', 'success');
        }
        
        // --- SESSION LOGS MANAGEMENT ---
        function formatLogText(text) {
            if (!text) return '';
            let html = text.replace(/\n/g, '<br>');
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            return html;
        }

        function renderSessionLogs() {
            const container = document.getElementById('sessionLogsContainer');
            if (sessionLogs.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 10px;">No session logs yet...</p>';
                return;
            }
            container.innerHTML = sessionLogs.map(log => `
                <div class="session-log" data-id="${log.id}">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <div style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 4px;">${log.timestamp}</div>
                            <div style="color: var(--text-dark); white-space: normal;">${formatLogText(log.text)}</div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="editSessionLog(${log.id})" style="background: none; border: none; color: #3498db; cursor: pointer; font-size: 1rem;" title="S·ª≠a">‚úèÔ∏è</button>
                            <button onclick="deleteSessionLog(${log.id})" style="background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 1rem;" title="X√≥a">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        function deleteSessionLog(id) {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ghi ch√∫ n√†y?")) {
                sessionLogs = sessionLogs.filter(log => log.id !== id);
                localStorage.setItem('sessionLogs', JSON.stringify(sessionLogs));
                renderSessionLogs();
                showNotification('Ghi ch√∫ ƒë√£ ƒë∆∞·ª£c x√≥a!', 'success');
            }
        }

        function editSessionLog(id) {
            const log = sessionLogs.find(log => log.id === id);
            if (!log) return;
            const noteInput = document.getElementById('sessionNote');
            const currentText = log.text;
            noteInput.value = currentText;
            noteInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
            noteInput.focus();
            noteInput.dataset.editingId = id;
            showNotification('üìù Editing note. Click "Log Session" to save changes.', 'info');
        }


        function logSession() {
            const noteInput = document.getElementById('sessionNote');
            const noteText = noteInput.value.trim();
            if (!noteText) {
                showNotification('Please enter a note before logging!', 'error');
                return;
            }
            const editingId = noteInput.dataset.editingId;  
            if (editingId) {
                const log = sessionLogs.find(log => log.id === parseInt(editingId));
                if (log) {
                    log.text = noteText;
                    log.timestamp = new Date().toLocaleString('vi-VN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
                delete noteInput.dataset.editingId;
                showNotification('‚úÖ Note updated successfully!', 'success');
            } else {
                const newLog = {
                    id: Date.now(),
                    text: noteText,
                    timestamp: new Date().toLocaleString('vi-VN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    })
                };
                sessionLogs.unshift(newLog);
                if (sessionLogs.length > 20) {
                    sessionLogs.pop();
                }
                showNotification('‚úÖ Session logged successfully!', 'success');
            }
            localStorage.setItem('sessionLogs', JSON.stringify(sessionLogs));
            noteInput.value = '';
            renderSessionLogs();
        }


        let readingList = JSON.parse(localStorage.getItem('readingList')) || [];

        function escapeHtml(str) {
            return String(str || '').replace(/[&<>"']/g, s => ({
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;'
            }[s]));
        }

        function getStatusText(status) {
            const statusMap = {
                'want': 'üìã Want to Read',
                'reading': 'üìñ Reading', 
                'finished': '‚úÖ Finished'
            };
            return statusMap[status] || status;
        }

        function renderReadingList() {
            const container = document.getElementById('readingListContainer');
            if (!container) return;
            const genreFilter = document.getElementById('genreFilter')?.value || 'all';
            const sortValue = document.getElementById('sortReadingList')?.value || 'default';
            const searchQuery = document.getElementById('searchInput')?.value.trim().toLowerCase() || '';
            let filteredBooks = readingList.filter(book => {
                const matchesGenre = genreFilter === 'all' || book.genre === genreFilter;
                const matchesSearch = !searchQuery ||
                    book.title.toLowerCase().includes(searchQuery) ||
                    book.author.toLowerCase().includes(searchQuery) ||
                    (book.genre && book.genre.toLowerCase().includes(searchQuery)) ||
                    (book.review && book.review.toLowerCase().includes(searchQuery));
                return matchesGenre && matchesSearch;
            });

            filteredBooks.sort((a, b) => {
                const statusOrder = { finished: 3, reading: 2, want: 1 };
                const statusDiff = (statusOrder[b.status] || 0) - (statusOrder[a.status] || 0);
                if (statusDiff !== 0) return statusDiff;
                switch (sortValue) {
                    case 'titleAsc':
                        return a.title.localeCompare(b.title) || (a.id - b.id);
                    case 'titleDesc':
                        return b.title.localeCompare(a.title) || (a.id - b.id);
                    case 'ratingAsc':
                        const ratingA = a.rating || 0;
                        const ratingB = b.rating || 0;
                        return (ratingA - ratingB) || (a.id - b.id);
                    case 'ratingDesc':
                        const rA = a.rating || 0;
                        const rB = b.rating || 0;
                        return (rB - rA) || (a.id - b.id);
                    default: // 'default' = recently added
                        return (new Date(b.addedAt) - new Date(a.addedAt)) || (a.id - b.id);
                }
            });
            if (filteredBooks.length === 0) {
                const noResultsMessage = searchQuery
                    ? `No books found matching "${searchQuery}".`
                    : (genreFilter === 'all'
                        ? 'No books added yet. Click \'Add Book\' to get started.'
                        : `No books found in "${genreFilter}" genre.`);
                container.innerHTML = `<div class="empty-state">${noResultsMessage}</div>`;
                return;
            }
            container.innerHTML = filteredBooks.map(book => {
                const maxReviewLength = 100;
                let ratingDisplay = '';
                if (book.rating !== null && !isNaN(book.rating)) {
                    const ratingValue = book.rating;
                    const fullStars = Math.floor(ratingValue);
                    const hasHalfStar = ratingValue % 1 >= 0.5;
                    let starsHTML = '';
                    for (let i = 1; i <= 5; i++) {
                        if (i <= fullStars) {
                            starsHTML += '<span class="star filled">‚òÖ</span>';
                        } else if (i === fullStars + 1 && hasHalfStar) {
                            starsHTML += '<span class="star half">‚òÖ</span>';
                        } else {
                            starsHTML += '<span class="star">‚òÜ</span>';
                        }
                    }
                    ratingDisplay = `<div class="book-rating">${starsHTML} (${ratingValue.toFixed(1)})</div>`;
                }
                let reviewDisplay = '';
                if (book.review) {
                    let displayReview = book.review;
                    let isTruncated = false;
                    if (book.review.length > maxReviewLength) {
                        displayReview = book.review.substring(0, maxReviewLength) + '...';
                        isTruncated = true;
                    }
                    reviewDisplay = `<div class="book-review ${isTruncated ? 'truncated' : ''}" onclick="showFullReview(\`${escapeHtml(book.review)}\`, \`${escapeHtml(book.title)}\`); event.stopPropagation();">
                                        <strong>Review:</strong> ${escapeHtml(displayReview)}
                                        ${isTruncated ? '<span class="read-more"> (Click to read more)</span>' : ''}
                                    </div>`;
                }

                const bookDetailsElements = [
                    `<div class="book-title">${escapeHtml(book.title)}</div>`,
                    `<div class="book-author">by ${escapeHtml(book.author)}</div>`,
                    `<div class="book-meta-row">`,
                    ` <span class="book-genre">${escapeHtml(book.genre)}</span>`,
                    ` <span class="book-status-badge ${book.status}">${getStatusText(book.status)}</span>`,
                    `</div>`,
                    ratingDisplay,
                    reviewDisplay
                ];
                const detailsHTML = bookDetailsElements.join('');

                return `<div class="book-item" data-id="${book.id}" onclick="showBookDetails(${book.id})">
                            <img class="book-cover" src="${book.cover || 'https://via.placeholder.com/60x84?text=üìö'}" alt="${escapeHtml(book.title)} cover">
                            <div class="book-details">
                                ${detailsHTML}
                            </div>
                            <div class="book-actions">
                                <button class="book-action-btn" onclick="openEditBookModal(${book.id}); event.stopPropagation();" title="Edit Book">‚úèÔ∏è</button>
                                <button class="book-action-btn" onclick="removeBook(${book.id}); event.stopPropagation();" title="Delete Book">üóëÔ∏è</button>
                                <button class="book-action-btn" onclick="toggleBookStatus(${book.id}); event.stopPropagation();" title="Toggle Status">üîÑ</button>
                                <button class="book-action-btn" onclick="showBookDetails(${book.id}); event.stopPropagation();" title="View Details">üëÅÔ∏è</button>
                            </div>
                        </div>`;
            }).join('');
        }


        function updateReadingCounts() {
            document.getElementById('totalCount').textContent = readingList.length;
            document.getElementById('readingCount').textContent = readingList.filter(b => b.status === 'reading').length;
            document.getElementById('finishedCount').textContent = readingList.filter(b => b.status === 'finished').length;
        }

        function openAddBookModal() {
            document.getElementById('addBookModal').style.display = 'flex';
            document.getElementById('addBookForm').reset();
        }

        function closeAddBookModal() {
            document.getElementById('addBookModal').style.display = 'none';
        }


        function openEditBookModal(bookId) {
            const book = readingList.find(b => b.id === parseInt(bookId));
            if (!book) {
                console.error('Book not found for editing:', bookId);
                showNotification('Book not found!', 'error');
                return;
            }

            document.getElementById('editBookId').value = book.id;
            document.getElementById('editBookTitle').value = book.title;
            document.getElementById('editBookAuthor').value = book.author;
            document.getElementById('editBookCoverUrl').value = book.cover || '';
            document.getElementById('editBookGenre').value = book.genre || 'Other';
            document.getElementById('editBookStatus').value = book.status;
            document.getElementById('editBookRating').value = book.rating !== null ? book.rating : '';
            document.getElementById('editBookReview').value = book.review || '';

            document.getElementById('editBookModal').style.display = 'flex';
        }

        function closeEditBookModal() {
            document.getElementById('editBookModal').style.display = 'none';
        }


        function addBook(event) {
            event.preventDefault();
            console.log('addBook function called');

            const title = document.getElementById('bookTitle').value.trim();
            const author = document.getElementById('bookAuthor').value.trim();
            const cover = document.getElementById('bookCoverUrl').value.trim();
            const status = document.getElementById('bookStatus').value;
            const genre = document.getElementById('bookGenre').value.trim();
            const ratingValue = document.getElementById('bookRating').value;
            const rating = ratingValue ? parseInt(ratingValue) : null;
            const review = document.getElementById('bookReview').value.trim();

            console.log('Form values:', { title, author, genre, status, rating, review });

            if (!title || !author || !genre) {
                showNotification('Please fill in all required fields (Title, Author, Genre)!', 'error');
                return;
            }

            const book = {
                id: Date.now(),
                title,
                author,
                cover: cover || '',
                genre,
                status,
                addedAt: new Date().toISOString(),
                rating,
                review
            };

            console.log('Adding book:', book);
            readingList.push(book);
            localStorage.setItem('readingList', JSON.stringify(readingList));
            renderReadingList();
            updateReadingCounts();
            closeAddBookModal();
            showNotification('‚úÖ Book added successfully!', 'success');
        }

        function updateReadingCounts() {
            const totalCount = document.getElementById('totalCount');
            const readingCount = document.getElementById('readingCount');
            const finishedCount = document.getElementById('finishedCount');
            
            if (totalCount) totalCount.textContent = readingList.length;
            if (readingCount) readingCount.textContent = readingList.filter(b => b.status === 'reading').length;
            if (finishedCount) finishedCount.textContent = readingList.filter(b => b.status === 'finished').length;
        }
 
        function updateBook(event) {
            event.preventDefault();

            const bookId = parseInt(document.getElementById('editBookId').value);
            const title = document.getElementById('editBookTitle').value.trim();
            const author = document.getElementById('editBookAuthor').value.trim();
            const cover = document.getElementById('editBookCoverUrl').value.trim();
            const status = document.getElementById('editBookStatus').value;
            const genre = document.getElementById('editBookGenre').value.trim();
            const ratingValue = document.getElementById('editBookRating').value;
            const review = document.getElementById('editBookReview').value.trim();

            console.log('Update form values:', { bookId, title, author, cover, status, genre, ratingValue, review });

            if (!title || !author || !genre) {
                showNotification('Please fill in all required fields (Title, Author, Genre)!', 'error');
                return;
            }

            const rating = ratingValue ? parseInt(ratingValue, 10) : null;

            const bookIndex = readingList.findIndex(b => b.id === bookId);
            if (bookIndex !== -1) {
                readingList[bookIndex] = {
                    ...readingList[bookIndex],
                    title,
                    author,
                    cover: cover || '',
                    genre,
                    status,
                    rating,
                    review
                };

                localStorage.setItem('readingList', JSON.stringify(readingList));
                renderReadingList();
                closeEditBookModal();
                showNotification('‚úÖ Book updated successfully!', 'success');
                console.log('Updated book:', readingList[bookIndex]);
            } else {
                console.error('Book ID not found during update:', bookId);
                showNotification('Book not found for update!', 'error');
            }
        }

        function removeBook(id) {
            if (!confirm('Are you sure you want to delete this book?')) {
                return;
            }
            readingList = readingList.filter(b => b.id !== parseInt(id));
            localStorage.setItem('readingList', JSON.stringify(readingList));
            renderReadingList();
            updateReadingCounts();
            showNotification('‚úÖ Book removed successfully!', 'success');
        }


        function toggleBookStatus(id) {
            const book = readingList.find(x => x.id === parseInt(id));
            if (!book) return;

            if (book.status === 'want') {
                book.status = 'reading';
            } else if (book.status === 'reading') {
                book.status = 'finished';
            } else {
                book.status = 'want';
            }

            localStorage.setItem('readingList', JSON.stringify(readingList));
            renderReadingList();
            updateReadingCounts();
            showNotification(`‚úÖ Status changed to "${getStatusText(book.status)}"!`, 'success');
        }


        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing reading list...');
            if (!checkLocalStorageAvailability()) {
                showNotification('‚ùå B·ªô nh·ªõ c·ª•c b·ªô b·ªã ch·∫∑n ho·∫∑c kh√¥ng kh·∫£ d·ª•ng. Ti·∫øn tr√¨nh c√≥ th·ªÉ kh√¥ng ƒë∆∞·ª£c l∆∞u.', 'error');
            }

            renderReadingList();
            updateReadingCounts();
            const addBookForm = document.getElementById('addBookForm');
            const editBookForm = document.getElementById('editBookForm');
            const genreFilter = document.getElementById('genreFilter');
            const sortSelect = document.getElementById('sortReadingList');
            const searchInput = document.getElementById('searchInput'); 
            if (addBookForm) {
                addBookForm.addEventListener('submit', addBook);
            }
            if (editBookForm) {
                editBookForm.addEventListener('submit', updateBook);
            }
            if (genreFilter) {
                genreFilter.addEventListener('change', () => { renderReadingList(); updateReadingCounts(); });
            }
            if (sortSelect) {
                sortSelect.addEventListener('change', () => { renderReadingList(); updateReadingCounts(); });
            }
            if (searchInput) {
                const debouncedSearch = debounce(() => {
                    renderReadingList();
                    updateReadingCounts();
                }, 300); 
                searchInput.addEventListener('input', debouncedSearch);
            }


            window.addEventListener('click', function(event) {
                const modals = ['addBookModal', 'editBookModal', 'fullReviewModal', 'bookDetailsModal'];
                modals.forEach(id => {
                    const modal = document.getElementById(id);
                    if (event.target === modal) {
                        if (id === 'addBookModal') closeAddBookModal();
                        else if (id === 'editBookModal') closeEditBookModal();
                        else if (id === 'fullReviewModal') closeFullReviewModal();
                        else if (id === 'bookDetailsModal') closeBookDetailsModal();
                    }
                });
            });
            if (readingList.length === 0) {
                console.log('Adding demo books...');
                const demoBooks = [
                    {
                        id: Date.now() + 1,
                        title: "Money: A Story of Humanity",
                        author: "David McWilliams",
                        cover: "",
                        status: "reading",
                        genre: "Finance",
                        rating: 4,
                        review: "Interesting perspective on money throughout history.",
                        addedAt: new Date().toISOString()
                    },
                    {
                        id: Date.now() + 2,
                        title: "The Psychology of Money",
                        author: "Morgan Housel",
                        cover: "",
                        status: "finished",
                        genre: "Finance",
                        rating: 5,
                        review: "Excellent insights into behavioral finance.",
                        addedAt: new Date(Date.now() - 86400000).toISOString()
                    },
                    {
                        id: Date.now() + 3,
                        title: "Atomic Habits",
                        author: "James Clear",
                        cover: "",
                        status: "want",
                        genre: "Self-Help",
                        rating: 4,
                        review: "",
                        addedAt: new Date(Date.now() - 172800000).toISOString()
                    }
                ];                
                readingList = demoBooks;
                localStorage.setItem('readingList', JSON.stringify(readingList));
                renderReadingList();
                updateReadingCounts();
            }
        }); 

        document.addEventListener('DOMContentLoaded', function() {
            // ‚úÖ ADD: Setup goal type selection buttons
            document.querySelectorAll('.goal-type-option').forEach(option => {
                option.addEventListener('click', function() {
                    const type = this.dataset.type;
                    selectGoalType(type);
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            const customGoalForm = document.getElementById('updateCustomGoalForm');
            if (customGoalForm) {
                customGoalForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const id = document.getElementById('updateGoalId').value;
                    const newValue = parseFloat(document.getElementById('updateGoalValue').value);
                    
                    if (isNaN(newValue) || newValue < 0) {
                        showNotification('Please enter a valid progress value.', 'error');
                        return;
                    }
                    
                    const goal = goals.find(g => g.id === id);
                    if (goal && goal.type === 'custom') {
                        goal.currentProgress = newValue;
                        saveGoals();
                        renderGoals();
                        updateGoalProgressChart();
                        closeUpdateCustomGoalModal();
                        
                        // Check if completed
                        if (goal.currentProgress >= goal.target) {
                            gamification.points += 50;
                            gamification.level = Math.floor(gamification.points / 100) + 1;
                            localStorage.setItem('gamification', JSON.stringify(gamification));
                            updateGamificationStats();
                            showNotification(`üéâ Goal "${goal.title}" completed! Earned 50 XP!`, 'achievement');
                        } else {
                            showNotification('‚úÖ Progress updated successfully!', 'success');
                        }
                    }
                });
            }
        });

        function showNotification(message, type) {
            alert(`${type.toUpperCase()}: ${message}`);
            // B·∫°n c√≥ th·ªÉ thay b·∫±ng toast notification ƒë·∫πp h∆°n
        }


        // Focus timer
        let timerDuration = parseInt(localStorage.getItem('focusTimerDuration')) || 25 * 60; 
        let remainingSeconds = parseInt(localStorage.getItem('focusRemaining')) || timerDuration;
        let timerInterval = null;
        let timerRunning = localStorage.getItem('focusRunning') === 'true';
        let focusStartTimestamp = parseInt(localStorage.getItem('focusStartTimestamp')) || null;
        let remainingAtStart = parseInt(localStorage.getItem('focusRemainingAtStart')) || null;

        function formatTime(sec) {
            const m = Math.floor(sec / 60).toString().padStart(2, '0');
            const s = (sec % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }

        function updateTimerDisplay() {
            const disp = document.getElementById('timerDisplay');
            if (disp) disp.textContent = formatTime(Math.max(0, remainingSeconds));
        }

        function persistTimerState() {
            localStorage.setItem('focusRemaining', remainingSeconds);
            localStorage.setItem('focusRunning', timerRunning);
            localStorage.setItem('focusTimerDuration', timerDuration);
            if (focusStartTimestamp) {
                localStorage.setItem('focusStartTimestamp', focusStartTimestamp);
            } else {
                localStorage.removeItem('focusStartTimestamp');
            }
            if (typeof remainingAtStart === 'number') {
                localStorage.setItem('focusRemainingAtStart', remainingAtStart);
            } else {
                localStorage.removeItem('focusRemainingAtStart');
            }
        }

        function onTimerComplete() {
            clearInterval(timerInterval);
            timerInterval = null;
            timerRunning = false;
            focusStartTimestamp = null;
            remainingAtStart = null;
            remainingSeconds = timerDuration;
            persistTimerState();
            updateTimerDisplay();
            const notificationTitle = "‚è∞ Focus Session Complete!";
            const notificationBody = "Great job! You've completed your 25-minute focus block.";
            showNotification(notificationTitle, 'success');
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification(notificationTitle, {
                    body: notificationBody,
                    icon: "https://cdn-icons-png.flaticon.com/512/1828/1828976.png", 
                    requireInteraction: true 
                });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        new Notification(notificationTitle, {
                            body: notificationBody,
                            icon: "https://cdn-icons-png.flaticon.com/512/1828/1828976.png"
                        });
                    }
                });
            }
            const xpReward = 25;
            gamification.points += xpReward;
            gamification.level = Math.floor(gamification.points / 100) + 1;
            localStorage.setItem('gamification', JSON.stringify(gamification));
            updateGamificationStats();
        }

        function tick() {
            if (timerRunning && focusStartTimestamp && typeof remainingAtStart === 'number') {
                const elapsed = Math.floor((Date.now() - focusStartTimestamp) / 1000);
                remainingSeconds = remainingAtStart - elapsed;
                if (remainingSeconds <= 0) {
                    onTimerComplete();
                    return;
                }
            } else {
                remainingSeconds = Math.max(0, remainingSeconds - 1);
                if (remainingSeconds <= 0) {
                    onTimerComplete();
                    return;
                }
            }
            updateTimerDisplay();
            // persist occasionally
            if (Date.now() % 5000 < 1000) persistTimerState();
        }

        function startTimer() {
            if (timerRunning) return;
            timerRunning = true;
            focusStartTimestamp = Date.now();
            remainingAtStart = remainingSeconds;
            persistTimerState();

            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(tick, 1000);
            updateTimerDisplay();
        }

        function pauseTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            if (timerRunning && focusStartTimestamp && typeof remainingAtStart === 'number') {
                const elapsed = Math.floor((Date.now() - focusStartTimestamp) / 1000);
                remainingSeconds = Math.max(0, remainingAtStart - elapsed);
            }
            timerRunning = false;
            focusStartTimestamp = null;
            remainingAtStart = null;
            persistTimerState();
            updateTimerDisplay();
        }

        function resetTimer() {
            pauseTimer();
            remainingSeconds = timerDuration;
            persistTimerState();
            updateTimerDisplay();
            showNotification('üîÑ Timer reset', 'info');
        }

        // change duration by double-click
        const timerDisplayEl = document.getElementById('timerDisplay');
        if (timerDisplayEl) {
            timerDisplayEl.addEventListener('dblclick', () => {
                const mins = prompt('Set focus length in minutes (e.g. 25):', (timerDuration/60).toString());
                const m = parseInt(mins);
                if (!isNaN(m) && m > 0) {
                    timerDuration = m * 60;
                    remainingSeconds = timerDuration;
                    focusStartTimestamp = null;
                    remainingAtStart = null;
                    persistTimerState();
                    updateTimerDisplay();
                    showNotification(`Timer set to ${m} minutes`, 'success');
                }
            });
        }

        // restore timer on load: compute elapsed time if it was running
        (function restoreTimerOnLoad() {
            if (localStorage.getItem('focusTimerDuration')) {
                timerDuration = parseInt(localStorage.getItem('focusTimerDuration'));
            }
            const storedRunning = localStorage.getItem('focusRunning') === 'true';
            const storedStart = parseInt(localStorage.getItem('focusStartTimestamp'));
            const storedRemainingAtStart = parseInt(localStorage.getItem('focusRemainingAtStart'));

            if (storedRunning && storedStart && !isNaN(storedRemainingAtStart)) {
                const elapsed = Math.floor((Date.now() - storedStart) / 1000);
                const newRemaining = storedRemainingAtStart - elapsed;
                if (newRemaining <= 0) {
                    timerRunning = false;
                    remainingSeconds = timerDuration;
                    focusStartTimestamp = null;
                    remainingAtStart = null;
                    persistTimerState();
                } else {
                    timerRunning = true;
                    focusStartTimestamp = storedStart;
                    remainingAtStart = storedRemainingAtStart;
                    remainingSeconds = newRemaining;
                    if (timerInterval) clearInterval(timerInterval);
                    timerInterval = setInterval(tick, 1000);
                }
            } else {
                remainingSeconds = parseInt(localStorage.getItem('focusRemaining')) || timerDuration;
                timerRunning = false;
                focusStartTimestamp = null;
                remainingAtStart = null;
                persistTimerState();
            }
            updateTimerDisplay();
        })();

        // --- DAILY STUDY TRACKING ---
        let dailyStudyData = JSON.parse(localStorage.getItem('dailyStudyData')) || {};
        let dailyStudyChart = null;

        // H√†m c·∫≠p nh·∫≠t d·ªØ li·ªáu h·ªçc t·∫≠p h√†ng ng√†y
        function updateDailyStudyData(hours) {
            const today = new Date().toDateString();
            if (!dailyStudyData[today]) {
                dailyStudyData[today] = 0;
            }
            dailyStudyData[today] += hours;
            localStorage.setItem('dailyStudyData', JSON.stringify(dailyStudyData));
        }

        // H√†m l·∫•y d·ªØ li·ªáu 7 ng√†y g·∫ßn nh·∫•t
        function getWeeklyStudyData() {
            const weeklyData = [];
            const labels = [];
            
            // L·∫•y 7 ng√†y g·∫ßn nh·∫•t (bao g·ªìm h√¥m nay)
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateString = date.toDateString();
                
                // N·∫øu c√≥ d·ªØ li·ªáu cho ng√†y n√†y, d√πng n√≥, n·∫øu kh√¥ng th√¨ 0
                const hours = dailyStudyData[dateString] || 0;
                weeklyData.push(hours);
                
                // ƒê·ªãnh d·∫°ng nh√£n ng√†y (VD: Mon 10/1)
                const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                const monthDay = date.toLocaleDateString('en-US', { month: 'numeric', day: 'numeric' });
                labels.push(`${dayName} ${monthDay}`);
            }
            
            return { labels, data: weeklyData };
        }

        // H√†m c·∫≠p nh·∫≠t giao di·ªán (Text + Chart)
        function updateDailyStudyDisplay() {
            // C·∫≠p nh·∫≠t text
            const today = new Date().toDateString();
            const todayHours = (dailyStudyData[today] || 0).toFixed(1);
            document.getElementById('dailyStudyInfo').textContent = `Today: ${todayHours} hours`;
            
            // C·∫≠p nh·∫≠t t·ªïng (ƒë√£ c√≥ s·∫µn t·ª´ updateStats(), nh∆∞ng ta s·∫Ω c·∫≠p nh·∫≠t l·∫°i ƒë·ªÉ ƒë·∫£m b·∫£o ƒë·ªìng b·ªô)
            let overallTotalHours = 0;
            Object.keys(studyHours).forEach(career => {
                overallTotalHours += Object.values(studyHours[career]).reduce((sum, hours) => sum + hours, 0);
            });
            document.getElementById('totalStudyInfo').textContent = `Total: ${overallTotalHours.toFixed(1)} hours`;
            
            // V·∫Ω ho·∫∑c c·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì
            renderDailyStudyChart();
        }

        // H√†m v·∫Ω bi·ªÉu ƒë·ªì c·ªôt 7 ng√†y
        function renderDailyStudyChart() {
            const ctx = document.getElementById('dailyStudyChart').getContext('2d');
            const { labels, data } = getWeeklyStudyData();
            if (dailyStudyChart) {
                dailyStudyChart.destroy();
                dailyStudyChart = null;
            }
            
            dailyStudyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Hours Studied',
                        data: data,
                        backgroundColor: function(context) {
                            const value = context.raw;
                            if (value === Math.max(...data)) {
                                return '#3b82f6'; // Xanh d∆∞∆°ng ƒë·∫≠m cho ng√†y cao nh·∫•t
                            }
                            return '#60a5fa'; // Xanh nh·∫°t cho c√°c ng√†y c√≤n l·∫°i
                        },
                        borderColor: '#3b82f6',
                        borderWidth: 1,
                        borderRadius: 4,
                        barPercentage: 0.8,
                        categoryPercentage: 0.8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.y} hours`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Last 7 Days',
                            font: {
                                size: 14,
                                weight: 'bold'
                            },
                            color: 'var(--text-dark)',
                            padding: 8
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'var(--text-muted)',
                                stepSize: 1
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'var(--text-muted)',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }


        // --- Course Manager Logic ---
        let courses = JSON.parse(localStorage.getItem('courses')) || [];
    courses = courses.map(course => ({
        ...course,
        url: course.url || "" // ƒê·∫£m b·∫£o t·∫•t c·∫£ course ƒë·ªÅu c√≥ property url, m·∫∑c ƒë·ªãnh l√† ""
    }));        


        const careerTitles = {
            pe: "üíº Private Equity",
            ib: "üè¶ Investment Banking",
            hf: "üìà Hedge Funds",
            sc: "üéØ Strategy Consulting",
            fintech: "üí≥ Fintech",
            english: "üö© English",
            chinese: "üíû Chinese",
            tools: "üõ†Ô∏è Finance Tools",
            cfa1: "üìú CFA Level 1",
            general: "üìä General Finance"
        };

        const priorityIcons = {
            High: "üî∫",
            Medium: "üî∏",
            Low: "üîª"
        };
        const difficultyIcons = {
            Beginner: "üü¢",
            Intermediate: "üü°",
            Advanced: "üî¥"
        };

        // --- Helper Functions ---
        function getPriorityIcon(importance) {
            if (importance >= 4) return priorityIcons.High;     // High (4-5)
            if (importance === 3) return priorityIcons.Medium;  // Medium (3)
            return priorityIcons.Low;                           // Low (1-2)
        }

        function saveCourses() {
            localStorage.setItem('courses', JSON.stringify(courses));
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function getStatusClass(progressPercent) {
            if (progressPercent >= 100) return 'completed';
            // C√≥ th·ªÉ th√™m logic cho 'active', 'paused' n·∫øu c·∫ßn
            return 'active'; // M·∫∑c ƒë·ªãnh
        }

        function getDeadlineClass(deadlineString) {
            if (!deadlineString) return '';
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const deadline = new Date(deadlineString);
            deadline.setHours(0, 0, 0, 0);

            const diffTime = deadline - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 0) return 'overdue';
            if (diffDays <= 3) return 'soon'; 
            return '';
        }

        // --- Render Functions ---
        function renderCourses() {
            const container = document.getElementById('coursesContainer');
            const careerTitleEl = document.getElementById('courseCareerTitle');
            if (!container || !careerTitleEl) return;

            careerTitleEl.textContent = skillsData[currentCareer].title;

            const filteredCourses = courses.filter(course => course.career === currentCareer);

            if (filteredCourses.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 20px;">No courses added yet for this career. Click \'Add Course\' to get started.</p>';
                return;
            }

            container.innerHTML = filteredCourses.map(course => {
                const progressPercent = Math.min(100, (course.hoursStudied / course.estimatedHours) * 100);
                const statusClass = getStatusClass(progressPercent);
                const deadlineClass = getDeadlineClass(course.deadline);
                const deadlineText = course.deadline ? `üìÖ ${formatDate(course.deadline)}` : 'üìÖ N/A';
            return `<div class="course-item" data-career="${course.career}" data-id="${course.id}">
                <div class="course-header">
                    <div class="course-title">${escapeHtml(course.title)}</div>
                    <span class="favorite-icon" onclick="toggleFavorite('${course.id}')" title="${course.favorite ? 'Remove from favorites' : 'Add to favorites'}">${course.favorite ? '‚≠ê' : '‚òÜ'}</span>
                    <span class="course-status-badge ${statusClass}">${progressPercent >= 100 ? 'Completed' : 'Active'}</span>
                </div>
                <div class="course-meta">
                    <div class="course-difficulty">${difficultyIcons[course.difficulty]|| ''} ${course.difficulty}</div>
                    <div class="course-priority">${priorityIcons[course.priority]|| ''} ${course.priority}</div>
                    <div class="course-deadline ${deadlineClass}">${deadlineText}</div>
                </div>
                <div class="course-progress-container">
                    <div class="course-progress-fill" style="width: ${progressPercent}%"></div>
                </div>
                <div class="course-progress-text">${course.hoursStudied.toFixed(1)} / ${course.estimatedHours.toFixed(1)} hours</div>
                ${course.description ? `<div class="course-description">${escapeHtml(course.description)}</div>` : ''}
                <div class="course-actions">
                    ${course.url && course.url.trim() !== '' ? `<button class="course-action-btn open-link" onclick="window.open('${course.url}', '_blank')">üîó Open</button>` : ''}                
                    <button class="course-action-btn add-hours" onclick="openAddHoursModal('${course.id}')">‚è±Ô∏è Add Hours</button>
                    <button class="course-action-btn edit" onclick="openEditCourseModal('${course.id}')">‚úèÔ∏è Edit</button>
                    <button class="course-action-btn delete" onclick="deleteCourse('${course.id}')">üóëÔ∏è Delete</button>
                </div>
            </div>`;
            }).join('');
        }

        // --- Modal Functions ---
        function openAddCourseModal() {
            document.getElementById('courseModalTitle').textContent = '‚ûï Add New Course';
            document.getElementById('courseForm').reset();
            document.getElementById('editCourseId').value = '';
            document.getElementById('courseCareer').value = currentCareer; 
            document.getElementById('courseModal').style.display = 'flex';
        }

        function openEditCourseModal(courseId) {
             const course = courses.find(c => c.id === courseId);
             if (!course) return;
             document.getElementById('courseModalTitle').textContent = '‚úèÔ∏è Edit Course';
             document.getElementById('editCourseId').value = course.id;
             document.getElementById('courseTitle').value = course.title;
             document.getElementById('courseCareer').value = course.career;
             document.getElementById('courseDifficulty').value = course.difficulty;
             document.getElementById('coursePriority').value = course.priority;
             document.getElementById('courseUrl').value = course.url || '';
             document.getElementById('courseEstHours').value = course.estimatedHours;
             document.getElementById('courseDeadline').value = course.deadline || '';
             document.getElementById('courseDescription').value = course.description || '';
             document.getElementById('courseModal').style.display = 'flex';
        }

        function closeCourseModal() {
            document.getElementById('courseModal').style.display = 'none';
        }

        function openAddHoursModal(courseId) {
             const course = courses.find(c => c.id === courseId);
             if (!course) return;
             document.getElementById('addHoursCourseId').value = courseId;
             document.getElementById('hoursToAdd').value = ''; // Reset input
             document.getElementById('addHoursModal').style.display = 'flex';
        }

        function closeAddHoursModal() {
            document.getElementById('addHoursModal').style.display = 'none';
        }

         // --- Course Actions ---
        function saveCourse(event) {
            event.preventDefault();
            const id = document.getElementById('editCourseId').value;
            const title = document.getElementById('courseTitle').value.trim();
            const career = document.getElementById('courseCareer').value;
            const difficulty = document.getElementById('courseDifficulty').value;
            const priority = document.getElementById('coursePriority').value;
            const url = document.getElementById('courseUrl').value.trim();
            const estimatedHours = parseFloat(document.getElementById('courseEstHours').value) || 0;
            const deadline = document.getElementById('courseDeadline').value; // C√≥ th·ªÉ l√† chu·ªói r·ªóng
            const description = document.getElementById('courseDescription').value.trim();

            if (!title) {
                showNotification('Please enter a course title.', 'error');
                return;
            }

            if (id) {
                // Edit existing course
                const courseIndex = courses.findIndex(c => c.id === id);
                if (courseIndex !== -1) {
                    courses[courseIndex] = {
                        ...courses[courseIndex],
                        title,
                        career,
                        difficulty,
                        priority,
                        url: url || undefined,
                        estimatedHours,
                        deadline: deadline || undefined,
                        description: description || undefined,
                        favorite: courses[courseIndex].favorite || false 
                    };
                    showNotification('Course updated successfully!', 'success');
                }
            } else {
                // Add new course
                const newCourse = {
                    id: Date.now().toString(),
                    title,
                    career,
                    difficulty,
                    priority,
                    url: url || undefined,
                    estimatedHours,
                    deadline: deadline || undefined,
                    description: description || undefined,
                    hoursStudied: 0,
                    createdAt: new Date().toISOString(),
                    favorite: false 
                };                
                courses.push(newCourse);
                showNotification('Course added successfully!', 'success');
            }
            triggerBackup();
            saveCourses();
            renderCourses(); 
            closeCourseModal();
        }

        function deleteCourse(courseId) {
            if (confirm('Are you sure you want to delete this course?')) {
                courses = courses.filter(c => c.id !== courseId);
                saveCourses();
                renderCourses();
                showNotification('Course deleted.', 'info');
            }
        }

        // --- FAVORITE COURSE FUNCTION ---
        function toggleFavorite(courseId) {
            const course = courses.find(c => c.id === courseId);
            if (!course) return;
            course.favorite = !course.favorite;
            saveCourses();
            renderCourses();
            showNotification(
                course.favorite 
                    ? '‚≠ê Added to Favorites!' 
                    : '‚òÜ Removed from Favorites',
                'success'
            );
        }


        function addHoursToCourse(event) {
            event.preventDefault();
            const courseId = document.getElementById('addHoursCourseId').value;
            const hoursStr = document.getElementById('hoursToAdd').value.trim();
            const hours = parseFloat(hoursStr);

            if (!hours || hours <= 0) {
                showNotification('Please enter a valid number of hours.', 'error');
                return;
            }

            const course = courses.find(c => c.id === courseId);
            if (course) {
                course.hoursStudied = (course.hoursStudied || 0) + hours;
                saveCourses();

                goals.forEach(goal => {
                    if (goal.career === currentCareer) { 
                        if (goal.type === 'study_hours') {
                            if (goal.courseId === courseId) {
                                goal.currentProgress = course.hoursStudied;
                            } else if (!goal.courseId) {
                                const careerHours = studyHours[currentCareer] || {};
                                const totalHours = Object.values(careerHours).reduce((sum, h) => sum + h, 0);
                                goal.currentProgress = totalHours;
                            }
                        }
                    }
                });
                
                saveGoals();
                renderCourses();
                renderGoals();
                updateGoalProgressChart(); 
                closeAddHoursModal();

                const pointsEarned = Math.floor(hours * 10);
                gamification.points += pointsEarned;
                gamification.level = Math.floor(gamification.points / 100) + 1;
                localStorage.setItem('gamification', JSON.stringify(gamification));
                updateGamificationStats();
                updateStats();
                updateChart();
                updateDailyStreak();
                showNotification(`Added ${hours} hours to "${course.title}"! Earned ${pointsEarned} XP`, 'success');
                getRandomQuote();
                updateDailyStudyData(hours);
            }
        }



        
        // --- GOAL MANAGEMENT ---
        let goals = JSON.parse(localStorage.getItem('goals')) || [];
        let archivedGoals = JSON.parse(localStorage.getItem('archivedGoals')) || [];

        // ===== ARCHIVE FUNCTION =====
        function archiveGoal(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const status = getGoalStatus(goal);
            
            if (status !== 'completed') {
                showNotification('‚ö†Ô∏è Only completed goals can be archived!', 'error');
                return;
            }
            
            if (confirm(`üì¶ Archive "${goal.title}"? You can view it later in History.`)) {
                // Remove from active goals
                goals = goals.filter(g => g.id !== goalId);
                
                // Add to archived with timestamp
                archivedGoals.push({
                    ...goal,
                    archivedAt: new Date().toISOString()
                });
                
                // Save both
                localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
                saveGoals();
                
                // Update UI
                renderGoals();
                updateGoalProgressChart();
                
                showNotification('‚úÖ Goal archived successfully!', 'success');
            }
        }

        // ===== RESTORE FUNCTION =====
        function restoreArchivedGoal(goalId) {
            const goal = archivedGoals.find(g => g.id === goalId);
            if (!goal) return;
            
            if (confirm(`‚Ü©Ô∏è Restore "${goal.title}" back to active goals?`)) {
                // Remove from archived
                archivedGoals = archivedGoals.filter(g => g.id !== goalId);
                
                // Add back to active goals (remove archivedAt timestamp)
                const restoredGoal = { ...goal };
                delete restoredGoal.archivedAt;
                goals.push(restoredGoal);
                
                localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
                saveGoals();
                renderGoals();
                renderArchivedGoals();
                
                showNotification(`‚úÖ Goal "${goal.title}" restored!`, 'success');
            }
        }

        // ===== PERMANENT DELETE FROM ARCHIVE =====
        function permanentlyDeleteArchivedGoal(goalId) {
            const goal = archivedGoals.find(g => g.id === goalId);
            if (!goal) return;
            
            if (confirm(`üóëÔ∏è PERMANENTLY delete "${goal.title}"? This cannot be undone!`)) {
                archivedGoals = archivedGoals.filter(g => g.id !== goalId);
                localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
                renderArchivedGoals();
                
                // Update button count if modal is open
                const archiveBtn = document.querySelector('.goal-archive-btn');
                if (archiveBtn) {
                    archiveBtn.innerHTML = `üì¶ View Archived Goals (${archivedGoals.length})`;
                }
                
                showNotification('Goal permanently deleted', 'info');
            }
        }



        function saveGoals() {
            localStorage.setItem('goals', JSON.stringify(goals));
        }

        function getGoalStatus(goal) {
            const now = new Date();
            if (goal.deadline) {
                const deadline = new Date(goal.deadline);
                if (deadline < now) return 'overdue';
                const diffTime = deadline - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays <= 3) return 'soon';
            }
            if (goal.currentProgress >= goal.target) return 'completed';
            return 'active';
        }

        function getGoalProgressPercent(goal) {
            const progress = calculateGoalProgress(goal);
            return goal.target > 0 ? Math.min(100, (progress / goal.target) * 100) : 0;
        }


        function openAddGoalModal() {
            document.getElementById('goalModalTitle').textContent = '‚ûï Add New Goal';
            document.getElementById('goalForm').reset();
            document.getElementById('editGoalId').value = '';
            document.getElementById('goalTypeSpecificFields').innerHTML = '';
            document.getElementById('goalModal').style.display = 'flex';
        }

        function openEditGoalModal(id) {
            const goal = goals.find(g => g.id === id);
            if (!goal) return;
            document.getElementById('goalModalTitle').textContent = '‚úèÔ∏è Edit Goal';
            document.getElementById('editGoalId').value = goal.id;
            document.getElementById('goalTitle').value = goal.title;
            document.getElementById('goalType').value = goal.type;
            populateGoalTypeSpecificFields(goal.type, goal);
            document.getElementById('goalTarget').value = goal.target;
            document.getElementById('goalDeadline').value = goal.deadline || '';
            document.getElementById('goalModal').style.display = 'flex';
        }

        function closeGoalModal() {
            document.getElementById('goalModal').style.display = 'none';
        }

        function openUpdateCustomGoalModal(id) {
            const goal = goals.find(g => g.id === id);
            if (!goal || goal.type !== 'custom') return;
            document.getElementById('updateGoalId').value = goal.id;
            document.getElementById('updateGoalValue').value = goal.currentProgress || 0;
            document.getElementById('updateCustomGoalModal').style.display = 'flex';
        }

        function closeUpdateCustomGoalModal() {
            document.getElementById('updateCustomGoalModal').style.display = 'none';
        }

        // ===== FIX: Handle Custom Goal Progress Update =====
        document.addEventListener('DOMContentLoaded', function() {
            const customGoalForm = document.getElementById('updateCustomGoalForm');
            if (customGoalForm) {
                customGoalForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const id = document.getElementById('updateGoalId').value;
                    const newValue = parseFloat(document.getElementById('updateGoalValue').value);
                    
                    if (isNaN(newValue) || newValue < 0) {
                        showNotification('Please enter a valid progress value.', 'error');
                        return false;
                    }
                    
                    const goal = goals.find(g => g.id === id);
                    if (goal && goal.type === 'custom') {
                        goal.currentProgress = newValue;
                        saveGoals();
                        renderGoals();
                        updateGoalProgressChart();
                        closeUpdateCustomGoalModal();
                        
                        // Check if completed
                        if (goal.currentProgress >= goal.target) {
                            gamification.points += 50;
                            gamification.level = Math.floor(gamification.points / 100) + 1;
                            localStorage.setItem('gamification', JSON.stringify(gamification));
                            updateGamificationStats();
                            showNotification(`üéâ Goal "${goal.title}" completed! Earned 50 XP!`, 'achievement');
                        } else {
                            showNotification('‚úÖ Progress updated successfully!', 'success');
                        }
                    }
                    return false;
                });
            }
        });


        function deleteGoal(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const status = getGoalStatus(goal);
            
            if (status === 'completed') {
                // ‚úÖ Completed goals ‚Üí Archive them
                if (confirm('üì¶ Archive this completed goal? (You can view it in History later)')) {
                    goals = goals.filter(g => g.id !== goalId);

                    archivedGoals.push({
                        ...goal,
                        archivedAt: new Date().toISOString()
                    });
                    
                    localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
                    saveGoals();
                    renderGoals();
                    updateGoalProgressChart();
                    
                    // ‚úÖ Update archive button count
                    const archiveBtn = document.querySelector('.goal-archive-btn');
                    if (archiveBtn) {
                        archiveBtn.innerHTML = `üì¶ View Archived Goals (${archivedGoals.length})`;
                    }
                    
                    showNotification('‚úÖ Goal archived successfully!', 'success');
                }
            } else {
                // ‚úÖ Active/Overdue goals ‚Üí Normal delete
                if (confirm('üóëÔ∏è Permanently delete this goal? This cannot be undone.')) {
                    goals = goals.filter(g => g.id !== goalId);
                    saveGoals();
                    renderGoals();
                    updateGoalProgressChart();
                    showNotification('Goal deleted', 'info');
                }
            }
        }




        function openUpdateCustomGoalModal(id) {
            const goal = goals.find(g => g.id === id);
            if (!goal || goal.type !== 'custom') return;
            
            document.getElementById('updateGoalId').value = goal.id;
            document.getElementById('updateGoalValue').value = goal.currentProgress || 0;
            document.getElementById('updateCustomGoalModal').style.display = 'flex';
        }

        function closeUpdateCustomGoalModal() {
            document.getElementById('updateCustomGoalModal').style.display = 'none';
        }




        function quickAddStudyTime(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) {
                showNotification('Goal not found!', 'error');
                return;
            }
            const hours = parseFloat(prompt('How many hours did you study?', '1.0'));
            if (!hours || hours <= 0) {
                showNotification('Please enter a valid number of hours.', 'error');
                return;
            }
            if (goal.type === 'study_hours' || goal.type === 'skill_mastery') {
                goal.currentProgress = (goal.currentProgress || 0) + hours;
                const pointsEarned = Math.floor(hours * 10);
                gamification.points += pointsEarned;
                gamification.level = Math.floor(gamification.points / 100) + 1;
                saveGoals();
                updateGamificationStats();
                renderGoals();
                showNotification(`Added ${hours} hours to "${goal.title}"! Earned ${pointsEarned} XP`, 'success');
            }
        }   

        function updateGoals() {
            renderGoals();
        }



        document.getElementById('archivedGoalsModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeArchivedGoalsModal();
            }
        });




        function showNotification(message, type = 'success') {
            const existing = document.querySelector('.notification');
            if (existing) {
                existing.remove();
            }
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                transform: translateX(400px);
                transition: transform 0.3s ease;
            `;
            switch(type) {
                case 'success':
                    notification.style.background = '#27ae60';
                    break;
                case 'error':
                    notification.style.background = '#e74c3c';
                    break;
                case 'achievement':
                    notification.style.background = '#f39c12';
                    break;
                case 'info':
                default:
                    notification.style.background = '#3498db';
                    break;
            }
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }


        function populateGoalTypeSpecificFields(type, goalData = {}) {
            const container = document.getElementById('goalTypeSpecificFields');
            container.innerHTML = '';
            
            // üìö STUDY HOURS GOAL
            if (type === 'study_hours') {
                container.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(96, 165, 250, 0.05)); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #3b82f6;">
                        <div style="display: flex; align-items: start; gap: 15px;">
                            <div style="font-size: 2.5rem;">üìö</div>
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 8px 0; color: var(--text-dark); font-size: 1.1rem;">Study Hours Goal</h4>
                                <p style="margin: 0 0 12px 0; color: var(--text-muted); font-size: 0.9rem; line-height: 1.5;">
                                    Tracks total study hours in <strong>${skillsData[currentCareer]?.title || currentCareer}</strong>.<br>
                                    ‚úÖ <strong>Auto-updates</strong> when you add study time to any skill in this career.
                                </p>
                                
                                <!-- Smart Suggestions -->
                                <div style="background: rgba(59, 130, 246, 0.08); padding: 12px; border-radius: 8px; margin-top: 12px;">
                                    <div style="font-weight: 600; margin-bottom: 8px; color: var(--text-dark); font-size: 0.9rem;">
                                        üí° Suggested Targets:
                                    </div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        ${getStudyHoursSuggestions().map(suggestion => `
                                            <button type="button" class="suggestion-btn" onclick="applySuggestion(${suggestion.hours}, '${suggestion.label}')"
                                                style="padding: 6px 12px; background: white; border: 1px solid #3b82f6; border-radius: 20px; cursor: pointer; font-size: 0.85rem; color: #3b82f6; transition: all 0.2s;">
                                                ${suggestion.label} (${suggestion.hours}h)
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
            // üéØ SKILL MASTERY GOAL
            } else if (type === 'skill_mastery') {
                const careerData = skillsData[currentCareer];
                if (!careerData) {
                    container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 20px;">No skills available for this career.</p>';
                    return;
                }
                
                // Build skill options grouped by category
                let skillOptions = '<option value="">-- Select a Skill to Master --</option>';
                Object.entries(careerData.categories).forEach(([catName, catData]) => {
                    skillOptions += `<optgroup label="${catName}">`;
                    catData.skills.forEach(skill => {
                        const completion = getSkillCompletion(currentCareer, skill.name);
                        const statusEmoji = completion.completed ? '‚úÖ' : 'üìñ';
                        const progressText = `${completion.progress.toFixed(1)}/${completion.target}h`;
                        skillOptions += `<option value="${skill.name}" ${goalData.skillName === skill.name ? 'selected' : ''}>
                            ${statusEmoji} ${skill.name} (${progressText})
                        </option>`;
                    });
                    skillOptions += `</optgroup>`;
                });
                
                container.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(5, 150, 105, 0.05)); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #10b981;">
                        <div style="display: flex; align-items: start; gap: 15px;">
                            <div style="font-size: 2.5rem;">üéØ</div>
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 8px 0; color: var(--text-dark); font-size: 1.1rem;">Skill Mastery Goal</h4>
                                <p style="margin: 0 0 15px 0; color: var(--text-muted); font-size: 0.9rem; line-height: 1.5;">
                                    Master a specific skill. Progress <strong>auto-updates</strong> when you study that skill.<br>
                                    ‚úÖ Target hours are set automatically from skill requirements.
                                </p>
                                
                                <label for="goalSkillSelect" style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-dark);">
                                    Choose Skill to Master:
                                </label>
                                <select id="goalSkillSelect" required 
                                    style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-white); color: var(--text-dark); font-size: 0.95rem; cursor: pointer;">
                                    ${skillOptions}
                                </select>
                                
                                <div id="skillPreview" style="margin-top: 12px; padding: 10px; background: rgba(16, 185, 129, 0.08); border-radius: 8px; display: none;">
                                    <div style="font-size: 0.85rem; color: var(--text-muted);">
                                        <strong>Current Progress:</strong> <span id="skillCurrentHours">0</span>h / <span id="skillTargetHours">0</span>h
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Auto-update target when skill selected
                const skillSelect = document.getElementById('goalSkillSelect');
                const targetInput = document.getElementById('goalTarget');
                const titleInput = document.getElementById('goalTitle');
                const skillPreview = document.getElementById('skillPreview');
                
                if (skillSelect && targetInput) {
                    skillSelect.addEventListener('change', function() {
                        const selectedSkill = this.value;
                        if (selectedSkill) {
                            const completion = getSkillCompletion(currentCareer, selectedSkill);
                            
                            // Auto-fill target
                            targetInput.value = completion.target;
                            targetInput.readOnly = true;
                            targetInput.style.background = '#f8fafc';
                            targetInput.style.border = '2px solid #10b981';
                            
                            // Auto-suggest title if empty
                            if (!titleInput.value.trim()) {
                                titleInput.value = `Master ${selectedSkill}`;
                            }
                            
                            // Show preview
                            if (skillPreview) {
                                document.getElementById('skillCurrentHours').textContent = completion.progress.toFixed(1);
                                document.getElementById('skillTargetHours').textContent = completion.target;
                                skillPreview.style.display = 'block';
                            }
                        } else {
                            targetInput.readOnly = false;
                            targetInput.style.background = 'var(--bg-white)';
                            targetInput.style.border = '1px solid var(--border-color)';
                            if (skillPreview) skillPreview.style.display = 'none';
                        }
                    });
                    
                    // Trigger change if editing existing goal
                    if (goalData.skillName) {
                        skillSelect.dispatchEvent(new Event('change'));
                    }
                }
                
            // ‚úÖ CUSTOM GOAL
            } else if (type === 'custom') {
                container.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.05), rgba(245, 158, 11, 0.05)); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #fbbf24;">
                        <div style="display: flex; align-items: start; gap: 15px;">
                            <div style="font-size: 2.5rem;">‚úÖ</div>
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 8px 0; color: var(--text-dark); font-size: 1.1rem;">Custom Goal</h4>
                                <p style="margin: 0 0 12px 0; color: var(--text-muted); font-size: 0.9rem; line-height: 1.5;">
                                    Track anything you want! You <strong>manually update</strong> progress by clicking "Update" button.<br>
                                    ‚ùå Does NOT auto-update with study hours.
                                </p>
                                
                                <div style="background: rgba(251, 191, 36, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #fbbf24;">
                                    <div style="font-weight: 600; margin-bottom: 6px; color: var(--text-dark); font-size: 0.9rem;">
                                        üí° Examples of Custom Goals:
                                    </div>
                                    <ul style="margin: 0; padding-left: 20px; color: var(--text-muted); font-size: 0.85rem; line-height: 1.8;">
                                        <li>Read 20 finance books this year</li>
                                        <li>Complete 100 workout sessions</li>
                                        <li>Learn 500 Chinese characters</li>
                                        <li>Attend 10 networking events</li>
                                        <li>Build 5 side projects</li>
                                    </ul>
                                </div>
                                
                                <!-- Quick Custom Suggestions -->
                                <div style="margin-top: 12px;">
                                    <div style="font-weight: 600; margin-bottom: 8px; color: var(--text-dark); font-size: 0.9rem;">
                                        Quick Templates:
                                    </div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        ${getCustomGoalTemplates().map(template => `
                                            <button type="button" onclick="applyCustomTemplate('${template.title}', ${template.target})"
                                                style="padding: 6px 12px; background: white; border: 1px solid #fbbf24; border-radius: 20px; cursor: pointer; font-size: 0.85rem; color: #92400e; transition: all 0.2s;">
                                                ${template.title}
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Helper: Get Study Hours Suggestions based on career
        function getStudyHoursSuggestions() {
            const suggestions = [
                { label: 'Foundation', hours: 50 },
                { label: 'Intermediate', hours: 150 },
                { label: 'Advanced', hours: 300 },
            ];
            
            // Career-specific suggestions
            if (currentCareer === 'pe' || currentCareer === 'ib') {
                suggestions.push({ label: 'Expert', hours: 500 });
            } else if (currentCareer === 'hf') {
                suggestions.push({ label: 'Quant Expert', hours: 600 });
            } else if (currentCareer === 'cfa1') {
                suggestions.push({ label: 'CFA L1 Ready', hours: 300 });
            }
            
            return suggestions;
        }

        // Helper: Apply Suggestion to Target
        function applySuggestion(hours, label) {
            const targetInput = document.getElementById('goalTarget');
            const titleInput = document.getElementById('goalTitle');
            
            if (targetInput) {
                targetInput.value = hours;
            }
            
            // Auto-suggest title if empty
            if (titleInput && !titleInput.value.trim()) {
                const careerTitle = skillsData[currentCareer]?.title || currentCareer;
                titleInput.value = `${label} in ${careerTitle}`;
            }
            
            showNotification(`‚úÖ Target set to ${hours} hours`, 'success');
        }

        // Helper: Get Custom Goal Templates
        function getCustomGoalTemplates() {
            return [
                { title: 'üìö Read 20 Books', target: 20 },
                { title: 'üí™ 100 Workouts', target: 100 },
                { title: 'üéØ 10 Projects', target: 10 },
                { title: 'üåê Learn 500 Words', target: 500 }
            ];
        }

        // Helper: Apply Custom Template
        function applyCustomTemplate(title, target) {
            const titleInput = document.getElementById('goalTitle');
            const targetInput = document.getElementById('goalTarget');
            
            if (titleInput) titleInput.value = title;
            if (targetInput) targetInput.value = target;
            
            showNotification(`‚úÖ Template applied: ${title}`, 'success');
        }


        function renderGoals() {
            const container = document.getElementById('goalsContainer');
            const careerTitleEl = document.getElementById('goalsCareerTitle');
            
            if (!container || !careerTitleEl) return;
            
            const careerData = skillsData[currentCareer];
            if (careerData) {
                careerTitleEl.textContent = careerData.title;
                careerTitleEl.setAttribute('data-career', currentCareer);
            }
            
            // ‚úÖ L·ªçc Active v√† Completed goals
            const activeGoals = goals.filter(g => 
                g.career === currentCareer && getGoalStatus(g) !== 'completed'
            );
            const completedGoals = goals.filter(g => 
                g.career === currentCareer && getGoalStatus(g) === 'completed'
            );
            
            // ‚úÖ N·∫øu kh√¥ng c√≥ goals n√†o
            if (activeGoals.length === 0 && completedGoals.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px 20px; color: var(--text-muted);">
                        <div style="font-size: 5rem; margin-bottom: 15px; opacity: 0.5;">üéØ</div>
                        <h3 style="margin: 0 0 10px 0; color: var(--text-dark);">No Goals Yet</h3>
                        <p style="margin: 0 0 20px 0; font-size: 0.95rem;">
                            Set your first goal to start tracking progress in ${careerData ? careerData.title : currentCareer}.
                        </p>
                        <button onclick="showSmartSuggestions()" 
                            style="padding: 10px 20px; background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            üí° Show Smart Suggestions
                        </button>
                    </div>
                `;
                updateGoalProgressChart();
                return;
            }
            
            let html = '';
            
            // ‚úÖ ACTIVE GOALS SECTION (Always Expanded)
            if (activeGoals.length > 0) {
                html += `
                    <div class="goals-section active-section" style="margin-bottom: 24px;">
                        <div class="section-header" style="display: flex; align-items: center; gap: 10px; padding: 12px 0; margin-bottom: 16px; border-bottom: 2px solid rgba(59, 130, 246, 0.2);">
                            <span style="font-size: 1.3rem; font-weight: 700; color: var(--text-dark);">
                                üöÄ Active Goals
                            </span>
                            <span style="background: rgba(59, 130, 246, 0.15); color: #3b82f6; padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;">
                                ${activeGoals.length}
                            </span>
                        </div>
                        <div class="goals-list">
                            ${activeGoals.map(goal => {
                                calculateGoalProgress(goal);
                                const status = getGoalStatus(goal);
                                const progressPercent = getGoalProgressPercent(goal);
                                const forecast = calculateGoalForecast(goal);
                                return renderGoalCard(goal, status, progressPercent, forecast);
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            // ‚úÖ COMPLETED GOALS SECTION (Collapsible)
            if (completedGoals.length > 0) {
                const isExpanded = localStorage.getItem('completedGoalsExpanded') !== 'false';
                
                html += `
                    <div class="goals-section completed-section" style="margin-top: 24px;">
                        <div class="section-header" onclick="toggleCompletedGoals()" 
                            style="display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; margin-bottom: ${isExpanded ? '16px' : '0'}; background: rgba(16, 185, 129, 0.05); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; border: 1px solid rgba(16, 185, 129, 0.15);">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.3rem; font-weight: 700; color: #10b981;">
                                    ‚úÖ Completed Goals
                                </span>
                                <span style="background: rgba(16, 185, 129, 0.2); color: #065f46; padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;">
                                    ${completedGoals.length}
                                </span>
                            </div>
                            <span class="toggle-icon" style="font-size: 1.2rem; color: #10b981; transition: transform 0.3s ease; ${isExpanded ? '' : 'transform: rotate(-90deg);'}">
                                ‚ñº
                            </span>
                        </div>
                        <div class="goals-list completed-goals-list" style="display: ${isExpanded ? 'block' : 'none'};">
                            ${completedGoals.map(goal => {
                                calculateGoalProgress(goal);
                                const status = getGoalStatus(goal);
                                const progressPercent = getGoalProgressPercent(goal);
                                return renderGoalCard(goal, status, progressPercent, null);
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            // ‚úÖ Render HTML v√†o container
            container.innerHTML = html;

            // ‚úÖ Th√™m n√∫t "View Archived Goals" NGAY SAU khi set innerHTML
            const addGoalBtn = document.querySelector('.goal-add-btn');
            if (addGoalBtn && !document.querySelector('.goal-archive-btn')) {
                const archiveBtn = document.createElement('button');
                archiveBtn.className = 'goal-archive-btn';
                archiveBtn.onclick = openArchivedGoalsModal;
                archiveBtn.innerHTML = `üì¶ View Archived Goals (${archivedGoals.length})`;
                archiveBtn.style.cssText = `
                    width: 100%; 
                    padding: 12px; 
                    background: rgba(100, 116, 139, 0.1); 
                    color: #64748b; 
                    border: 1px solid #cbd5e1; 
                    border-radius: 12px; 
                    font-weight: 600; 
                    font-size: 0.95rem; 
                    cursor: pointer; 
                    transition: all 0.3s ease; 
                    margin-bottom: 15px; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center; 
                    gap: 8px;
                `;
                addGoalBtn.parentNode.insertBefore(archiveBtn, addGoalBtn.nextSibling);
            }

            // ‚úÖ C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì sau c√πng
            updateGoalProgressChart();
        }


        function toggleCompletedGoals() {
            const list = document.querySelector('.completed-goals-list');
            const icon = document.querySelector('.completed-section .toggle-icon');
            
            if (!list || !icon) return;
            
            const isExpanded = list.style.display !== 'none';
            
            list.style.display = isExpanded ? 'none' : 'block';
            icon.style.transform = isExpanded ? 'rotate(-90deg)' : 'rotate(0)';
            
            // ‚úÖ Save state to localStorage
            localStorage.setItem('completedGoalsExpanded', !isExpanded);
        }


        function toggleCompletedGoals() {
            const list = document.querySelector('.completed-goals-list');
            const icon = document.querySelector('.completed-section .toggle-icon');
            
            if (!list || !icon) return;
            
            const isExpanded = list.style.display !== 'none';
            
            list.style.display = isExpanded ? 'none' : 'block';
            icon.style.transform = isExpanded ? 'rotate(-90deg)' : 'rotate(0)';
            
            localStorage.setItem('completedGoalsExpanded', !isExpanded);
        }

        // Calculate Goal Forecast (7-day average + estimated completion)
        function calculateGoalForecast(goal) {
            if (goal.type === 'custom' || goal.currentProgress >= goal.target) {
                return null;
            }
            
            // Get last 7 days of progress
            const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
            const recentProgress = goal.progressHistory?.filter(p => p.timestamp > sevenDaysAgo) || [];
            
            if (recentProgress.length === 0) {
                return null;
            }
            
            // Calculate daily average
            const totalRecentProgress = recentProgress.reduce((sum, p) => sum + p.amount, 0);
            const dailyAverage = totalRecentProgress / 7;
            
            if (dailyAverage <= 0) {
                return null;
            }
            
            // Calculate days until completion
            const remaining = goal.target - goal.currentProgress;
            const daysUntilCompletion = Math.ceil(remaining / dailyAverage);
            const estimatedDate = new Date(Date.now() + daysUntilCompletion * 24 * 60 * 60 * 1000);
            
            return {
                dailyAverage: dailyAverage.toFixed(1),
                daysUntilCompletion,
                estimatedDate: estimatedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                isRealistic: daysUntilCompletion <= 365 // Less than a year
            };
        }

        // Render Individual Goal Card with Enhanced Visuals
        function renderGoalCard(goal, status, progressPercent, forecast) {
            const statusConfig = {
                active: { 
                    badge: 'üöÄ Active', 
                    color: '#3b82f6',
                    bgColor: 'rgba(59, 130, 246, 0.1)',
                    borderColor: '#3b82f6'
                },
                overdue: { 
                    badge: '‚è∞ Overdue', 
                    color: '#ef4444',
                    bgColor: 'rgba(239, 68, 68, 0.1)',
                    borderColor: '#ef4444'
                },
                completed: { 
                    badge: '‚úÖ Completed', 
                    color: '#10b981',
                    bgColor: 'rgba(16, 185, 129, 0.1)',
                    borderColor: '#10b981'
                }
            };
            
            const config = statusConfig[status] || statusConfig.active;
            const typeIcons = {
                study_hours: 'üìö',
                skill_mastery: 'üéØ',
                custom: '‚úÖ'
            };
            
            const deadlineText = goal.deadline 
                ? formatDate(goal.deadline)
                : 'No deadline';
            
            const deadlineClass = status === 'overdue' 
                ? 'style="color: #ef4444; font-weight: 600;"'
                : status === 'soon' 
                ? 'style="color: #f59e0b; font-weight: 600;"'
                : '';
            
            return `
                <div class="goal-item" data-id="${goal.id}" 
                    style="background: var(--bg-white); border-radius: 12px; padding: 20px; margin-bottom: 16px; border-left: 4px solid ${config.borderColor}; box-shadow: var(--shadow-sm); transition: all 0.3s ease;">
                    
                    <!-- Header -->
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; flex-wrap: wrap; gap: 10px;">
                        <div style="flex: 1; min-width: 200px;">
                            <div style="font-size: 1.15rem; font-weight: 700; color: var(--text-dark); margin-bottom: 6px; line-height: 1.3;">
                                ${typeIcons[goal.type]} ${escapeHtml(goal.title)}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-muted);">
                                ${getGoalTypeLabel(goal)} ${goal.skillName ? `‚Ä¢ ${goal.skillName}` : ''}
                            </div>
                        </div>
                        <span style="padding: 6px 14px; background: ${config.bgColor}; color: ${config.color}; border-radius: 20px; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">
                            ${config.badge}
                        </span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div style="margin: 16px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-size: 0.9rem; font-weight: 600; color: var(--text-dark);">
                                ${goal.currentProgress.toFixed(1)} / ${goal.target} ${goal.type === 'custom' ? 'items' : 'hours'}
                            </span>
                            <span style="font-size: 0.9rem; font-weight: 700; color: ${config.color};">
                                ${progressPercent.toFixed(0)}%
                            </span>
                        </div>
                        <div style="width: 100%; height: 10px; background: var(--border-color); border-radius: 10px; overflow: hidden;">
                            <div style="height: 100%; width: ${Math.min(100, progressPercent)}%; background: linear-gradient(90deg, ${config.color}, ${config.color}dd); border-radius: 10px; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                    
                    <!-- Forecast Section -->
                    ${forecast && status !== 'completed' ? `
                        <div style="background: rgba(59, 130, 246, 0.05); padding: 12px; border-radius: 8px; margin: 12px 0; border-left: 3px solid #3b82f6;">
                            <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 6px;">
                                üìä <strong>Progress Forecast</strong>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 0.85rem;">
                                <div>
                                    <span style="color: var(--text-muted);">7-day avg:</span>
                                    <strong style="color: var(--text-dark);"> ${forecast.dailyAverage}h/day</strong>
                                </div>
                                <div>
                                    <span style="color: var(--text-muted);">Est. completion:</span>
                                    <strong style="color: ${forecast.isRealistic ? '#10b981' : '#f59e0b'};"> ${forecast.estimatedDate}</strong>
                                </div>
                                <div>
                                    <span style="color: var(--text-muted);">Days left:</span>
                                    <strong style="color: var(--text-dark);"> ~${forecast.daysUntilCompletion}</strong>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- Meta Info -->
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin: 12px 0; font-size: 0.85rem; color: var(--text-muted);">
                        <div>üìÖ Deadline: <strong ${deadlineClass}>${deadlineText}</strong></div>
                        ${goal.createdAt ? `<div>üïê Created: ${formatDate(goal.createdAt)}</div>` : ''}
                    </div>
                    
                    <!-- Actions -->
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                        ${renderGoalActionButtons(goal, status)}
                    </div>
                </div>
            `;
        }

        // Helper: Get Goal Type Label
        function getGoalTypeLabel(goal) {
            const labels = {
                study_hours: 'üìö Study Hours (Auto-sync)',
                skill_mastery: 'üéØ Skill Mastery (Auto-sync)',
                custom: '‚úÖ Custom Goal (Manual)'
            };
            return labels[goal.type] || goal.type;
        }

        function renderGoalActionButtons(goal, status) {
            let buttons = '';
            
            // ‚úÖ Update Progress (ONLY for custom goals)
            if (goal.type === 'custom') {
                buttons += `
                    <button onclick="openUpdateCustomGoalModal('${goal.id}')" 
                        style="padding: 8px 14px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.2s;">
                        ‚úèÔ∏è Update Progress
                    </button>
                `;
            }
            
            // ‚úÖ Edit Goal
            buttons += `
                <button onclick="openEditGoalModal('${goal.id}')" 
                    style="padding: 8px 14px; background: var(--bg-light); color: var(--text-dark); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.2s;">
                    ‚úèÔ∏è Edit
                </button>
            `;
            
            // ‚úÖ ARCHIVE BUTTON (for completed) OR DELETE (for active)
            if (status === 'completed') {
                buttons += `
                    <button onclick="deleteGoal('${goal.id}')" 
                        style="padding: 8px 14px; background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid #10b981; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.2s;">
                        üì¶ Archive
                    </button>
                `;
            } else {
                buttons += `
                    <button onclick="deleteGoal('${goal.id}')" 
                        style="padding: 8px 14px; background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid #ef4444; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.2s;">
                        üóëÔ∏è Delete
                    </button>
                `;
            }
            
            return buttons;
        }




        // ===== OPEN ARCHIVED GOALS MODAL =====
        function openArchivedGoalsModal() {
            document.getElementById('archivedGoalsModal').style.display = 'flex';
            renderArchivedGoals();
        }

        // ===== CLOSE ARCHIVED GOALS MODAL =====
        function closeArchivedGoalsModal() {
            document.getElementById('archivedGoalsModal').style.display = 'none';
        }

        // ===== RENDER ARCHIVED GOALS =====
        function renderArchivedGoals() {
            const container = document.getElementById('archivedGoalsContainer');
            const careerFilter = document.getElementById('archiveCareerFilter').value;
            
            if (!container) return;
            
            let filteredArchived = archivedGoals;
            
            if (careerFilter !== 'all') {
                filteredArchived = archivedGoals.filter(g => g.career === careerFilter);
            }
            
            if (filteredArchived.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
                        <div style="font-size: 4rem; margin-bottom: 15px; opacity: 0.3;">üì¶</div>
                        <h3 style="margin: 0 0 8px 0; color: var(--text-dark);">No Archived Goals</h3>
                        <p style="margin: 0; font-size: 0.95rem;">
                            ${careerFilter === 'all' ? 'Complete some goals to see them here!' : 'No archived goals for this career yet.'}
                        </p>
                    </div>
                `;
                return;
            }
            
            // Sort by archived date (newest first)
            filteredArchived.sort((a, b) => new Date(b.archivedAt) - new Date(a.archivedAt));
            
            // Group by month
            const groupedByMonth = {};
            filteredArchived.forEach(goal => {
                const date = new Date(goal.archivedAt);
                const monthKey = date.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                
                if (!groupedByMonth[monthKey]) {
                    groupedByMonth[monthKey] = [];
                }
                groupedByMonth[monthKey].push(goal);
            });
            
            let html = `
                <div style="margin-bottom: 20px; padding: 16px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border-left: 4px solid #10b981;">
                    <div style="font-size: 1.1rem; font-weight: 600; color: #10b981; margin-bottom: 8px;">
                        üéâ Total Achievements
                    </div>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 150px;">
                            <div style="font-size: 0.85rem; color: var(--text-muted);">Total Archived</div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #10b981;">${filteredArchived.length}</div>
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <div style="font-size: 0.85rem; color: var(--text-muted);">Total Hours Completed</div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #10b981;">
                                ${filteredArchived.reduce((sum, g) => sum + (g.target || 0), 0).toFixed(0)}h
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Render each month group
            Object.entries(groupedByMonth).forEach(([month, goals]) => {
                html += `
                    <div style="margin-bottom: 30px;">
                        <div style="font-size: 1.2rem; font-weight: 700; color: var(--text-dark); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--border-color); display: flex; align-items: center; gap: 10px;">
                            üìÖ ${month}
                            <span style="font-size: 0.85rem; font-weight: 500; color: var(--text-muted);">(${goals.length} goals)</span>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            ${goals.map(goal => renderArchivedGoalCard(goal)).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }





        // Track Progress History (for forecasting)
        function trackGoalProgressHistory(goalId, amount) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            if (!goal.progressHistory) {
                goal.progressHistory = [];
            }  
            goal.progressHistory.push({
                timestamp: Date.now(),
                amount: amount
            });
            const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
            goal.progressHistory = goal.progressHistory.filter(p => p.timestamp > thirtyDaysAgo);
            
            saveGoals();
        }


        function showSmartSuggestions() {
            const suggestions = suggestGoalsForCareer(currentCareer);
            
            if (suggestions.length === 0) {
                showNotification('No suggestions available for this career yet.', 'info');
                return;
            }
            const modal = document.createElement('div');
            modal.id = 'smartSuggestionsModal';
            modal.style.cssText = `
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
                backdrop-filter: blur(4px);
            `;
            
            modal.innerHTML = `
                <div style="background: var(--bg-white); border-radius: 16px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <!-- Header -->
                    <div style="padding: 24px; border-bottom: 1px solid var(--border-color); position: sticky; top: 0; background: var(--bg-white); z-index: 1;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h2 style="margin: 0 0 8px 0; font-size: 1.5rem; color: var(--text-dark);">
                                    üí° Smart Goal Suggestions
                                </h2>
                                <p style="margin: 0; color: var(--text-muted); font-size: 0.9rem;">
                                    Recommended goals for <strong>${skillsData[currentCareer]?.title || currentCareer}</strong>
                                </p>
                            </div>
                            <button onclick="closeSmartSuggestions()" 
                                style="background: none; border: none; font-size: 28px; cursor: pointer; color: var(--text-muted); width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 8px; transition: all 0.2s;">
                                √ó
                            </button>
                        </div>
                    </div>
                    
                    <!-- Body -->
                    <div style="padding: 20px;">
                        ${renderSuggestionsByTier(suggestions)}
                    </div>
                    
                    <!-- Footer -->
                    <div style="padding: 16px 24px; border-top: 1px solid var(--border-color); background: var(--bg-light); text-align: center;">
                        <p style="margin: 0; font-size: 0.85rem; color: var(--text-muted);">
                            üí° Click any suggestion to add it as a goal
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listener for backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeSmartSuggestions();
                }
            });
        }

        // Close Smart Suggestions Modal
        function closeSmartSuggestions() {
            const modal = document.getElementById('smartSuggestionsModal');
            if (modal) {
                modal.remove();
            }
        }

        // Render Suggestions by Tier
        function renderSuggestionsByTier(suggestions) {
            // Group suggestions by category
            const tiers = {
                foundation: suggestions.filter(s => s.target <= 100 || s.description?.includes('Foundation')),
                intermediate: suggestions.filter(s => s.target > 100 && s.target <= 500 && !s.description?.includes('Foundation') && !s.description?.includes('Expert')),
                advanced: suggestions.filter(s => s.target > 500 && !s.description?.includes('Expert')),
                expert: suggestions.filter(s => s.description?.includes('Expert') || s.target >= 1000)
            };
            
            const tierConfig = {
                foundation: {
                    title: 'üå± Foundation Level',
                    description: 'Start your journey here',
                    color: '#10b981',
                    bgColor: 'rgba(16, 185, 129, 0.1)'
                },
                intermediate: {
                    title: 'üìö Intermediate Level',
                    description: 'Build your skills',
                    color: '#3b82f6',
                    bgColor: 'rgba(59, 130, 246, 0.1)'
                },
                advanced: {
                    title: 'üöÄ Advanced Level',
                    description: 'Level up your expertise',
                    color: '#8b5cf6',
                    bgColor: 'rgba(139, 92, 246, 0.1)'
                },
                expert: {
                    title: 'üèÜ Expert Level',
                    description: 'Reach mastery',
                    color: '#f59e0b',
                    bgColor: 'rgba(245, 158, 11, 0.1)'
                }
            };
            
            let html = '';
            
            Object.entries(tiers).forEach(([tier, goals]) => {
                if (goals.length === 0) return;
                
                const config = tierConfig[tier];
                
                html += `
                    <div style="margin-bottom: 30px;">
                        <!-- Tier Header -->
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid ${config.color};">
                            <div style="font-size: 1.3rem; font-weight: 700; color: ${config.color};">
                                ${config.title}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-muted); font-style: italic;">
                                ${config.description}
                            </div>
                        </div>
                        
                        <!-- Goal Cards -->
                        <div style="display: grid; gap: 12px;">
                            ${goals.map(suggestion => renderSuggestionCard(suggestion, config)).join('')}
                        </div>
                    </div>
                `;
            });
            
            return html || '<p style="text-align: center; color: var(--text-muted); padding: 40px;">No suggestions available.</p>';
        }



        function renderSuggestionCard(suggestion, config) {
            if (!suggestion || !config) return '';    
            const typeIcons = {
                study_hours: 'üìö',
                skill_mastery: 'üéØ',
                custom: '‚úÖ'
            };
            const icon = typeIcons[suggestion.type] || 'üìå';
            const existingGoal = goals.find(g => 
                g.title === suggestion.title && 
                g.career === currentCareer
            );
            
            return `
                <div class="suggestion-card" 
                    onclick="${existingGoal ? '' : `applySuggestionToGoal(${JSON.stringify(suggestion).replace(/"/g, '&quot;')})`}"
                    style="
                        padding: 16px;
                        background: ${existingGoal ? 'var(--bg-light)' : config.bgColor};
                        border: 2px solid ${existingGoal ? 'var(--border-color)' : config.color};
                        border-radius: 12px;
                        cursor: ${existingGoal ? 'default' : 'pointer'};
                        transition: all 0.3s ease;
                        opacity: ${existingGoal ? '0.6' : '1'};
                        ${existingGoal ? '' : 'box-shadow: 0 2px 8px rgba(0,0,0,0.05);'}
                    ">
                    <div style="display: flex; gap: 12px; align-items: start;">
                        <div style="font-size: 2rem; flex-shrink: 0;">${icon}</div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 4px; font-size: 1rem; line-height: 1.3;">
                                ${suggestion.title}
                                ${existingGoal ? '<span style="margin-left: 8px; font-size: 0.75rem; color: #10b981;">‚úì Added</span>' : ''}
                            </div>
                            ${suggestion.description ? `
                                <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px; line-height: 1.4;">
                                    ${suggestion.description}
                                </div>
                            ` : ''}
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; align-items: center; font-size: 0.8rem; color: var(--text-muted);">
                                <span style="padding: 4px 10px; background: white; border-radius: 12px; font-weight: 500;">
                                    üéØ ${suggestion.target} ${suggestion.type === 'custom' ? 'items' : 'hours'}
                                </span>
                                ${suggestion.skillName ? `
                                    <span style="padding: 4px 10px; background: white; border-radius: 12px; font-weight: 500;">
                                        üìñ ${suggestion.skillName}
                                    </span>
                                ` : ''}
                                ${!existingGoal ? `
                                    <span style="color: ${config.color}; font-weight: 600; margin-left: auto;">
                                        Click to add ‚Üí
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Apply Suggestion to Goal Form
        function applySuggestionToGoal(suggestion) {
            closeSmartSuggestions();
            openAddGoalModal();
            
            // Wait for modal to render
            setTimeout(() => {
                // Fill in the form
                document.getElementById('goalTitle').value = suggestion.title;
                document.getElementById('goalTarget').value = suggestion.target;
                
                // Select goal type
                selectGoalType(suggestion.type);
                
                // Set skill if applicable
                if (suggestion.type === 'skill_mastery' && suggestion.skillName) {
                    setTimeout(() => {
                        const skillSelect = document.getElementById('goalSkillSelect');
                        if (skillSelect) {
                            skillSelect.value = suggestion.skillName;
                            skillSelect.dispatchEvent(new Event('change'));
                        }
                    }, 100);
                }
                
                showNotification(`‚úÖ Template applied: ${suggestion.title}`, 'success');
            }, 100);
        }

        // ENHANCED: Career-Specific Goal Suggestions
        function suggestGoalsForCareer(career) {
            const suggestions = [];
            
            switch (career) {
                // --- ENGLISH ---
                case 'english':
                    suggestions.push(
                        { title: "Reach B2 Level (Fluent)", type: "study_hours", target: 260, description: "Upper-intermediate proficiency for professional use" },
                        { title: "Reach C1 Level (Advanced)", type: "study_hours", target: 610, description: "Advanced proficiency for academic/professional excellence" },
                        { title: "Reach C2 Level (Mastery)", type: "study_hours", target: 1010, description: "Near-native proficiency" },
                        { title: "Master Business Presentations", type: "skill_mastery", target: 140, skillName: "Business Presentations (Clarity, Structure, Storytelling)", description: "Professional communication skills" },
                        { title: "Master Interview Skills", type: "skill_mastery", target: 100, skillName: "Interview Skills (STAR Method, Behavioral Questions, Case Interviews)", description: "Ace any interview" }
                    );
                    break;
                    
                // --- CHINESE ---
                case 'chinese':
                    suggestions.push(
                        { title: "Master Pinyin & Tones", type: "skill_mastery", target: 50, skillName: "ÊãºÈü≥ (Pinyin - Ph√°t √¢m)", description: "Foundation of Chinese pronunciation" },
                        { title: "Learn 500 Core Characters", type: "skill_mastery", target: 100, skillName: "Ê±âÂ≠ó (H√°n t·ª± - Nh·∫≠n di·ªán & Vi·∫øt)", description: "Build reading foundation" },
                        { title: "Complete HSK 1-3 Foundation", type: "study_hours", target: 300, description: "Basic to intermediate proficiency" },
                        { title: "HSK 4-6 Proficiency", type: "study_hours", target: 500, description: "Advanced fluency and HSK 6 level" },
                        { title: "Business Chinese Communication", type: "skill_mastery", target: 200, skillName: "ÂïÜÂä°‰ºöËÆÆ (H·ªçp kinh doanh)", description: "Professional workplace Chinese" },
                        { title: "Achieve Expert Level (10,000h)", type: "study_hours", target: 10000, description: "Reach top 1-5% proficiency" }
                    );
                    break;
                    
                // --- CFA LEVEL 1 ---
                case 'cfa1':
                    suggestions.push(
                        { title: "Master Ethics & Standards", type: "skill_mastery", target: 100, skillName: "Code of Ethics and Standards of Professional Conduct", description: "15% of exam weight" },
                        { title: "Master Quantitative Methods", type: "skill_mastery", target: 70, skillName: "Time Value of Money", description: "Essential calculation skills" },
                        { title: "Master Financial Statement Analysis", type: "skill_mastery", target: 120, skillName: "Understanding Financial Statements", description: "20% of exam weight" },
                        { title: "Complete CFA L1 Foundation (300h)", type: "study_hours", target: 300, description: "Recommended study time by CFA Institute" },
                        { title: "Complete Intensive CFA L1 Prep (450h)", type: "study_hours", target: 450, description: "For comprehensive mastery" }
                    );
                    break;

                    
                // --- FINANCE CAREERS (PE, IB, HF, SC, FINTECH) ---
                case 'pe':
                case 'ib':
                case 'hf':
                case 'sc':
                case 'fintech':
                    // FOUNDATION LAYER (70-80% shared base)
                    suggestions.push({
                        title: "Finance Foundation (CFA L1 + Core)",
                        type: "study_hours",
                        target: 500,
                        description: "Build the shared 70-80% base across all finance careers"
                    });
                    
                    // BRANCHING LAYER (Career-specific)
                    if (career === 'pe') {
                        suggestions.push(
                            { title: "Master LBO Modeling", type: "skill_mastery", target: 160, skillName: "LBO Modeling", description: "Core PE skill" },
                            { title: "Master DCF Valuation", type: "skill_mastery", target: 120, skillName: "DCF Valuation", description: "Essential valuation technique" },
                            { title: "PE Expertise (Deal Structuring, LBO)", type: "study_hours", target: 2000, description: "Deep dive into PE-specific skills" },
                            { title: "Achieve PE Expert Level", type: "study_hours", target: 5000, description: "Reach top 1-5% proficiency in Private Equity" }
                        );
                    } else if (career === 'ib') {
                        suggestions.push(
                            { title: "Master Financial Modeling", type: "skill_mastery", target: 140, skillName: "Financial Modeling", description: "Core IB skill" },
                            { title: "Master M&A Advisory", type: "skill_mastery", target: 130, skillName: "M&A Advisory", description: "Deal execution skills" },
                            { title: "IB Expertise (Pitchbooks, Live Deals)", type: "study_hours", target: 2000, description: "Master the IB workflow and tools" },
                            { title: "Achieve IB Expert Level", type: "study_hours", target: 5000, description: "Reach top 1-5% proficiency in Investment Banking" }
                        );
                    } else if (career === 'hf') {
                        suggestions.push(
                            { title: "Master Python for Finance", type: "skill_mastery", target: 180, skillName: "Python for Finance (Pandas, NumPy, Backtrader)", description: "Quant foundations" },
                            { title: "Master Statistical Arbitrage", type: "skill_mastery", target: 150, skillName: "Statistical Arbitrage", description: "Advanced trading strategy" },
                            { title: "HF Expertise (Quant, Risk, Coding)", type: "study_hours", target: 3000, description: "Become proficient in quant strategies" },
                            { title: "Achieve HF Expert Level", type: "study_hours", target: 6000, description: "Reach top 1-5% proficiency in Hedge Funds" }
                        );
                    } else if (career === 'sc') {
                        suggestions.push(
                            { title: "Master Case Frameworks", type: "skill_mastery", target: 80, skillName: "Case Framework Mastery (MECE, Issue Tree, Pyramid Principle)", description: "Essential for case interviews" },
                            { title: "Master Problem Solving", type: "skill_mastery", target: 90, skillName: "Problem Solving (Structured Thinking)", description: "Core consulting skill" },
                            { title: "SC Expertise (Frameworks, Cases)", type: "study_hours", target: 2000, description: "Master case-solving and strategic thinking" },
                            { title: "Achieve SC Expert Level", type: "study_hours", target: 4500, description: "Reach top 1-5% proficiency in Strategy Consulting" }
                        );
                    } else if (career === 'fintech') {
                        suggestions.push(
                            { title: "Master Python for Finance", type: "skill_mastery", target: 160, skillName: "Python for Finance (pandas, NumPy, scikit-learn)", description: "Tech foundation" },
                            { title: "Master SQL & Databases", type: "skill_mastery", target: 100, skillName: "SQL & Databases (Relational, Query Optimization)", description: "Data skills" },
                            { title: "Fintech Expertise (Code, Products, Regs)", type: "study_hours", target: 2500, description: "Deep dive into tech, data, and fintech models" },
                            { title: "Achieve Fintech Expert Level", type: "study_hours", target: 5500, description: "Reach top 1-5% proficiency in Fintech" }
                        );
                    }
                    break;
                    
                default:
                    suggestions.push(
                        { title: "Explore & Build Foundation", type: "study_hours", target: 50, description: "Start your learning journey" },
                        { title: "Develop Basic Proficiency", type: "study_hours", target: 150, description: "Build fundamental skills" }
                    );
            }
            
            return suggestions;
        }


        function openUpdateGoalProgressModal(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;           
            document.getElementById('updateGoalProgressId').value = goal.id;
            document.getElementById('updateGoalProgressValue').value = goal.currentProgress || 0;
            document.getElementById('updateGoalProgressModal').style.display = 'flex';
            const modalTitle = document.getElementById('updateGoalProgressModalTitle');
            if (modalTitle) {
                modalTitle.textContent = `üìä Update Progress: ${goal.title}`;
            }
        }

        function closeUpdateGoalProgressModal() {
            document.getElementById('updateGoalProgressModal').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const updateGoalProgressForm = document.getElementById('updateGoalProgressForm');
            if (updateGoalProgressForm) {
                updateGoalProgressForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const id = document.getElementById('updateGoalProgressId').value;
                    const newValue = parseFloat(document.getElementById('updateGoalProgressValue').value);
                    
                    if (isNaN(newValue) || newValue < 0) {
                        showNotification('Please enter a valid progress value.', 'error');
                        return;
                    }
                    
                    const goal = goals.find(g => g.id === id);
                    if (goal && (goal.type === 'study_hours' || goal.type === 'skill_mastery')) {
                        goal.currentProgress = newValue;
                        goal.manuallyUpdated = true;                        
                        saveGoals();
                        renderGoals();
                        closeUpdateGoalProgressModal();
                        showNotification('Goal progress updated manually!', 'success');
                        if (goal.currentProgress >= goal.target && getGoalStatus(goal) !== 'completed') {
                            gamification.points += 50;
                            gamification.level = Math.floor(gamification.points / 100) + 1;
                            localStorage.setItem('gamification', JSON.stringify(gamification));
                            updateGamificationStats();
                            showNotification(`üéâ Goal completed! Earned 50 XP!`, 'achievement');
                        }
                    }
                });
            }
        });


        function calculateGoalProgress(goal) {
            if (goal.manuallyUpdated) {
                return Math.min(goal.target, Math.max(0, goal.currentProgress || 0));
            }
            
            if (goal.type === 'study_hours') {
                if (goal.courseId) {
                    const course = courses.find(c => c.id === goal.courseId);
                    goal.currentProgress = course ? (course.hoursStudied || 0) : 0;
                } else {
                    const careerHours = studyHours[currentCareer] || {};
                    const totalHours = Object.values(careerHours).reduce((sum, h) => sum + h, 0);
                    goal.currentProgress = totalHours;
                }
            } else if (goal.type === 'skill_mastery') {
                if (goal.skillName) {
                    goal.currentProgress = getSkillHours(currentCareer, goal.skillName);
                } else {
                    const careerData = skillsData[currentCareer];
                    let totalSkillHours = 0;
                    if (careerData) {
                        Object.values(careerData.categories).forEach(category => {
                            category.skills.forEach(skill => {
                                totalSkillHours += getSkillHours(currentCareer, skill.name);
                            });
                        });
                    }
                    goal.currentProgress = totalSkillHours;
                }
            }
            return Math.min(goal.target, Math.max(0, goal.currentProgress || 0));
        }
 

        function resetManualUpdateFlag(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (goal) {
                goal.manuallyUpdated = false;
                saveGoals();
            }
        }

        document.getElementById('goalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('editGoalId').value;
            const title = document.getElementById('goalTitle').value.trim();
            const type = document.getElementById('goalType').value;
            const target = parseFloat(document.getElementById('goalTarget').value);
            const deadline = document.getElementById('goalDeadline').value || undefined;
            
            if (!title || !type || isNaN(target) || target <= 0) {
                showNotification('Please fill in all required fields with valid values.', 'error');
                return;
            }
            let courseId = undefined;
            let skillName = undefined;
            
            if (type === 'study_hours') {
                const courseSelect = document.getElementById('goalCourseSelect');
                courseId = courseSelect ? courseSelect.value || undefined : undefined;
            } else if (type === 'skill_mastery') {
                const skillSelect = document.getElementById('goalSkillSelect');
                skillName = skillSelect ? skillSelect.value || undefined : undefined;
            } else if (type === 'complete_course') {
                const courseCompleteSelect = document.getElementById('goalCourseComplete');
                courseId = courseCompleteSelect ? courseCompleteSelect.value : undefined;
                if (!courseId) {
                    showNotification('Please select a course to complete.', 'error');
                    return;
                }
            }
            
            if (id) {
                const goalIndex = goals.findIndex(g => g.id === id);
                if (goalIndex !== -1) {
                    goals[goalIndex] = {
                        ...goals[goalIndex],
                        title,
                        type,
                        target,
                        deadline,
                        courseId,
                        skillName,
                        manuallyUpdated: false 
                    };
                    showNotification('Goal updated successfully!', 'success');
                }
            } else {
                const newGoal = {
                    id: Date.now().toString(),
                    title,
                    type,
                    target,
                    deadline,
                    career: currentCareer,
                    courseId,
                    skillName,
                    currentProgress: 0,
                    manuallyUpdated: false
                };
                goals.push(newGoal);
                showNotification('Goal added successfully!', 'success');
            }
            saveGoals();
            renderGoals();
            closeGoalModal();
        });


        function getGoalProgressPercent(goal) {
            const progress = calculateGoalProgress(goal);
            return goal.target > 0 ? Math.min(100, (progress / goal.target) * 100) : 0;
        }

        function openAddGoalModal() {
            document.getElementById('goalModalTitle').textContent = '‚ûï Add New Goal';
            document.getElementById('goalForm').reset();
            document.getElementById('editGoalId').value = '';
            document.getElementById('goalTypeSpecificFields').innerHTML = '';
            document.getElementById('goalModal').style.display = 'flex';
        }

        function closeGoalModal() {
            document.getElementById('goalModal').style.display = 'none';
        }

        document.getElementById('goalType').addEventListener('change', function() {
            populateGoalTypeSpecificFields(this.value);
        });



        // --- GOAL PROGRESS CHART ---
        let goalProgressChart = null;
        function initGoalProgressChart() {
            const ctx = document.getElementById('goalProgressChart').getContext('2d');
            if (goalProgressChart) {
                goalProgressChart.destroy();
            }
            const filteredGoals = goals.filter(g => g.career === currentCareer);
            const totalGoals = filteredGoals.length;
            const completedGoals = filteredGoals.filter(g => getGoalStatus(g) === 'completed').length;
            const remainingGoals = totalGoals - completedGoals;
            const completionRate = totalGoals > 0 ? Math.round((completedGoals / totalGoals) * 100) : 0;
            const data = {
                labels: ['Completed', 'Remaining'],
                datasets: [{
                    data: [completedGoals, remainingGoals],
                    backgroundColor: [
                        '#10b981', 
                        '#e2e8f0' 
                    ],
                    borderColor: [
                        '#059669',
                        '#cbd5e1'
                    ],
                    borderWidth: 2,
                    cutout: '70%' 
                }]
            };
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                return `${label}: ${value}`;
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: `${completionRate}% Complete`,
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        color: 'var(--text-dark)',
                        padding: 10
                    }
                },
                animation: {
                    duration: 1000,
                    easing: 'easeOutBounce'
                }
            };
            goalProgressChart = new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: options
            });
            document.getElementById('goalProgressSummary').textContent = `${completedGoals}/${totalGoals} goals completed`;
        }

        function updateGoalProgressChart() {
            if (document.getElementById('goalProgressChart')) {
                initGoalProgressChart();
            }
        }

        document.getElementById('courseForm').addEventListener('submit', saveCourse);
        document.getElementById('addHoursForm').addEventListener('submit', addHoursToCourse);
        document.addEventListener('DOMContentLoaded', function() {
            renderSessionLogs();
        });
 
        document.addEventListener('DOMContentLoaded', function() {
            const quoteCard = document.getElementById('quoteCard');
            if (quoteCard) {
                quoteCard.addEventListener('touchstart', function() {
                    this.style.transform = 'translateY(-6px) scale(1.03)';
                });
                
                quoteCard.addEventListener('touchend', function() {
                    this.style.transform = 'translateY(-3px) scale(1.02)';
                });
            }

            document.querySelectorAll('.career-card').forEach(card => {
                card.addEventListener('touchstart', function() {
                    this.style.transform = 'translateY(-8px) scale(1.02)';
                });
                
                card.addEventListener('touchend', function() {
                    this.style.transform = this.classList.contains('selected') ? 'translateY(-5px)' : 'translateY(0)';
                });
            });
        });





        // ===== IMPROVED SLEEP TRACKER WITH MANUAL INPUT & EDIT =====
        let sleepStartTime = null;
        let isSleeping = false;
        let sleepInterval = null;
        sleepSessions = JSON.parse(localStorage.getItem('sleepSessions')) || [];
        let sleepChart = null;

        function startSleepTracking() {
            if (isSleeping) return;
            sleepStartTime = Date.now();
            isSleeping = true;
            localStorage.setItem('sleepStartTime', sleepStartTime);
            localStorage.setItem('isSleeping', 'true');
            
            updateSleepUI();
            
            if (sleepInterval) clearInterval(sleepInterval);
            sleepInterval = setInterval(updateSleepDisplay, 1000);
            updateSleepDisplay();
            
            showNotification('üåô Sleep tracking started.', 'info');
        }

        function stopSleepTracking() {
            if (!isSleeping) return;
            
            const endTime = Date.now();
            const durationMs = endTime - sleepStartTime;
            const durationHours = (durationMs / (1000 * 60 * 60));
            
            // ‚úÖ C·∫¢NH B√ÅO N·∫æU QU√Å D√ÄI
            if (durationHours > 16) {
                if (!confirm(`‚ö†Ô∏è Sleep duration is ${durationHours.toFixed(1)} hours (>16h). This might be a mistake. Continue?`)) {
                    return;
                }
            }
            
            const session = {
                id: Date.now(),
                start: sleepStartTime,
                end: endTime,
                duration: parseFloat(durationHours.toFixed(2)),
                startFormatted: new Date(sleepStartTime).toLocaleString('vi-VN'),
                endFormatted: new Date(endTime).toLocaleString('vi-VN'),
                manual: true
            };
            
            sleepSessions.push(session);
            saveSleepData();
            
            isSleeping = false;
            sleepStartTime = null;
            if (sleepInterval) clearInterval(sleepInterval);
            sleepInterval = null;
            localStorage.removeItem('sleepStartTime');
            localStorage.removeItem('isSleeping');
            
            updateSleepUI();
            renderSleepHistory();
            renderSleepChart();
            updateCorrelationAnalytics();
            
            showNotification(`‚òÄÔ∏è Woke up! You slept for ${session.duration} hours.`, 'success');
        }

        // ‚úÖ TH√äM MANUAL SLEEP INPUT
        function openManualSleepModal() {
            const now = new Date();
            const defaultEnd = now.toISOString().slice(0, 16); // Format: YYYY-MM-DDTHH:MM
            const defaultStart = new Date(now - 8 * 60 * 60 * 1000).toISOString().slice(0, 16); // 8 hours ago
            
            const html = `
                <div id="manualSleepModal" style="position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 10000; backdrop-filter: blur(4px);">
                    <div style="background: var(--bg-white); border-radius: 16px; padding: 24px; max-width: 450px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: var(--text-dark);">üåô Add Sleep Session</h3>
                            <button onclick="closeManualSleepModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-muted);">&times;</button>
                        </div>
                        <form id="manualSleepForm">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Sleep Start</label>
                                <input type="datetime-local" id="manualSleepStart" value="${defaultStart}" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-light); color: var(--text-dark);">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Sleep End</label>
                                <input type="datetime-local" id="manualSleepEnd" value="${defaultEnd}" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-light); color: var(--text-dark);">
                            </div>
                            <div id="manualSleepDuration" style="text-align: center; color: var(--text-muted); font-size: 0.9rem; margin-bottom: 15px;">Duration: -- hours</div>
                            <div style="display: flex; gap: 10px;">
                                <button type="button" onclick="closeManualSleepModal()" style="flex: 1; padding: 12px; background: var(--bg-light); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; font-weight: 500;">Cancel</button>
                                <button type="submit" style="flex: 1; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">üíæ Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.innerHTML = html;
            document.body.appendChild(modal);
            
            // Auto-calculate duration
            const startInput = document.getElementById('manualSleepStart');
            const endInput = document.getElementById('manualSleepEnd');
            const durationDisplay = document.getElementById('manualSleepDuration');
            
            const updateDuration = () => {
                const start = new Date(startInput.value);
                const end = new Date(endInput.value);
                if (start && end && end > start) {
                    const hours = ((end - start) / (1000 * 60 * 60)).toFixed(1);
                    durationDisplay.textContent = `Duration: ${hours} hours`;
                    durationDisplay.style.color = hours > 16 ? '#ef4444' : 'var(--primary)';
                }
            };
            
            startInput.addEventListener('change', updateDuration);
            endInput.addEventListener('change', updateDuration);
            updateDuration();
            
            document.getElementById('manualSleepForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const start = new Date(startInput.value).getTime();
                const end = new Date(endInput.value).getTime();
                
                if (end <= start) {
                    alert('End time must be after start time!');
                    return;
                }
                
                const durationHours = (end - start) / (1000 * 60 * 60);
                
                if (durationHours > 16) {
                    if (!confirm(`Duration is ${durationHours.toFixed(1)} hours (>16h). Continue?`)) {
                        return;
                    }
                }
                
                const session = {
                    id: Date.now(),
                    start: start,
                    end: end,
                    duration: parseFloat(durationHours.toFixed(2)),
                    startFormatted: new Date(start).toLocaleString('vi-VN'),
                    endFormatted: new Date(end).toLocaleString('vi-VN'),
                    manual: true
                };
                
                sleepSessions.push(session);
                saveSleepData();
                renderSleepHistory();
                renderSleepChart();
                updateCorrelationAnalytics();
                closeManualSleepModal();
                
                showNotification(`‚úÖ Sleep session added: ${session.duration}h`, 'success');
            });
        }

        function closeManualSleepModal() {
            const modal = document.getElementById('manualSleepModal');
            if (modal) modal.remove();
        }

        // ‚úÖ EDIT SLEEP SESSION
        function editSleepSession(id) {
            const session = sleepSessions.find(s => s.id === id);
            if (!session) return;
            
            const startDate = new Date(session.start).toISOString().slice(0, 16);
            const endDate = new Date(session.end).toISOString().slice(0, 16);
            
            const html = `
                <div id="editSleepModal" style="position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 10000; backdrop-filter: blur(4px);">
                    <div style="background: var(--bg-white); border-radius: 16px; padding: 24px; max-width: 450px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: var(--text-dark);">‚úèÔ∏è Edit Sleep Session</h3>
                            <button onclick="closeEditSleepModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-muted);">&times;</button>
                        </div>
                        <form id="editSleepForm">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Sleep Start</label>
                                <input type="datetime-local" id="editSleepStart" value="${startDate}" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-light); color: var(--text-dark);">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-dark);">Sleep End</label>
                                <input type="datetime-local" id="editSleepEnd" value="${endDate}" required style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-light); color: var(--text-dark);">
                            </div>
                            <div id="editSleepDuration" style="text-align: center; color: var(--text-muted); font-size: 0.9rem; margin-bottom: 15px;">Duration: ${session.duration}h</div>
                            <div style="display: flex; gap: 10px;">
                                <button type="button" onclick="closeEditSleepModal()" style="flex: 1; padding: 12px; background: var(--bg-light); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; font-weight: 500;">Cancel</button>
                                <button type="submit" style="flex: 1; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">üíæ Update</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.innerHTML = html;
            document.body.appendChild(modal);
            
            const startInput = document.getElementById('editSleepStart');
            const endInput = document.getElementById('editSleepEnd');
            const durationDisplay = document.getElementById('editSleepDuration');
            
            const updateDuration = () => {
                const start = new Date(startInput.value);
                const end = new Date(endInput.value);
                if (start && end && end > start) {
                    const hours = ((end - start) / (1000 * 60 * 60)).toFixed(1);
                    durationDisplay.textContent = `Duration: ${hours} hours`;
                    durationDisplay.style.color = hours > 16 ? '#ef4444' : 'var(--primary)';
                }
            };
            
            startInput.addEventListener('change', updateDuration);
            endInput.addEventListener('change', updateDuration);
            
            document.getElementById('editSleepForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const start = new Date(startInput.value).getTime();
                const end = new Date(endInput.value).getTime();
                
                if (end <= start) {
                    alert('End time must be after start time!');
                    return;
                }
                
                const durationHours = (end - start) / (1000 * 60 * 60);
                
                if (durationHours > 16) {
                    if (!confirm(`Duration is ${durationHours.toFixed(1)} hours (>16h). Continue?`)) {
                        return;
                    }
                }
                
                const index = sleepSessions.findIndex(s => s.id === id);
                if (index !== -1) {
                    sleepSessions[index] = {
                        ...sleepSessions[index],
                        start: start,
                        end: end,
                        duration: parseFloat(durationHours.toFixed(2)),
                        startFormatted: new Date(start).toLocaleString('vi-VN'),
                        endFormatted: new Date(end).toLocaleString('vi-VN')
                    };
                    
                    saveSleepData();
                    renderSleepHistory();
                    renderSleepChart();
                    updateCorrelationAnalytics();
                    closeEditSleepModal();
                    
                    showNotification('‚úÖ Sleep session updated!', 'success');
                }
            });
        }

        function closeEditSleepModal() {
            const modal = document.getElementById('editSleepModal');
            if (modal) modal.remove();
        }

        // ‚úÖ DELETE SLEEP SESSION
        function deleteSleepSession(id) {
            if (confirm('üóëÔ∏è Delete this sleep session?')) {
                sleepSessions = sleepSessions.filter(s => s.id !== id);
                saveSleepData();
                renderSleepHistory();
                renderSleepChart();
                updateCorrelationAnalytics();
                showNotification('Session deleted', 'info');
            }
        }

        // ‚úÖ RENDER SLEEP HISTORY
        function renderSleepHistory() {
            const container = document.getElementById('sleepHistoryContainer');
            if (!container) return;
            
            if (sleepSessions.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px; font-style: italic;">No sleep sessions recorded yet.</div>';
                return;
            }
            
            const recentSessions = sleepSessions.slice(-10).reverse(); // Last 10, newest first
            
            container.innerHTML = recentSessions.map(session => `
                <div style="background: var(--bg-light); padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid ${session.duration > 16 ? '#ef4444' : '#3b82f6'};">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 6px;">
                        <div>
                            <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 4px;">
                                üò¥ ${session.duration} hours ${session.manual ? '(Manual)' : ''}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-muted);">
                                ${session.startFormatted} ‚Üí ${session.endFormatted}
                            </div>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            <button onclick="editSleepSession(${session.id})" style="background: none; border: 1px solid var(--border-color); padding: 4px 8px; border-radius: 6px; cursor: pointer; color: var(--text-dark); font-size: 0.85rem;">‚úèÔ∏è</button>
                            <button onclick="deleteSleepSession(${session.id})" style="background: none; border: 1px solid #ef4444; padding: 4px 8px; border-radius: 6px; cursor: pointer; color: #ef4444; font-size: 0.85rem;">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateSleepDisplay() {
            if (!isSleeping || !sleepStartTime) return;
            const now = Date.now();
            const elapsedMs = now - sleepStartTime;
            const totalSeconds = Math.floor(elapsedMs / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const display = document.getElementById('sleepTimerDisplay');
            if (display) display.textContent = formattedTime;
        }

        function updateSleepUI() {
            document.getElementById('sleepStatus').textContent = isSleeping ? "üí§ Sleeping..." : "üò¥ Ready to sleep";
            document.getElementById('sleepTimerDisplay').style.display = isSleeping ? 'block' : 'none';
            document.getElementById('startSleepBtn').style.display = isSleeping ? 'none' : 'block';
            document.getElementById('stopSleepBtn').style.display = isSleeping ? 'block' : 'none';
        }

        function saveSleepData() {
            localStorage.setItem('sleepSessions', JSON.stringify(sleepSessions));
        }

        function renderSleepChart() {
            const ctx = document.getElementById('sleepChart');
            if (!ctx) return;
            
            const recentSessions = sleepSessions.slice(-7);
            const labels = recentSessions.map(session => session.startFormatted.split(',')[0]);
            const durations = recentSessions.map(session => session.duration);
            
            if (sleepChart) {
                sleepChart.destroy();
            }
            
            sleepChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Hours Slept',
                        data: durations,
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Duration: ${context.parsed.y} hours`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Hours'
                            }
                        }
                    }
                }
            });
        }

        function loadSleepData() {
            const savedIsSleeping = localStorage.getItem('isSleeping') === 'true';
            const savedStartTime = localStorage.getItem('sleepStartTime');
            
            if (savedIsSleeping && savedStartTime) {
                isSleeping = true;
                sleepStartTime = parseInt(savedStartTime);
                updateSleepUI();
                if (sleepInterval) clearInterval(sleepInterval);
                sleepInterval = setInterval(updateSleepDisplay, 1000);
                updateSleepDisplay();
            } else {
                updateSleepUI();
            }
            
            renderSleepHistory();
            renderSleepChart();
        }




        function showBookDetails(bookId) {
            const book = readingList.find(b => b.id === parseInt(bookId));
            if (!book) {
                console.error('Book not found for details:', bookId);
                showNotification('Book not found!', 'error');
                return;
            }

            const modal = document.getElementById('bookDetailsModal');
            const titleEl = document.getElementById('bookDetailsTitle');
            const authorEl = document.getElementById('bookDetailsAuthor');
            const genreEl = document.getElementById('bookDetailsGenre');
            const statusEl = document.getElementById('bookDetailsStatus');
            const coverEl = document.getElementById('bookDetailsCover');
            const ratingEl = document.getElementById('bookDetailsRating');
            const reviewEl = document.getElementById('bookDetailsReview');

            if (modal && titleEl && authorEl && genreEl && statusEl && coverEl && ratingEl && reviewEl) {
                titleEl.textContent = book.title;
                authorEl.textContent = `by ${book.author}`;
                genreEl.textContent = book.genre;
                statusEl.textContent = getStatusText(book.status);
                statusEl.className = 'book-status-badge'; 
                statusEl.classList.add(book.status); 

                if (book.cover) {
                    coverEl.src = book.cover;
                    coverEl.alt = `${book.title} cover`;
                    coverEl.style.display = 'block';
                } else {
                    coverEl.style.display = 'none';
                }

                if (book.rating !== null && !isNaN(book.rating)) {
                    const fullStars = Math.floor(book.rating);
                    const hasHalfStar = book.rating % 1 >= 0.5;
                    let starsHTML = '';
                    for (let i = 0; i < fullStars; i++) starsHTML += '‚≠ê';
                    if (hasHalfStar) starsHTML += '‚≠ê';
                    starsHTML += ` (${book.rating.toFixed(1)})`;
                    ratingEl.innerHTML = `<strong>Rating:</strong> ${starsHTML}`;
                    ratingEl.style.display = 'block';
                } else {
                    ratingEl.style.display = 'none';
                }

                if (book.review) {
                    reviewEl.innerHTML = `<strong>Review:</strong> ${escapeHtml(book.review).replace(/\n/g, '<br> ')}`;
                    reviewEl.style.display = 'block';
                } else {
                    reviewEl.style.display = 'none';
                }

                modal.style.display = 'flex';
            } else {
                console.error('Book details modal elements not found');
                alert(`Details for "${book.title}":\nAuthor: ${book.author}\nGenre: ${book.genre}\nStatus: ${getStatusText(book.status)}\nRating: ${book.rating || 'N/A'}\nReview: ${book.review || 'N/A'}`);
            }
        }


        function closeBookDetailsModal() {
            const modal = document.getElementById('bookDetailsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }


        function autoBackup() {
            try {
                const backupData = {
                    studyHours,
                    gamification,
                    readingList,
                    courses,
                    goals,
                    dailyStudyData,
                    sessionLogs,
                    timestamp: new Date().toISOString(),
                    version: "2.0"
                };
                
                const dataStr = JSON.stringify(backupData);
                const dataSize = new Blob([dataStr]).size;

                if (dataSize > 4 * 1024 * 1024) { 
                    console.warn('D·ªØ li·ªáu sao l∆∞u s·∫Øp ƒë·∫°t gi·ªõi h·∫°n localStorage');
                    showNotification('‚ö†Ô∏è Dung l∆∞·ª£ng l∆∞u tr·ªØ g·∫ßn ƒë·∫ßy. H√£y c√¢n nh·∫Øc xu·∫•t d·ªØ li·ªáu.', 'warning');
                }               
                localStorage.setItem('autoBackup', dataStr);
                const backups = JSON.parse(localStorage.getItem('backupHistory') || '[]');
                backups.unshift(backupData);
                if (backups.length > 3) backups.splice(3); 
                localStorage.setItem('backupHistory', JSON.stringify(backups));
                console.log('‚úÖ Sao l∆∞u t·ª± ƒë·ªông th√†nh c√¥ng');                
            } catch (e) {
                console.error('‚ùå Sao l∆∞u th·∫•t b·∫°i:', e);
                showNotification('Sao l∆∞u th·∫•t b·∫°i! H√£y xu·∫•t d·ªØ li·ªáu c·ªßa b·∫°n ngay b√¢y gi·ªù.', 'error');
            }
        }

        function triggerBackup() {
            clearTimeout(window.backupTimeout);
            window.backupTimeout = setTimeout(autoBackup, 5000); 
        }

        // --- K√çCH HO·∫†T SAO L∆ØU ƒê·ªäNH K·ª≤ ---
        setInterval(autoBackup, 30 * 60 * 1000); 


        // Goal Type Selection Handler
        function selectGoalType(type) {
            document.querySelectorAll('.goal-type-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            const selectedOption = document.querySelector(`[data-type="${type}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
            document.getElementById('goalType').value = type;
            populateGoalTypeSpecificFields(type);
        }


        // --- CORRELATION ANALYTICS SYSTEM ---
        // Calculate Pearson correlation coefficient
        function calculateCorrelation(x, y) {
            if (x.length !== y.length || x.length === 0) return 0;
            
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);
            
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            if (denominator === 0) return 0;
            return numerator / denominator;
        }

        // Get correlation strength label
        function getCorrelationStrength(r) {
            const abs = Math.abs(r);
            if (abs >= 0.7) return 'strong';
            if (abs >= 0.4) return 'moderate';
            return 'weak';
        }

        // Get correlation interpretation
        function interpretCorrelation(r, xLabel, yLabel) {
            const abs = Math.abs(r);
            const direction = r > 0 ? 'positive' : 'negative';
            const strength = getCorrelationStrength(r);
            
            if (abs < 0.2) {
                return `Almost no relationship between ${xLabel} and ${yLabel}.`;
            } else if (abs < 0.4) {
                return `Weak ${direction} correlation. ${xLabel} has minor impact on ${yLabel}.`;
            } else if (abs < 0.7) {
                return `Moderate ${direction} correlation. ${xLabel} influences ${yLabel} noticeably.`;
            } else {
                return `Strong ${direction} correlation! ${xLabel} significantly affects ${yLabel}.`;
            }
        }

        // Calculate daily study productivity (hours per day)
        function calculateDailyProductivity() {
            const data = [];
            const sortedDates = Object.keys(dailyStudyData).sort();
            
            sortedDates.forEach(date => {
                const hours = dailyStudyData[date] || 0;
                data.push({
                    date: date,
                    hours: hours
                });
            });
            
            return data;
        }


        // Calculate sleep vs study correlation
        function calculateSleepStudyCorrelation() {
            const sleepData = [];
            const studyData = [];
            const sleepByDate = {};
            
            // ‚úÖ FIX: Group sleep by DATE (not by timestamp)
            sleepSessions.forEach(session => {
                const dateKey = new Date(session.start).toDateString();
                if (!sleepByDate[dateKey]) sleepByDate[dateKey] = 0;
                sleepByDate[dateKey] += session.duration;
            });
            
            // Match with study data
            Object.keys(dailyStudyData).forEach(dateKey => {
                if (sleepByDate[dateKey]) {
                    sleepData.push(sleepByDate[dateKey]);
                    studyData.push(dailyStudyData[dateKey]);
                }
            });
            
            // ‚úÖ DEBUG: Log data
            console.log('Sleep data:', sleepData);
            console.log('Study data:', studyData);
            console.log('Matched days:', sleepData.length);
            
            if (sleepData.length < 3) {
                console.warn('Not enough data for correlation (need 3+ days)');
                return null;
            }
            
            return {
                correlation: calculateCorrelation(sleepData, studyData),
                data: sleepData.map((sleep, i) => ({
                    sleep: sleep,
                    study: studyData[i]
                }))
            };
        }





        // Calculate skill progress vs goal completion
        function calculateSkillGoalCorrelation() {
            const skillProgress = [];
            const goalCompletion = [];
            
            const careerData = skillsData[currentCareer];
            if (!careerData) return null;
            
            // Get skill completion percentages
            Object.values(careerData.categories).forEach(category => {
                category.skills.forEach(skill => {
                    const completion = getSkillCompletion(currentCareer, skill.name);
                    skillProgress.push(completion.percent);
                });
            });
            
            // Get goal completion percentages
            const careerGoals = goals.filter(g => g.career === currentCareer);
            careerGoals.forEach(goal => {
                const percent = getGoalProgressPercent(goal);
                goalCompletion.push(percent);
            });
            
            // Match length (use minimum)
            const minLength = Math.min(skillProgress.length, goalCompletion.length);
            if (minLength < 3) return null;
            
            return {
                correlation: calculateCorrelation(
                    skillProgress.slice(0, minLength),
                    goalCompletion.slice(0, minLength)
                ),
                data: skillProgress.slice(0, minLength).map((skill, i) => ({
                    skill: skill,
                    goal: goalCompletion[i]
                }))
            };
        }

        // Render correlation insights
        function renderCorrelationInsights() {
            const container = document.getElementById('correlationInsights');
            if (!container) return;
            
            const sleepStudy = calculateSleepStudyCorrelation();
            const skillGoal = calculateSkillGoalCorrelation();
            
            let html = '';
            
            // Sleep vs Study insight
            if (sleepStudy && sleepStudy.data.length >= 3) {
                const r = sleepStudy.correlation;
                const strength = getCorrelationStrength(r);
                const avgSleep = (sleepStudy.data.reduce((sum, d) => sum + d.sleep, 0) / sleepStudy.data.length).toFixed(1);
                
                html += `
                    <div class="insight-card">
                        <div class="insight-label">üò¥ Sleep ‚Üî Study Correlation</div>
                        <div class="insight-value">
                            r = ${r.toFixed(3)}
                            <span class="correlation-strength ${strength}">${strength}</span>
                        </div>
                        <div class="insight-description">
                            ${interpretCorrelation(r, 'Sleep hours', 'study productivity')}<br>
                            <strong>Avg sleep:</strong> ${avgSleep}h
                        </div>
                    </div>
                `;
            }
            
            // Skill vs Goal insight
            if (skillGoal && skillGoal.data.length >= 3) {
                const r = skillGoal.correlation;
                const strength = getCorrelationStrength(r);
                const avgSkill = (skillGoal.data.reduce((sum, d) => sum + d.skill, 0) / skillGoal.data.length).toFixed(1);
                
                html += `
                    <div class="insight-card">
                        <div class="insight-label">üéØ Skills ‚Üî Goals Correlation</div>
                        <div class="insight-value">
                            r = ${r.toFixed(3)}
                            <span class="correlation-strength ${strength}">${strength}</span>
                        </div>
                        <div class="insight-description">
                            ${interpretCorrelation(r, 'Skill mastery', 'goal completion')}<br>
                            <strong>Avg skill progress:</strong> ${avgSkill}%
                        </div>
                    </div>
                `;
            }
            
            // Overall productivity insight
            const totalHours = Object.values(dailyStudyData).reduce((sum, h) => sum + h, 0);
            const daysTracked = Object.keys(dailyStudyData).length;
            const avgDaily = daysTracked > 0 ? (totalHours / daysTracked).toFixed(1) : 0;
            
            html += `
                <div class="insight-card">
                    <div class="insight-label">üìà Overall Productivity</div>
                    <div class="insight-value">${avgDaily}h/day</div>
                    <div class="insight-description">
                        Average daily study time over ${daysTracked} days tracked.<br>
                        <strong>Total:</strong> ${totalHours.toFixed(1)} hours
                    </div>
                </div>
            `;
            
            if (html === '') {
                html = '<div class="no-data-message">Not enough data yet. Keep tracking to see correlations!</div>';
            }
            
            container.innerHTML = html;
        }

        // Render sleep vs study scatter plot
        let sleepStudyChart = null;
        function renderSleepStudyChart() {
            const ctx = document.getElementById('sleepStudyChart');
            if (!ctx) return;
            
            const data = calculateSleepStudyCorrelation();
            
            if (sleepStudyChart) {
                sleepStudyChart.destroy();
            }
            
            if (!data || data.data.length < 3) {
                const parent = ctx.parentElement;
                parent.innerHTML = '<div class="no-data-message">Need at least 3 days with both sleep & study data</div>';
                return;
            }
            
            const scatterData = data.data.map(d => ({ x: d.sleep, y: d.study }));
            
            sleepStudyChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Sleep vs Study',
                        data: scatterData,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Sleep: ${context.parsed.x.toFixed(1)}h, Study: ${context.parsed.y.toFixed(1)}h`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: `Correlation: r = ${data.correlation.toFixed(3)}`,
                            font: {
                                size: 14,
                                weight: 'bold'
                            },
                            color: 'var(--text-dark)'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Sleep Hours',
                                color: 'var(--text-dark)'
                            },
                            ticks: {
                                color: 'var(--text-muted)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Study Hours',
                                color: 'var(--text-dark)'
                            },
                            ticks: {
                                color: 'var(--text-muted)'
                            }
                        }
                    }
                }
            });
        }


        let skillGoalChart = null;
        function renderSkillGoalChart() {
            const ctx = document.getElementById('skillGoalChart');
            if (!ctx) return;
            
            const data = calculateSkillGoalCorrelation();
            
            if (skillGoalChart) {
                skillGoalChart.destroy();
            }
            
            if (!data || data.data.length < 3) {
                const parent = ctx.parentElement;
                parent.innerHTML = '<div class="no-data-message">Need at least 3 skills and goals to analyze</div>';
                return;
            }
            
            const scatterData = data.data.map(d => ({ x: d.skill, y: d.goal }));
            
            skillGoalChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Skill vs Goal',
                        data: scatterData,
                        backgroundColor: 'rgba(16, 185, 129, 0.6)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Skill: ${context.parsed.x.toFixed(1)}%, Goal: ${context.parsed.y.toFixed(1)}%`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: `Correlation: r = ${data.correlation.toFixed(3)}`,
                            font: {
                                size: 14,
                                weight: 'bold'
                            },
                            color: 'var(--text-dark)'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Skill Progress (%)',
                                color: 'var(--text-dark)'
                            },
                            ticks: {
                                color: 'var(--text-muted)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Goal Completion (%)',
                                color: 'var(--text-dark)'
                            },
                            ticks: {
                                color: 'var(--text-muted)'
                            }
                        }
                    }
                }
            });
        }

        function updateCorrelationAnalytics() {
            renderCorrelationInsights();
            renderSleepStudyChart();
            renderSkillGoalChart();
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateCorrelationAnalytics();

            const darkModeToggle = document.querySelector('.dark-mode-toggle');
            if (darkModeToggle) {
                darkModeToggle.addEventListener('click', function() {
                    setTimeout(updateCorrelationAnalytics, 100);
                });
            }
        });


        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateCorrelationAnalytics();
            }, 500); 

            const darkModeToggle = document.querySelector('.dark-mode-toggle');
            if (darkModeToggle) {
                darkModeToggle.addEventListener('click', function() {
                    setTimeout(updateCorrelationAnalytics, 100);
                });
            }
        });

        const originalAddStudyTime = addStudyTime;
        addStudyTime = function(...args) {
            originalAddStudyTime(...args);
            updateCorrelationAnalytics();
        };

        const originalStopSleepTracking = stopSleepTracking;
        stopSleepTracking = function() {
            originalStopSleepTracking();
            updateCorrelationAnalytics();
        };


        // ===== LOAD INVESTMENT ANALYSIS DATA =====
        investmentAnalyses = JSON.parse(localStorage.getItem('investmentAnalyses')) || [];

        // ===== SCHEMA =====
        const analysisSchema = {
            id: Date.now(),
            title: "",
            type: "", 
            date: "",
            thesis: "",
            tags: [],
            keyMetrics: {
                currentPrice: "",
                targetPrice: "",
                upside: "",
                peRatio: "",
                recommendation: ""
            },
            links: {
                pitchDeck: "",
                excelModel: "",
                notes: ""
            },
            createdAt: new Date().toISOString()
        };

        // ===== RENDER ANALYSIS CARDS =====
        function renderAnalysisCards(analyses = investmentAnalyses) {
            const container = document.getElementById('analysisCardsContainer');
            const countElement = document.getElementById('analysisCount');
            
            countElement.textContent = analyses.length;
            
            if (analyses.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px;">No analyses yet. Add your first one!</div>';
                return;
            }
            
            container.innerHTML = analyses
                .sort((a, b) => new Date(b.date) - new Date(a.date)) 
                .map(analysis => renderAnalysisCard(analysis))
                .join('');
        }



        function renderAnalysisCard(analysis) {
            // Color & Icon mapping remains the same
            const typeIcons = {
                stock_pitch: "üìä",
                lbo: "üí∞",
                dcf: "üìà",
                ma: "ü§ù",
                industry: "üìë"
            };
            const typeColors = {
                stock_pitch: '#10b981',
                lbo: '#f59e0b',
                dcf: '#8b5cf6',
                ma: '#ef4444',
                industry: '#06b6d4'
            };
            const cardColor = typeColors[analysis.type] || '#3b82f6';

            // Recommendation badge
            const recommendationBadge = analysis.keyMetrics?.recommendation ? `
                <span class="tag" style="background: ${analysis.keyMetrics.recommendation === 'BUY' ? 'rgba(16, 185, 129, 0.2)' : analysis.keyMetrics.recommendation === 'SELL' ? 'rgba(239, 68, 68, 0.2)' : 'rgba(245, 158, 11, 0.2)'}; color: ${analysis.keyMetrics.recommendation === 'BUY' ? '#10b981' : analysis.keyMetrics.recommendation === 'SELL' ? '#ef4444' : '#f59e0b'};">
                    ${analysis.keyMetrics.recommendation}
                </span>
            ` : '';

            // Tags
            const tagsHTML = analysis.tags && analysis.tags.length > 0 ? `
                <div class="finance-card-tags">
                    ${analysis.tags.map(tag => `<span class="tag" style="background: rgba(${parseInt(cardColor.slice(1,3), 16)}, ${parseInt(cardColor.slice(3,5), 16)}, ${parseInt(cardColor.slice(5,7), 16)}, 0.15); color: ${cardColor};">${tag}</span>`).join('')}
                </div>
            ` : '';

            // Key Metrics
            let metricsHTML = '';
            const km = analysis.keyMetrics || {};
            if (km.currentPrice || km.targetPrice || km.upside || km.peRatio) {
                metricsHTML = `
                    <div class="finance-card-metrics">
                        ${km.currentPrice ? `<div class="metric-item"><span class="metric-label">Current</span><span class="metric-value">${km.currentPrice}</span></div>` : ''}
                        ${km.targetPrice ? `<div class="metric-item"><span class="metric-label">Target</span><span class="metric-value">${km.targetPrice}</span></div>` : ''}
                        ${km.upside ? `<div class="metric-item"><span class="metric-label">Upside</span><span class="metric-value" style="color: ${km.upside.includes('-') ? '#ef4444' : '#10b981'};">${km.upside}</span></div>` : ''}
                        ${km.peRatio ? `<div class="metric-item"><span class="metric-label">P/E</span><span class="metric-value">${km.peRatio}</span></div>` : ''}
                    </div>
                `;
            }

            // Links
            const linksHTML = (analysis.links.pitchDeck || analysis.links.excelModel || analysis.links.notes) ? `
                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px;">
                    ${analysis.links.pitchDeck ? `<a href="${analysis.links.pitchDeck}" target="_blank" class="course-action-btn open-link" style="flex: 1; text-align: center; text-decoration: none; padding: 4px 8px; font-size: 0.75rem;">üìë Pitch Deck</a>` : ''}
                    ${analysis.links.excelModel ? `<a href="${analysis.links.excelModel}" target="_blank" class="course-action-btn open-link" style="flex: 1; text-align: center; text-decoration: none; padding: 4px 8px; font-size: 0.75rem;">üìä Excel Model</a>` : ''}
                    ${analysis.links.notes ? `<a href="${analysis.links.notes}" target="_blank" class="course-action-btn open-link" style="flex: 1; text-align: center; text-decoration: none; padding: 4px 8px; font-size: 0.75rem;">üìù Notes</a>` : ''}
                </div>
            ` : '';

            return `
                <div class="finance-card" style="border-left: 4px solid ${cardColor};">
                    <div class="finance-card-header">
                        <div>
                            <div class="finance-card-title">${analysis.title}</div>
                            <div style="font-size: 0.85rem; color: var(--text-muted); display: flex; align-items: center; gap: 6px; margin-top: 4px;">
                                ${typeIcons[analysis.type]} ${formatDate(analysis.date)}
                            </div>
                        </div>
                        ${recommendationBadge}
                    </div>
                    <div class="finance-card-content">
                        <div class="finance-card-thesis">"${analysis.thesis}"</div>
                        ${metricsHTML}
                        ${tagsHTML}
                        ${linksHTML}
                    </div>
                    <div class="finance-card-actions">
                        <button onclick="editAnalysis('${analysis.id}')" class="course-action-btn edit">‚úèÔ∏è Edit</button>
                        <button onclick="deleteAnalysis('${analysis.id}')" class="course-action-btn delete">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `;
        }


        let saveQueue = [];
        let saveTimeout = null;
        function queueSave(key, data) {
            saveQueue.push({ key, data });
            if (saveTimeout) clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveQueue.forEach(({ key, data }) => {
                    localStorage.setItem(key, JSON.stringify(data));
                });
                saveQueue = [];
            }, 500); // Batch save sau 500ms
        }
        // Use: queueSave('studyHours', studyHours);


        // ===== MODAL FUNCTIONS =====
        function openAnalysisModal(analysisId = null) {
            const modal = document.getElementById('analysisModal');
            const form = document.getElementById('analysisForm');
            const title = document.getElementById('analysisModalTitle');
            const idInput = document.getElementById('analysisId');
            
            if (analysisId) {
                // Edit mode
                const analysis = investmentAnalyses.find(a => a.id == analysisId);
                if (analysis) {
                    title.textContent = 'Edit Investment Analysis';
                    idInput.value = analysis.id;
                    document.getElementById('analysisTitle').value = analysis.title;
                    document.getElementById('analysisType').value = analysis.type;
                    document.getElementById('analysisDate').value = analysis.date;
                    document.getElementById('analysisThesis').value = analysis.thesis;
                    document.getElementById('analysisTags').value = analysis.tags ? analysis.tags.join(', ') : '';
                    
                    // Populate Key Metrics
                    document.getElementById('currentPrice').value = analysis.keyMetrics?.currentPrice || '';
                    document.getElementById('targetPrice').value = analysis.keyMetrics?.targetPrice || '';
                    document.getElementById('upside').value = analysis.keyMetrics?.upside || '';
                    document.getElementById('peRatio').value = analysis.keyMetrics?.peRatio || '';
                    document.getElementById('recommendation').value = analysis.keyMetrics?.recommendation || '';
                    
                    // Populate Links
                    document.getElementById('pitchDeckLink').value = analysis.links?.pitchDeck || '';
                    document.getElementById('excelModelLink').value = analysis.links?.excelModel || '';
                    document.getElementById('notesLink').value = analysis.links?.notes || '';
                }
            } else {
                // Add mode
                title.textContent = 'Add New Investment Analysis';
                form.reset();
                idInput.value = '';
                document.getElementById('analysisDate').value = new Date().toISOString().split('T')[0]; 
            }
            
            modal.style.display = 'block';
        }

        function closeAnalysisModal() {
            document.getElementById('analysisModal').style.display = 'none';
        }

        // ===== FORM HANDLING =====
        document.getElementById('analysisForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('analysisId').value;
            const isNew = !id;
            
            const analysis = {
                id: isNew ? Date.now().toString() : id,
                title: document.getElementById('analysisTitle').value,
                type: document.getElementById('analysisType').value,
                date: document.getElementById('analysisDate').value,
                thesis: document.getElementById('analysisThesis').value,
                tags: document.getElementById('analysisTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                keyMetrics: {
                    currentPrice: document.getElementById('currentPrice').value,
                    targetPrice: document.getElementById('targetPrice').value,
                    upside: document.getElementById('upside').value,
                    peRatio: document.getElementById('peRatio').value,
                    recommendation: document.getElementById('recommendation').value
                },
                links: {
                    pitchDeck: document.getElementById('pitchDeckLink').value,
                    excelModel: document.getElementById('excelModelLink').value,
                    notes: document.getElementById('notesLink').value
                },
                createdAt: isNew ? new Date().toISOString() : investmentAnalyses.find(a => a.id == id)?.createdAt
            };
            
            if (isNew) {
                investmentAnalyses.push(analysis);
            } else {
                const index = investmentAnalyses.findIndex(a => a.id == id);
                if (index !== -1) investmentAnalyses[index] = analysis;
            }
            
            saveAnalyses();
            renderAnalysisCards();
            closeAnalysisModal();
        });

        // ===== CRUD OPERATIONS =====
        function saveAnalyses() {
            localStorage.setItem('investmentAnalyses', JSON.stringify(investmentAnalyses));
        }

        function editAnalysis(id) {
            openAnalysisModal(id);
        }

        function deleteAnalysis(id) {
            if (confirm('Are you sure you want to delete this analysis?')) {
                investmentAnalyses = investmentAnalyses.filter(a => a.id != id);
                saveAnalyses();
                renderAnalysisCards();
            }
        }

        // ===== FILTERING =====
        function filterAnalyses() {
            const filterType = document.getElementById('analysisTypeFilter').value;
            if (filterType === 'all') {
                renderAnalysisCards();
            } else {
                const filtered = investmentAnalyses.filter(a => a.type === filterType);
                renderAnalysisCards(filtered);
            }
        }

        // ===== UTILITY =====
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            renderAnalysisCards();
        });


        // ===== LOAD DEAL DIARY DATA =====
        dealDiary = JSON.parse(localStorage.getItem('dealDiary')) || [];
        
        // ===== DEAL SCHEMA =====
        const dealSchema = {
            id: Date.now(),
            dealName: "",
            dealType: "", 
            dealValue: "",
            status: "closed",
            date: "",
            parties: {
                buyer: "",
                target: ""
            },
            learnings: "",
            links: {
                pressRelease: "",
                analysis: "",
                filing: ""
            },
            createdAt: new Date().toISOString()
        };

        // ===== RENDER DEAL CARDS =====
        function renderDealCards(deals = dealDiary) {
            const container = document.getElementById('dealCardsContainer');
            const countElement = document.getElementById('dealCount');
            
            countElement.textContent = deals.length;
            
            if (deals.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px;">No deals tracked yet. Add your first one!</div>';
                return;
            }
            
            container.innerHTML = deals
                .sort((a, b) => new Date(b.date) - new Date(a.date)) 
                .map(deal => renderDealCard(deal))
                .join('');
        }





        function renderDealCard(deal) {
            // Color & Icon mapping remains the same
            const typeIcons = {
                'M&A': 'ü§ù',
                'LBO': 'üí∞',
                'IPO': 'üöÄ',
                'Restructuring': 'üîÑ'
            };
            const typeColors = {
                'M&A': '#ef4444',
                'LBO': '#f59e0b',
                'IPO': '#10b981',
                'Restructuring': '#6366f1'
            };
            const cardColor = typeColors[deal.dealType] || '#8b5cf6';

            // Status badge
            const statusBadges = {
                'closed': '<span class="tag" style="background: rgba(16, 185, 129, 0.2); color: #10b981;">‚úÖ Closed</span>',
                'announced': '<span class="tag" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6;">üì¢ Announced</span>',
                'rumored': '<span class="tag" style="background: rgba(245, 158, 11, 0.2); color: #f59e0b;">üîç Rumored</span>',
                'terminated': '<span class="tag" style="background: rgba(239, 68, 68, 0.2); color: #ef4444;">‚ùå Terminated</span>'
            };

            // Parties
            const partiesHTML = (deal.parties?.buyer || deal.parties?.target) ? `
                <div class="finance-card-metrics">
                    <div class="metric-item"><span class="metric-label">Buyer</span><span class="metric-value">${deal.parties?.buyer || 'N/A'}</span></div>
                    <div class="metric-item"><span class="metric-label">Target</span><span class="metric-value">${deal.parties?.target || 'N/A'}</span></div>
                </div>
            ` : '';

            // Deal Value
            const valueHTML = deal.dealValue ? `<div class="finance-card-metrics"><div class="metric-item"><span class="metric-label">Deal Value</span><span class="metric-value">${deal.dealValue}</span></div></div>` : '';

            // Links
            const linksHTML = (deal.links.pressRelease || deal.links.analysis || deal.links.filing) ? `
                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px;">
                    ${deal.links.pressRelease ? `<a href="${deal.links.pressRelease}" target="_blank" class="course-action-btn open-link" style="flex: 1; text-align: center; text-decoration: none; padding: 4px 8px; font-size: 0.75rem;">üìÑ Press</a>` : ''}
                    ${deal.links.analysis ? `<a href="${deal.links.analysis}" target="_blank" class="course-action-btn open-link" style="flex: 1; text-align: center; text-decoration: none; padding: 4px 8px; font-size: 0.75rem;">üìä Analysis</a>` : ''}
                    ${deal.links.filing ? `<a href="${deal.links.filing}" target="_blank" class="course-action-btn open-link" style="flex: 1; text-align: center; text-decoration: none; padding: 4px 8px; font-size: 0.75rem;">üìã Filing</a>` : ''}
                </div>
            ` : '';

            return `
                <div class="finance-card" style="border-left: 4px solid ${cardColor};">
                    <div class="finance-card-header">
                        <div>
                            <div class="finance-card-title">${deal.dealName}</div>
                            <div style="font-size: 0.85rem; color: var(--text-muted); display: flex; align-items: center; gap: 6px; margin-top: 4px;">
                                ${typeIcons[deal.dealType]} ${formatDate(deal.date)}
                            </div>
                        </div>
                        ${statusBadges[deal.status]}
                    </div>
                    <div class="finance-card-content">
                        ${valueHTML}
                        ${partiesHTML}
                        <div class="finance-card-learnings">
                            <strong>Key Learning:</strong> ${deal.learnings}
                        </div>
                        ${linksHTML}
                    </div>
                    <div class="finance-card-actions">
                        <button onclick="editDeal('${deal.id}')" class="course-action-btn edit">‚úèÔ∏è Edit</button>
                        <button onclick="deleteDeal('${deal.id}')" class="course-action-btn delete">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `;
        }




        // ===== DEAL MODAL FUNCTIONS =====
        function openDealModal(dealId = null) {
            const modal = document.getElementById('dealModal');
            const form = document.getElementById('dealForm');
            const title = document.getElementById('dealModalTitle');
            const idInput = document.getElementById('dealId');
            
            if (dealId) {
                const deal = dealDiary.find(d => d.id == dealId);
                if (deal) {
                    title.textContent = 'Edit Deal';
                    idInput.value = deal.id;
                    document.getElementById('dealName').value = deal.dealName;
                    document.getElementById('dealType').value = deal.dealType;
                    document.getElementById('dealValue').value = deal.dealValue;
                    document.getElementById('dealStatus').value = deal.status;
                    document.getElementById('dealDate').value = deal.date;
                    document.getElementById('dealBuyer').value = deal.parties?.buyer || '';
                    document.getElementById('dealTarget').value = deal.parties?.target || '';
                    document.getElementById('dealLearnings').value = deal.learnings;
                    document.getElementById('pressReleaseLink').value = deal.links?.pressRelease || '';
                    document.getElementById('analysisLink').value = deal.links?.analysis || '';
                    document.getElementById('filingLink').value = deal.links?.filing || '';
                }
            } else {
                title.textContent = 'Add New Deal';
                form.reset();
                idInput.value = '';
                document.getElementById('dealDate').value = new Date().toISOString().split('T')[0]; 
            }
            
            modal.style.display = 'block';
        }

        function closeDealModal() {
            document.getElementById('dealModal').style.display = 'none';
        }

        // ===== DEAL FORM HANDLING =====
        document.getElementById('dealForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('dealId').value;
            const isNew = !id;
            
            const deal = {
                id: isNew ? Date.now().toString() : id,
                dealName: document.getElementById('dealName').value,
                dealType: document.getElementById('dealType').value,
                dealValue: document.getElementById('dealValue').value,
                status: document.getElementById('dealStatus').value,
                date: document.getElementById('dealDate').value,
                parties: {
                    buyer: document.getElementById('dealBuyer').value,
                    target: document.getElementById('dealTarget').value
                },
                learnings: document.getElementById('dealLearnings').value,
                links: {
                    pressRelease: document.getElementById('pressReleaseLink').value,
                    analysis: document.getElementById('analysisLink').value,
                    filing: document.getElementById('filingLink').value
                },
                createdAt: isNew ? new Date().toISOString() : dealDiary.find(d => d.id == id)?.createdAt
            };
            
            if (isNew) {
                dealDiary.push(deal);
            } else {
                const index = dealDiary.findIndex(d => d.id == id);
                if (index !== -1) dealDiary[index] = deal;
            }
            
            saveDeals();
            renderDealCards();
            closeDealModal();
        });

        // ===== DEAL CRUD OPERATIONS =====
        function saveDeals() {
            localStorage.setItem('dealDiary', JSON.stringify(dealDiary));
        }

        function editDeal(id) {
            openDealModal(id);
        }

        function deleteDeal(id) {
            if (confirm('Are you sure you want to delete this deal?')) {
                dealDiary = dealDiary.filter(d => d.id != id);
                saveDeals();
                renderDealCards();
            }
        }

        // ===== DEAL FILTERING =====
        function filterDeals() {
            const filterType = document.getElementById('dealTypeFilter').value;
            if (filterType === 'all') {
                renderDealCards();
            } else {
                const filtered = dealDiary.filter(d => d.dealType === filterType);
                renderDealCards(filtered);
            }
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            renderDealCards();
        });

        function showFullReview(reviewText, bookTitle) {
            const modal = document.getElementById('fullReviewModal');
            if (!modal) {
                alert(`Review for "${bookTitle}":\n\n${reviewText}`);
                return;
            }
            
            document.getElementById('fullReviewTitle').textContent = `Review: ${bookTitle}`;
            document.getElementById('fullReviewText').textContent = reviewText;
            modal.style.display = 'flex';
        }

        function closeFullReviewModal() {
            const modal = document.getElementById('fullReviewModal');
            if (modal) modal.style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                updateChartColors();
                if (sleepChart) {
                    const textColor = '#cbd5e1';
                    sleepChart.options.scales.y.ticks.color = textColor;
                    sleepChart.options.scales.x.ticks.color = textColor;
                    sleepChart.update();
                }
                if (dailyStudyChart) {
                    const textColor = '#cbd5e1';
                    dailyStudyChart.options.scales.y.ticks.color = textColor;
                    dailyStudyChart.options.scales.x.ticks.color = textColor;
                    dailyStudyChart.update();
                }
            }
        });


        // ‚úÖ Open Archived Goals Modal
        function openArchivedGoalsModal() {
            document.getElementById('archivedGoalsModal').style.display = 'flex';
            renderArchivedGoals();
        }

        // ‚úÖ Close Archived Goals Modal
        function closeArchivedGoalsModal() {
            document.getElementById('archivedGoalsModal').style.display = 'none';
        }

        // ‚úÖ Render Archived Goals
        function renderArchivedGoals() {
            const container = document.getElementById('archivedGoalsContainer');
            const careerFilter = document.getElementById('archiveCareerFilter').value;
            
            if (!container) return;
            
            let filteredArchived = archivedGoals;
            
            if (careerFilter !== 'all') {
                filteredArchived = archivedGoals.filter(g => g.career === careerFilter);
            }
            
            if (filteredArchived.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
                        <div style="font-size: 4rem; margin-bottom: 15px; opacity: 0.3;">üì¶</div>
                        <h3 style="margin: 0 0 8px 0; color: var(--text-dark);">No Archived Goals</h3>
                        <p style="margin: 0; font-size: 0.95rem;">
                            ${careerFilter === 'all' ? 'Complete some goals to see them here!' : 'No archived goals for this career yet.'}
                        </p>
                    </div>
                `;
                return;
            }
            
            // Sort by archived date (newest first)
            filteredArchived.sort((a, b) => new Date(b.archivedAt) - new Date(a.archivedAt));
            
            // Group by month
            const groupedByMonth = {};
            filteredArchived.forEach(goal => {
                const date = new Date(goal.archivedAt);
                const monthKey = date.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                
                if (!groupedByMonth[monthKey]) {
                    groupedByMonth[monthKey] = [];
                }
                groupedByMonth[monthKey].push(goal);
            });
            
            let html = `
                <div style="margin-bottom: 20px; padding: 16px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border-left: 4px solid #10b981;">
                    <div style="font-size: 1.1rem; font-weight: 600; color: #10b981; margin-bottom: 8px;">
                        üéâ Total Achievements
                    </div>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 150px;">
                            <div style="font-size: 0.85rem; color: var(--text-muted);">Total Archived</div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #10b981;">${filteredArchived.length}</div>
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <div style="font-size: 0.85rem; color: var(--text-muted);">Total Hours Completed</div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #10b981;">
                                ${filteredArchived.reduce((sum, g) => sum + (g.target || 0), 0).toFixed(0)}h
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Render each month group
            Object.entries(groupedByMonth).forEach(([month, goals]) => {
                html += `
                    <div style="margin-bottom: 30px;">
                        <div style="font-size: 1.2rem; font-weight: 700; color: var(--text-dark); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--border-color); display: flex; align-items: center; gap: 10px;">
                            üìÖ ${month}
                            <span style="font-size: 0.85rem; font-weight: 500; color: var(--text-muted);">(${goals.length} goals)</span>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            ${goals.map(goal => renderArchivedGoalCard(goal)).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ‚úÖ Render Single Archived Goal Card
        function renderArchivedGoalCard(goal) {
            const typeIcons = {
                study_hours: 'üìö',
                skill_mastery: 'üéØ',
                custom: '‚úÖ'
            };
            
            const careerColors = {
                pe: '#e74c3c', ib: '#3498db', hf: '#f39c12', sc: '#2ecc71',
                fintech: '#00ffef', english: '#fbe82c', chinese: '#00ffd2',
                tools: '#ff1265', cfa1: '#00ff82'
            };
            
            const careerColor = careerColors[goal.career] || '#3b82f6';
            const archivedDate = new Date(goal.archivedAt).toLocaleDateString('en-US', { 
                year: 'numeric', month: 'short', day: 'numeric' 
            });
            
            return `
                <div style="background: var(--bg-white); border-radius: 12px; padding: 20px; border-left: 4px solid ${careerColor}; box-shadow: var(--shadow-sm); transition: all 0.3s ease;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; flex-wrap: wrap; gap: 10px;">
                        <div style="flex: 1; min-width: 200px;">
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--text-dark); margin-bottom: 6px; display: flex; align-items: center; gap: 8px;">
                                ${typeIcons[goal.type] || 'üìå'} ${goal.title}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-muted); display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                                <span style="background: ${careerColor}; color: white; padding: 3px 10px; border-radius: 12px; font-weight: 600; font-size: 0.75rem;">
                                    ${skillsData[goal.career]?.title || goal.career}
                                </span>
                                <span>‚Ä¢</span>
                                <span>Completed: ${archivedDate}</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 8px;">
                            <button onclick="restoreArchivedGoal('${goal.id}')" style="padding: 6px 12px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500;">
                                ‚Ü©Ô∏è Restore
                            </button>
                            <button onclick="permanentlyDeleteArchivedGoal('${goal.id}')" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500;">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; font-size: 0.9rem; color: var(--text-muted); flex-wrap: wrap;">
                        <span><strong>Target:</strong> ${goal.target} ${goal.type === 'custom' ? 'items' : 'hours'}</span>
                        ${goal.skillName ? `<span>‚Ä¢ <strong>Skill:</strong> ${goal.skillName}</span>` : ''}
                        ${goal.deadline ? `<span>‚Ä¢ <strong>Deadline was:</strong> ${formatDate(goal.deadline)}</span>` : ''}
                    </div>
                </div>
            `;
        }

        // ‚úÖ Restore Archived Goal
        function restoreArchivedGoal(goalId) {
            const goal = archivedGoals.find(g => g.id === goalId);
            if (!goal) return;
            
            if (confirm(`‚Ü©Ô∏è Restore "${goal.title}" back to active goals?`)) {
                // Remove from archived
                archivedGoals = archivedGoals.filter(g => g.id !== goalId);
                
                // Add back to active goals (remove archivedAt timestamp)
                const restoredGoal = { ...goal };
                delete restoredGoal.archivedAt;
                goals.push(restoredGoal);
                
                localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
                saveGoals();
                renderGoals();
                renderArchivedGoals();
                
                showNotification(`‚úÖ Goal "${goal.title}" restored!`, 'success');
            }
        }

        // ‚úÖ Permanently Delete Archived Goal
        function permanentlyDeleteArchivedGoal(goalId) {
            const goal = archivedGoals.find(g => g.id === goalId);
            if (!goal) return;
            
            if (confirm(`üóëÔ∏è PERMANENTLY delete "${goal.title}"? This cannot be undone!`)) {
                archivedGoals = archivedGoals.filter(g => g.id !== goalId);
                localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
                renderArchivedGoals();
                
                // Update button count if modal is open
                const archiveBtn = document.querySelector('.goal-archive-btn');
                if (archiveBtn) {
                    archiveBtn.innerHTML = `üì¶ View Archived Goals (${archivedGoals.length})`;
                }
                
                showNotification('Goal permanently deleted', 'info');
            }
        }

        // ‚úÖ Clear All Archived Goals
        function clearAllArchivedGoals() {
            if (archivedGoals.length === 0) {
                showNotification('No archived goals to clear', 'info');
                return;
            }
            
            if (confirm(`üóëÔ∏è PERMANENTLY delete ALL ${archivedGoals.length} archived goals? This cannot be undone!`)) {
                archivedGoals = [];
                localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
                renderArchivedGoals();
                
                // Update button count
                const archiveBtn = document.querySelector('.goal-archive-btn');
                if (archiveBtn) {
                    archiveBtn.innerHTML = `üì¶ View Archived Goals (0)`;
                }
                
                showNotification('All archived goals cleared', 'info');
            }
        }


        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('archivedGoalsModal')?.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeArchivedGoalsModal();
                }
            });
        });


        // ===== DEFAULT MEMES =====

        function getRandomMeme() {
            if (allMemes.length === 0) {
                document.getElementById('memeImage').src = 'https://via.placeholder.com/300x200?text=No+Memes';
                document.getElementById('memeCaption').textContent = 'No memes available. Add some!';
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * allMemes.length);
            const meme = allMemes[randomIndex];
            
            // ‚úÖ HANDLE BOTH OLD (string) & NEW (object) FORMAT
            const url = typeof meme === 'string' ? meme : meme.url;
            const caption = typeof meme === 'string' ? 'Click to see another meme!' : meme.caption;
            
            const img = document.getElementById('memeImage');
            img.src = url;
            document.getElementById('memeCaption').textContent = caption;
            
            img.onerror = function() {
                console.warn('Failed to load meme:', url);
                allMemes = allMemes.filter(m => {
                    const mUrl = typeof m === 'string' ? m : m.url;
                    return mUrl !== url;
                });
                customMemes = customMemes.filter(m => m.url !== url);
                localStorage.setItem('customMemes', JSON.stringify(customMemes));
                updateCustomMemesCount();
                
                if (allMemes.length > 0) {
                    getRandomMeme();
                } else {
                    img.src = 'https://via.placeholder.com/300x200?text=No+Memes';
                }
            };
        }







        function addCustomMeme() {
            const urlInput = document.getElementById('customMemeUrl');
            const url = urlInput.value.trim();
            
            if (!url) {
                showNotification('‚ùå Please enter a meme URL!', 'error');
                return;
            }
            
            // Validate URL
            try {
                new URL(url);
            } catch {
                showNotification('‚ùå Invalid URL format!', 'error');
                return;
            }
            
            // Check duplicate
            if (customMemes.some(m => m.url === url)) {
                showNotification('‚ö†Ô∏è This meme already exists!', 'error');
                return;
            }
            
            // ‚úÖ PROMPT FOR CAPTION
            const caption = prompt('Enter a caption for this meme (optional):', '') || 'No caption';
            
            // ‚úÖ L∆ØU OBJECT THAY V√å STRING
            const newMeme = { url, caption, addedAt: new Date().toISOString() };
            customMemes.push(newMeme);
            allMemes.push(newMeme);
            
            localStorage.setItem('customMemes', JSON.stringify(customMemes));
            
            urlInput.value = '';
            updateCustomMemesCount();
            showNotification('‚úÖ Meme added successfully!', 'success');
            getRandomMeme();
        }




        // ===== UPDATE MEME COUNT =====
        function updateCustomMemesCount() {
            const countEl = document.getElementById('customMemesCount');
            if (countEl) countEl.textContent = customMemes.length;
        }

        // ===== OPEN MANAGE MEMES MODAL =====
        function openManageMemesModal() {
            if (customMemes.length === 0) {
                showNotification('üì∏ No custom memes yet. Add some first!', 'info');
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'manageMemesModal';
            modal.style.cssText = `
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.6);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(4px);
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--bg-white); border-radius: 16px; max-width: 800px; width: 100%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div style="padding: 24px; border-bottom: 1px solid var(--border-color); position: sticky; top: 0; background: var(--bg-white); z-index: 1;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h2 style="margin: 0 0 8px 0; font-size: 1.5rem; color: var(--text-dark);">
                                    üì∏ Manage Your Memes
                                </h2>
                                <p style="margin: 0; color: var(--text-muted); font-size: 0.9rem;">
                                    ${customMemes.length} custom memes
                                </p>
                            </div>
                            <button onclick="closeManageMemesModal()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: var(--text-muted);">
                                √ó
                            </button>
                        </div>
                    </div>
                    
                    <div style="padding: 20px;">
                        ${renderCustomMemesList()}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeManageMemesModal();
            });
        }

        // ===== CLOSE MODAL =====
        function closeManageMemesModal() {
            const modal = document.getElementById('manageMemesModal');
            if (modal) modal.remove();
        }



        function renderCustomMemesList() {
            return customMemes.map((meme, index) => {
                const url = typeof meme === 'string' ? meme : meme.url;
                const caption = typeof meme === 'string' ? 'No caption' : meme.caption;
                
                return `
                    <div style="background: var(--bg-light); padding: 12px; border-radius: 12px; margin-bottom: 12px;">
                        <div style="display: flex; gap: 12px; align-items: start;">
                            <img src="${url}" alt="Meme ${index + 1}" 
                                style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; flex-shrink: 0;"
                                onerror="this.src='https://via.placeholder.com/100?text=Error'">
                            
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 6px;">
                                    "${caption}"
                                </div>
                                <div style="font-size: 0.85rem; color: var(--text-muted); word-break: break-all; margin-bottom: 6px;">
                                    ${url}
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">
                                    Added: ${typeof meme === 'object' && meme.addedAt ? new Date(meme.addedAt).toLocaleDateString() : 'Unknown'}
                                </div>
                            </div>
                            
                            <div style="display: flex; flex-direction: column; gap: 6px;">
                                <button onclick="editMemeCaption('${url.replace(/'/g, "\\'")}', '${caption.replace(/'/g, "\\'")}')" 
                                    style="background: #3b82f6; color: white; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; white-space: nowrap;">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="deleteCustomMeme('${url.replace(/'/g, "\\'")}')" 
                                    style="background: #ef4444; color: white; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; white-space: nowrap;">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function editMemeCaption(url, oldCaption) {
            const newCaption = prompt('Edit caption:', oldCaption);
            if (newCaption === null) return; // User cancelled
            
            const memeIndex = customMemes.findIndex(m => m.url === url);
            if (memeIndex !== -1) {
                customMemes[memeIndex].caption = newCaption || 'No caption';
                localStorage.setItem('customMemes', JSON.stringify(customMemes));
                
                // Update allMemes
                const allIndex = allMemes.findIndex(m => (typeof m === 'object' ? m.url : m) === url);
                if (allIndex !== -1) {
                    allMemes[allIndex] = customMemes[memeIndex];
                }
                
                // Re-render modal
                const modalBody = document.querySelector('#manageMemesModal > div > div:last-child');
                if (modalBody) {
                    modalBody.innerHTML = renderCustomMemesList();
                }
                
                showNotification('‚úÖ Caption updated!', 'success');
            }
        }

        // ===== DELETE MEME =====
        function deleteCustomMeme(url) {
            if (!confirm('üóëÔ∏è Delete this meme?')) return;
            
            customMemes = customMemes.filter(m => m.url !== url);
            allMemes = allMemes.filter(m => {
                const mUrl = typeof m === 'string' ? m : m.url;
                return mUrl !== url;
            });
            
            localStorage.setItem('customMemes', JSON.stringify(customMemes));
            updateCustomMemesCount();
            
            const modalBody = document.querySelector('#manageMemesModal > div > div:last-child');
            if (modalBody) {
                modalBody.innerHTML = renderCustomMemesList();
            }
            
            const headerCount = document.querySelector('#manageMemesModal p');
            if (headerCount) {
                headerCount.textContent = `${customMemes.length} custom memes`;
            }
            
            showNotification('Meme deleted', 'info');
        }


        // ===== INITIALIZE =====
        document.addEventListener('DOMContentLoaded', function() {
            updateCustomMemesCount();
            getRandomMeme();
        });



        // ===== OPEN ARCHIVED GOALS MODAL =====
        function openArchivedGoalsModal() {
            document.getElementById('archivedGoalsModal').style.display = 'flex';
            renderArchivedGoals();
        }

        // ===== CLOSE ARCHIVED GOALS MODAL =====
        function closeArchivedGoalsModal() {
            document.getElementById('archivedGoalsModal').style.display = 'none';
        }

        // ===== RENDER ARCHIVED GOALS =====
        function renderArchivedGoals() {
            const container = document.getElementById('archivedGoalsContainer');
            const careerFilter = document.getElementById('archiveCareerFilter').value;
            
            if (!container) return;
            
            let filteredArchived = archivedGoals;
            
            if (careerFilter !== 'all') {
                filteredArchived = archivedGoals.filter(g => g.career === careerFilter);
            }
            
            if (filteredArchived.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
                        <div style="font-size: 4rem; margin-bottom: 15px; opacity: 0.3;">üì¶</div>
                        <h3 style="margin: 0 0 8px 0; color: var(--text-dark);">No Archived Goals</h3>
                        <p style="margin: 0; font-size: 0.95rem;">
                            ${careerFilter === 'all' ? 'Complete some goals to see them here!' : 'No archived goals for this career yet.'}
                        </p>
                    </div>
                `;
                return;
            }
            
            // Sort by archived date (newest first)
            filteredArchived.sort((a, b) => new Date(b.archivedAt) - new Date(a.archivedAt));
            
            // Group by month
            const groupedByMonth = {};
            filteredArchived.forEach(goal => {
                const date = new Date(goal.archivedAt);
                const monthKey = date.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                
                if (!groupedByMonth[monthKey]) {
                    groupedByMonth[monthKey] = [];
                }
                groupedByMonth[monthKey].push(goal);
            });
            
            let html = `
                <div style="margin-bottom: 20px; padding: 16px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border-left: 4px solid #10b981;">
                    <div style="font-size: 1.1rem; font-weight: 600; color: #10b981; margin-bottom: 8px;">
                        üéâ Total Achievements
                    </div>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 150px;">
                            <div style="font-size: 0.85rem; color: var(--text-muted);">Total Archived</div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #10b981;">${filteredArchived.length}</div>
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <div style="font-size: 0.85rem; color: var(--text-muted);">Total Hours Completed</div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #10b981;">
                                ${filteredArchived.reduce((sum, g) => sum + (g.target || 0), 0).toFixed(0)}h
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Render each month group
            Object.entries(groupedByMonth).forEach(([month, goals]) => {
                html += `
                    <div style="margin-bottom: 30px;">
                        <div style="font-size: 1.2rem; font-weight: 700; color: var(--text-dark); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--border-color); display: flex; align-items: center; gap: 10px;">
                            üìÖ ${month}
                            <span style="font-size: 0.85rem; font-weight: 500; color: var(--text-muted);">(${goals.length} goals)</span>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            ${goals.map(goal => renderArchivedGoalCard(goal)).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ===== RENDER SINGLE ARCHIVED GOAL CARD =====
        function renderArchivedGoalCard(goal) {
            const typeIcons = {
                study_hours: 'üìö',
                skill_mastery: 'üéØ',
                custom: '‚úÖ'
            };
            
            const careerColors = {
                pe: '#e74c3c', ib: '#3498db', hf: '#f39c12', sc: '#2ecc71',
                fintech: '#00ffef', english: '#fbe82c', chinese: '#00ffd2',
                tools: '#ff1265', cfa1: '#00ff82'
            };
            
            const careerColor = careerColors[goal.career] || '#3b82f6';
            const archivedDate = new Date(goal.archivedAt).toLocaleDateString('en-US', { 
                year: 'numeric', month: 'short', day: 'numeric' 
            });
            
            return `
                <div style="background: var(--bg-white); border-radius: 12px; padding: 20px; border-left: 4px solid ${careerColor}; box-shadow: var(--shadow-sm); transition: all 0.3s ease;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; flex-wrap: wrap; gap: 10px;">
                        <div style="flex: 1; min-width: 200px;">
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--text-dark); margin-bottom: 6px; display: flex; align-items: center; gap: 8px;">
                                ${typeIcons[goal.type] || 'üìå'} ${goal.title}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-muted); display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                                <span style="background: ${careerColor}; color: white; padding: 3px 10px; border-radius: 12px; font-weight: 600; font-size: 0.75rem;">
                                    ${skillsData[goal.career]?.title || goal.career}
                                </span>
                                <span>‚Ä¢</span>
                                <span>Completed: ${archivedDate}</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 8px;">
                            <button onclick="restoreArchivedGoal('${goal.id}')" style="padding: 6px 12px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500;">
                                ‚Ü©Ô∏è Restore
                            </button>
                            <button onclick="permanentlyDeleteArchivedGoal('${goal.id}')" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500;">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; font-size: 0.9rem; color: var(--text-muted); flex-wrap: wrap;">
                        <span><strong>Target:</strong> ${goal.target} ${goal.type === 'custom' ? 'items' : 'hours'}</span>
                        ${goal.skillName ? `<span>‚Ä¢ <strong>Skill:</strong> ${goal.skillName}</span>` : ''}
                        ${goal.deadline ? `<span>‚Ä¢ <strong>Deadline was:</strong> ${formatDate(goal.deadline)}</span>` : ''}
                    </div>
                </div>
            `;
        }

        // ===== RESTORE ARCHIVED GOAL =====
        function restoreArchivedGoal(goalId) {
            const goal = archivedGoals.find(g => g.id === goalId);
            if (!goal) return;
            
            if (confirm(`‚Ü©Ô∏è Restore "${goal.title}" back to active goals?`)) {
                // Remove from archived
                archivedGoals = archivedGoals.filter(g => g.id !== goalId);
                
                // Add back to active goals (remove archivedAt timestamp)
                const restoredGoal = { ...goal };
                delete restoredGoal.archivedAt;
                goals.push(restoredGoal);
                
                localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
                saveGoals();
                renderGoals();
                renderArchivedGoals();
                
                // Update button count
                const archiveBtn = document.querySelector('.goal-archive-btn');
                if (archiveBtn) {
                    archiveBtn.innerHTML = `üì¶ View Archived Goals (${archivedGoals.length})`;
                }
                
                showNotification(`‚úÖ Goal "${goal.title}" restored!`, 'success');
            }
        }

        // ===== PERMANENTLY DELETE ARCHIVED GOAL =====
        function permanentlyDeleteArchivedGoal(goalId) {
            const goal = archivedGoals.find(g => g.id === goalId);
            if (!goal) return;
            
            if (confirm(`üóëÔ∏è PERMANENTLY delete "${goal.title}"? This cannot be undone!`)) {
                archivedGoals = archivedGoals.filter(g => g.id !== goalId);
                localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
                renderArchivedGoals();
                
                // Update button count
                const archiveBtn = document.querySelector('.goal-archive-btn');
                if (archiveBtn) {
                    archiveBtn.innerHTML = `üì¶ View Archived Goals (${archivedGoals.length})`;
                }
                
                showNotification('Goal permanently deleted', 'info');
            }
        }

        // ===== CLEAR ALL ARCHIVED GOALS =====
        function clearAllArchivedGoals() {
            if (archivedGoals.length === 0) {
                showNotification('No archived goals to clear', 'info');
                return;
            }
            
            if (confirm(`üóëÔ∏è PERMANENTLY delete ALL ${archivedGoals.length} archived goals? This cannot be undone!`)) {
                archivedGoals = [];
                localStorage.setItem('archivedGoals', JSON.stringify(archivedGoals));
                renderArchivedGoals();
                
                // Update button count
                const archiveBtn = document.querySelector('.goal-archive-btn');
                if (archiveBtn) {
                    archiveBtn.innerHTML = `üì¶ View Archived Goals (0)`;
                }
                
                showNotification('All archived goals cleared', 'info');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // ... existing code ...
            
            // ‚úÖ Close archived modal on backdrop click
            document.getElementById('archivedGoalsModal')?.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeArchivedGoalsModal();
                }
            });
        });


        // --- DATA MANAGEMENT (EXPORT/IMPORT) ---

        function exportProgress() {
            try {
                // ‚úÖ Get data directly from localStorage instead of variables
                const data = {
                    studyHours: JSON.parse(localStorage.getItem('studyHours') || '{}'),
                    gamification: JSON.parse(localStorage.getItem('gamification') || '{}'),
                    readingList: JSON.parse(localStorage.getItem('readingList') || '[]'),
                    courses: JSON.parse(localStorage.getItem('courses') || '[]'),
                    goals: JSON.parse(localStorage.getItem('goals') || '[]'),
                    archivedGoals: JSON.parse(localStorage.getItem('archivedGoals') || '[]'),
                    dailyStudyData: JSON.parse(localStorage.getItem('dailyStudyData') || '{}'),
                    sessionLogs: JSON.parse(localStorage.getItem('sessionLogs') || '[]'),
                    customQuotes: JSON.parse(localStorage.getItem('customQuotes') || '[]'),
                    customMemes: JSON.parse(localStorage.getItem('customMemes') || '[]'),
                    sleepSessions: JSON.parse(localStorage.getItem('sleepSessions') || '[]'),
                    investmentAnalyses: JSON.parse(localStorage.getItem('investmentAnalyses') || '[]'),
                    dealDiary: JSON.parse(localStorage.getItem('dealDiary') || '[]'),
                    exportDate: new Date().toISOString(),
                    version: "2.1"
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `finance-skills-tracker-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showNotification('‚úÖ Data exported successfully!', 'success');
            } catch (err) {
                console.error("Export failed:", err);
                showNotification('‚ùå Export failed: ' + err.message, 'error');
            }
        }

        function importProgress(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // ‚úÖ Safe import with proper initialization
                    if (data.studyHours) { 
                        localStorage.setItem('studyHours', JSON.stringify(data.studyHours));
                        studyHours = JSON.parse(localStorage.getItem('studyHours')) || {};
                    }
                    if (data.gamification) { 
                        localStorage.setItem('gamification', JSON.stringify(data.gamification));
                        gamification = JSON.parse(localStorage.getItem('gamification')) || {};
                    }
                    if (data.readingList) { 
                        localStorage.setItem('readingList', JSON.stringify(data.readingList));
                        readingList = JSON.parse(localStorage.getItem('readingList')) || [];
                    }
                    if (data.courses) { 
                        localStorage.setItem('courses', JSON.stringify(data.courses));
                        courses = JSON.parse(localStorage.getItem('courses')) || [];
                    }
                    if (data.goals) { 
                        localStorage.setItem('goals', JSON.stringify(data.goals));
                        goals = JSON.parse(localStorage.getItem('goals')) || [];
                    }
                    if (data.archivedGoals) { 
                        localStorage.setItem('archivedGoals', JSON.stringify(data.archivedGoals));
                        archivedGoals = JSON.parse(localStorage.getItem('archivedGoals')) || [];
                    }
                    if (data.dailyStudyData) { 
                        localStorage.setItem('dailyStudyData', JSON.stringify(data.dailyStudyData));
                        dailyStudyData = JSON.parse(localStorage.getItem('dailyStudyData')) || {};
                    }
                    if (data.sessionLogs) { 
                        localStorage.setItem('sessionLogs', JSON.stringify(data.sessionLogs));
                        sessionLogs = JSON.parse(localStorage.getItem('sessionLogs')) || [];
                    }
                    
                    // ‚úÖ Custom Quotes Import - SAFE VERSION
                    if (data.customQuotes) { 
                        localStorage.setItem('customQuotes', JSON.stringify(data.customQuotes));
                        // Force reload from localStorage instead of using variables
                        customQuotes = JSON.parse(localStorage.getItem('customQuotes')) || [];
                        
                        if (typeof defaultQuotes !== 'undefined') {
                            motivationalQuotes = [...defaultQuotes, ...customQuotes];
                        }
                        
                        if (typeof updateCustomQuotesCount === 'function') {
                            updateCustomQuotesCount();
                        }
                    }
                    
                    // ‚úÖ Custom Memes Import - SAFE VERSION
                    if (data.customMemes) { 
                        localStorage.setItem('customMemes', JSON.stringify(data.customMemes));
                        // Force reload from localStorage instead of using variables
                        customMemes = JSON.parse(localStorage.getItem('customMemes')) || [];
                        
                        if (typeof defaultMemes !== 'undefined') {
                            const defaultMemesArray = defaultMemes.map(url => 
                                typeof url === 'string' ? { url, caption: 'Built-in meme' } : url
                            );
                            allMemes = [...defaultMemesArray, ...customMemes];
                        }
                        
                        if (typeof updateCustomMemesCount === 'function') {
                            updateCustomMemesCount();
                        }
                    }
                    
                    if (data.sleepSessions) { 
                        localStorage.setItem('sleepSessions', JSON.stringify(data.sleepSessions));
                        sleepSessions = JSON.parse(localStorage.getItem('sleepSessions')) || [];
                    }
                    if (data.investmentAnalyses) { 
                        localStorage.setItem('investmentAnalyses', JSON.stringify(data.investmentAnalyses));
                        investmentAnalyses = JSON.parse(localStorage.getItem('investmentAnalyses')) || [];
                    }
                    if (data.dealDiary) { 
                        localStorage.setItem('dealDiary', JSON.stringify(data.dealDiary));
                        dealDiary = JSON.parse(localStorage.getItem('dealDiary')) || [];
                    }

                    // ‚úÖ Reload ALL UI components
                    if (typeof loadCareer === 'function') loadCareer(currentCareer);
                    if (typeof updateStats === 'function') updateStats();
                    if (typeof updateGamificationStats === 'function') updateGamificationStats();
                    if (typeof renderReadingList === 'function') renderReadingList();
                    if (typeof updateReadingCounts === 'function') updateReadingCounts();
                    if (typeof renderCourses === 'function') renderCourses();
                    if (typeof renderGoals === 'function') renderGoals();
                    if (typeof renderSessionLogs === 'function') renderSessionLogs();
                    if (typeof renderSleepHistory === 'function') renderSleepHistory();
                    if (typeof renderSleepChart === 'function') renderSleepChart();
                    if (typeof renderAnalysisCards === 'function') renderAnalysisCards();
                    if (typeof renderDealCards === 'function') renderDealCards();
                    if (typeof getRandomQuote === 'function') getRandomQuote();
                    if (typeof getRandomMeme === 'function') getRandomMeme();
                    if (typeof updateDailyStudyDisplay === 'function') updateDailyStudyDisplay();
                    if (typeof updateCorrelationAnalytics === 'function') updateCorrelationAnalytics();
                    
                    showNotification('‚úÖ Data imported successfully! All data restored.', 'success');
                    
                    // ‚úÖ Force page reload after 2 seconds to ensure everything syncs
                    setTimeout(() => {
                        if (confirm('Data imported! Reload page to ensure everything syncs properly?')) {
                            location.reload();
                        }
                    }, 2000);
                    
                } catch (err) {
                    console.error("Import failed:", err);
                    showNotification('‚ùå Import failed: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // Reset input
        }

    </script>

    <!--Goal Progress Modal -->
    <div id="updateGoalProgressModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="updateGoalProgressModalTitle">üìä Update Goal Progress</h2>
                <button class="close-btn" onclick="closeUpdateGoalProgressModal()">√ó</button>
            </div>
            <form id="updateGoalProgressForm">
                <input type="hidden" id="updateGoalProgressId" />
                <div class="form-group">
                    <label for="updateGoalProgressValue">Current Progress (hours):</label>
                    <input type="number" id="updateGoalProgressValue" min="0" step="0.1" required />
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeUpdateGoalProgressModal()">Cancel</button>
                    <button type="submit">Update Progress</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Archived Goals Modal -->
    <div id="archivedGoalsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 85vh; overflow-y: auto;">
            <div class="modal-header" style="position: sticky; top: 0; background: var(--bg-white); z-index: 10; padding-bottom: 15px; border-bottom: 2px solid var(--border-color);">
                <div>
                    <h2 style="margin: 0 0 8px 0; font-size: 1.5rem; color: var(--text-dark);">
                        üì¶ Archived Goals History
                    </h2>
                    <p style="margin: 0; color: var(--text-muted); font-size: 0.9rem;">
                        All your completed goals, preserved forever
                    </p>
                </div>
                <button class="modal-close" onclick="closeArchivedGoalsModal()">&times;</button>
            </div>
            
            <div style="margin: 20px 0;">
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <select id="archiveCareerFilter" onchange="renderArchivedGoals()" style="flex: 1; min-width: 150px; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-white); color: var(--text-dark);">
                        <option value="all">All Careers</option>
                        <option value="pe">üíº Private Equity</option>
                        <option value="ib">üè¶ Investment Banking</option>
                        <option value="hf">üìà Hedge Funds</option>
                        <option value="sc">üéØ Strategy Consulting</option>
                        <option value="fintech">üí≥ Fintech</option>
                        <option value="english">üö© English</option>
                        <option value="chinese">üíû Chinese</option>
                        <option value="tools">üõ†Ô∏è Finance Tools</option>
                        <option value="cfa1">üìú CFA Level 1</option>
                    </select>
                    
                    <button onclick="clearAllArchivedGoals()" style="padding: 10px 20px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        üóëÔ∏è Clear All
                    </button>
                </div>
                
                <div id="archivedGoalsContainer">
                    <!-- Archived goals will render here -->
                </div>
            </div>
        </div>
    </div>
</body>
</html>
